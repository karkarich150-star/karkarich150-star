<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Cowboy Messenger ü§†</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link<!DOCTYPE html>
<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Cowboy Messenger ü§†</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    
    <!-- Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-firestore.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-auth.js"></script>
    
    <style>
        * {
            font-family: 'Inter', 'Poppins', sans-serif;
            -webkit-tap-highlight-color: transparent;
        }
        body {
            background: linear-gradient(135deg, #0f172a 0%, #1e293b 100%);
            min-height: 100vh;
            overscroll-behavior: none;
        }
        .glassmorphism {
            background: rgba(30, 41, 59, 0.95);
            backdrop-filter: blur(20px);
            border: 1px solid rgba(255, 255, 255, 0.1);
        }
        .card-hover {
            transition: all 0.3s ease;
        }
        .card-hover:hover {
            transform: translateY(-3px);
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
        }
        .gradient-text {
            background: linear-gradient(90deg, #60a5fa 0%, #38bdf8 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }
        .btn-primary {
            background: linear-gradient(90deg, #3b82f6 0%, #1d4ed8 100%);
            transition: all 0.3s ease;
        }
        .btn-primary:active {
            transform: scale(0.98);
        }
        .fade-in {
            animation: fadeIn 0.3s ease-out;
        }
        .scrollbar-custom::-webkit-scrollbar {
            width: 4px;
        }
        .scrollbar-custom::-webkit-scrollbar-track {
            background: rgba(30, 41, 59, 0.5);
            border-radius: 10px;
        }
        .scrollbar-custom::-webkit-scrollbar-thumb {
            background: linear-gradient(180deg, #3b82f6 0%, #1d4ed8 100%);
            border-radius: 10px;
        }
        .message-bubble {
            border-radius: 20px;
            position: relative;
            max-width: 85%;
        }
        .clan-badge {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 20px;
            margin: 0 auto;
        }
        .tab-active {
            background: linear-gradient(90deg, #3b82f6 0%, #1d4ed8 100%);
            color: white;
        }
        .tab-inactive {
            background: #1e293b;
            color: #94a3b8;
        }
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        .clan-selected {
            border: 2px solid #3b82f6;
            background: rgba(59, 130, 246, 0.2) !important;
            transform: scale(1.05);
        }
        .nav-active {
            background: rgba(59, 130, 246, 0.2);
            border-left: 4px solid #3b82f6;
        }
        .section-content {
            display: none;
        }
        .section-active {
            display: block;
        }
        .gift-in-showcase {
            border: 2px solid #3b82f6;
            position: relative;
        }
        .gift-in-showcase::after {
            content: "‚≠ê";
            position: absolute;
            top: -8px;
            right: -8px;
            font-size: 16px;
            background: #1e293b;
            border-radius: 50%;
            width: 24px;
            height: 24px;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        .notification-dot {
            width: 10px;
            height: 10px;
            background: #ef4444;
            border-radius: 50%;
            position: absolute;
            top: -2px;
            right: -2px;
        }
        .video-player {
            max-width: 100%;
            border-radius: 12px;
            overflow: hidden;
        }
        .message-image {
            max-width: 250px;
            border-radius: 12px;
            margin-top: 8px;
            cursor: pointer;
        }
        .unread-badge {
            background: #ef4444;
            color: white;
            font-size: 12px;
            padding: 2px 6px;
            border-radius: 10px;
            margin-left: auto;
            min-width: 20px;
            height: 20px;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        .typing-indicator {
            display: flex;
            align-items: center;
            gap: 4px;
            padding: 8px 12px;
            background: rgba(30, 41, 59, 0.5);
            border-radius: 12px;
            width: fit-content;
            margin: 4px 0;
        }
        .typing-indicator span {
            width: 8px;
            height: 8px;
            background: #60a5fa;
            border-radius: 50%;
            animation: typing 1.4s infinite;
        }
        .typing-indicator span:nth-child(2) { animation-delay: 0.2s; }
        .typing-indicator span:nth-child(3) { animation-delay: 0.4s; }
        @keyframes typing {
            0%, 60%, 100% { transform: translateY(0); }
            30% { transform: translateY(-4px); }
        }
        .post-image {
            max-width: 100%;
            border-radius: 12px;
            margin-top: 8px;
            cursor: pointer;
        }
        .like-animation {
            animation: like 0.6s ease;
        }
        @keyframes like {
            0% { transform: scale(1); }
            50% { transform: scale(1.3); }
            100% { transform: scale(1); }
        }
        
        /* –ú–æ–±–∏–ª—å–Ω—ã–µ —Å—Ç–∏–ª–∏ */
        @media (max-width: 768px) {
            .mobile-hidden {
                display: none !important;
            }
            
            .mobile-only {
                display: block !important;
            }
            
            .mobile-flex-col {
                flex-direction: column;
            }
            
            .mobile-p-3 {
                padding: 0.75rem;
            }
            
            .mobile-p-4 {
                padding: 1rem;
            }
            
            .mobile-text-sm {
                font-size: 0.875rem;
            }
            
            .mobile-text-lg {
                font-size: 1.125rem;
            }
            
            .mobile-rounded-xl {
                border-radius: 0.75rem;
            }
            
            .mobile-h-12 {
                height: 3rem;
            }
            
            .mobile-w-12 {
                width: 3rem;
            }
            
            .mobile-bottom-nav {
                position: fixed;
                bottom: 0;
                left: 0;
                right: 0;
                background: rgba(30, 41, 59, 0.95);
                backdrop-filter: blur(20px);
                border-top: 1px solid rgba(255, 255, 255, 0.1);
                z-index: 50;
                padding: 0.5rem;
            }
            
            .mobile-bottom-nav-btn {
                flex: 1;
                padding: 0.75rem;
                border-radius: 0.75rem;
                text-align: center;
                font-size: 0.75rem;
                transition: all 0.2s;
            }
            
            .mobile-bottom-nav-btn.active {
                background: rgba(59, 130, 246, 0.2);
                color: #60a5fa;
            }
            
            .mobile-header {
                position: sticky;
                top: 0;
                z-index: 40;
                padding: 1rem;
                background: rgba(30, 41, 59, 0.95);
                backdrop-filter: blur(20px);
                border-bottom: 1px solid rgba(255, 255, 255, 0.1);
            }
            
            .mobile-content {
                padding-bottom: 5rem;
                padding-top: 1rem;
            }
            
            .mobile-modal {
                position: fixed;
                top: 0;
                left: 0;
                right: 0;
                bottom: 0;
                background: rgba(0, 0, 0, 0.9);
                z-index: 100;
                overflow-y: auto;
            }
            
            .mobile-modal-content {
                min-height: 100vh;
                padding: 1rem;
            }
            
            .mobile-back-btn {
                position: absolute;
                top: 1rem;
                left: 1rem;
                z-index: 10;
                width: 40px;
                height: 40px;
                border-radius: 50%;
                background: rgba(30, 41, 59, 0.8);
                backdrop-filter: blur(10px);
                display: flex;
                align-items: center;
                justify-content: center;
            }
            
            .mobile-chat-input {
                position: fixed;
                bottom: 4rem;
                left: 0;
                right: 0;
                padding: 1rem;
                background: rgba(30, 41, 59, 0.95);
                backdrop-filter: blur(20px);
                border-top: 1px solid rgba(255, 255, 255, 0.1);
                z-index: 40;
            }
            
            .mobile-messages-container {
                padding-bottom: 8rem;
                padding-top: 1rem;
            }
            
            .mobile-fab {
                position: fixed;
                bottom: 6rem;
                right: 1rem;
                width: 56px;
                height: 56px;
                border-radius: 50%;
                background: linear-gradient(90deg, #3b82f6 0%, #1d4ed8 100%);
                display: flex;
                align-items: center;
                justify-content: center;
                font-size: 1.5rem;
                box-shadow: 0 4px 20px rgba(59, 130, 246, 0.4);
                z-index: 45;
            }
            
            .mobile-sidebar {
                position: fixed;
                top: 0;
                left: 0;
                bottom: 0;
                width: 85%;
                max-width: 300px;
                background: rgba(30, 41, 59, 0.98);
                backdrop-filter: blur(30px);
                z-index: 1000;
                transform: translateX(-100%);
                transition: transform 0.3s ease;
            }
            
            .mobile-sidebar.open {
                transform: translateX(0);
            }
            
            .mobile-sidebar-overlay {
                position: fixed;
                top: 0;
                left: 0;
                right: 0;
                bottom: 0;
                background: rgba(0, 0, 0, 0.7);
                z-index: 999;
                opacity: 0;
                pointer-events: none;
                transition: opacity 0.3s ease;
            }
            
            .mobile-sidebar-overlay.open {
                opacity: 1;
                pointer-events: all;
            }
            
            .mobile-grid-2 {
                grid-template-columns: repeat(2, 1fr);
            }
            
            .mobile-grid-3 {
                grid-template-columns: repeat(3, 1fr);
            }
            
            .mobile-grid-4 {
                grid-template-columns: repeat(4, 1fr);
            }
        }
        
        @media (min-width: 769px) {
            .mobile-only {
                display: none !important;
            }
            
            .desktop-hidden {
                display: none !important;
            }
        }
        
        /* –ê–Ω–∏–º–∞—Ü–∏–∏ */
        .slide-in-right {
            animation: slideInRight 0.3s ease;
        }
        
        @keyframes slideInRight {
            from { transform: translateX(100%); opacity: 0; }
            to { transform: translateX(0); opacity: 1; }
        }
        
        .slide-in-left {
            animation: slideInLeft 0.3s ease;
        }
        
        @keyframes slideInLeft {
            from { transform: translateX(-100%); opacity: 0; }
            to { transform: translateX(0); opacity: 1; }
        }
        
        .scale-in {
            animation: scaleIn 0.3s ease;
        }
        
        @keyframes scaleIn {
            from { transform: scale(0.9); opacity: 0; }
            to { transform: scale(1); opacity: 1; }
        }
        
        /* –£–ª—É—á—à–µ–Ω–∏—è –¥–ª—è —Ç–∞–ø–æ–≤ */
        .tap-highlight {
            transition: transform 0.1s ease, background 0.2s ease;
        }
        
        .tap-highlight:active {
            transform: scale(0.97);
            background: rgba(255, 255, 255, 0.05);
        }
        
        /* –ü–ª–∞–≤–Ω–∞—è –ø—Ä–æ–∫—Ä—É—Ç–∫–∞ */
        html {
            scroll-behavior: smooth;
        }
        
        /* –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è –¥–ª—è –º–æ–±–∏–ª–æ–∫ */
        input, textarea, button {
            font-size: 16px !important; /* –ü—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–∞–µ—Ç –º–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞–Ω–∏–µ –≤ iOS */
        }
        
        /* –°—Ç–∏–ª–∏ –¥–ª—è –¥–ª–∏–Ω–Ω—ã—Ö —Ç–µ–∫—Å—Ç–æ–≤ */
        .text-ellipsis {
            overflow: hidden;
            text-overflow: ellipsis;
            white-space: nowrap;
        }
        
        .line-clamp-2 {
            display: -webkit-box;
            -webkit-line-clamp: 2;
            -webkit-box-oriment: vertical;
            overflow: hidden;
        }
        
        .line-clamp-3 {
            display: -webkit-box;
            -webkit-line-clamp: 3;
            -webkit-box-orient: vertical;
            overflow: hidden;
        }
        
        /* –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π */
        img, video {
            max-width: 100%;
            height: auto;
        }
    </style>
</head>
<body class="text-gray-200">
    <!-- –ú–æ–±–∏–ª—å–Ω—ã–π —Å–∞–π–¥–±–∞—Ä -->
    <div id="mobile-sidebar" class="mobile-sidebar mobile-only">
        <div class="p-6 h-full flex flex-col">
            <div class="flex items-center space-x-3 mb-8">
                <div class="w-12 h-12 rounded-full bg-gradient-to-r from-blue-500 to-cyan-400 flex items-center justify-center text-white text-2xl relative">
                    ü§†
                    <div id="mobile-notifications-dot" class="notification-dot hidden"></div>
                </div>
                <div>
                    <h2 class="text-xl font-bold gradient-text">Cowboy Messenger</h2>
                    <p class="text-xs text-blue-300">–í–∞—à –∫–æ–≤–±–æ–π—Å–∫–∏–π —Ä–∞–π</p>
                </div>
                <button id="mobile-close-sidebar" class="ml-auto text-gray-400">
                    <i class="fas fa-times text-xl"></i>
                </button>
            </div>

            <div class="space-y-2 flex-1">
                <button data-section="feed" class="nav-btn w-full text-left p-3 rounded-lg hover:bg-slate-700/50 transition flex items-center space-x-3">
                    <i class="fas fa-newspaper text-blue-400 w-5"></i>
                    <span>–õ–µ–Ω—Ç–∞</span>
                    <span id="mobile-feed-notifications" class="unread-badge hidden">0</span>
                </button>
                <button data-section="messenger" class="nav-btn w-full text-left p-3 rounded-lg hover:bg-slate-700/50 transition flex items-center space-x-3">
                    <i class="fas fa-comments text-blue-400 w-5"></i>
                    <span>–ú–µ—Å—Å–µ–Ω–¥–∂–µ—Ä</span>
                    <span id="mobile-unread-chats" class="unread-badge hidden">0</span>
                </button>
                <button data-section="profile" class="nav-btn w-full text-left p-3 rounded-lg hover:bg-slate-700/50 transition flex items-center space-x-3">
                    <i class="fas fa-user text-blue-400 w-5"></i>
                    <span>–ü—Ä–æ—Ñ–∏–ª—å</span>
                </button>
                <button data-section="friends" class="nav-btn w-full text-left p-3 rounded-lg hover:bg-slate-700/50 transition flex items-center space-x-3">
                    <i class="fas fa-users text-blue-400 w-5"></i>
                    <span>–î—Ä—É–∑—å—è</span>
                    <span id="mobile-friend-requests" class="unread-badge hidden">0</span>
                </button>
                <button data-section="shop" class="nav-btn w-full text-left p-3 rounded-lg hover:bg-slate-700/50 transition flex items-center space-x-3">
                    <i class="fas fa-store text-blue-400 w-5"></i>
                    <span>–ú–∞–≥–∞–∑–∏–Ω</span>
                </button>
                <button data-section="transfers" class="nav-btn w-full text-left p-3 rounded-lg hover:bg-slate-700/50 transition flex items-center space-x-3">
                    <i class="fas fa-money-bill-transfer text-blue-400 w-5"></i>
                    <span>–ü–µ—Ä–µ–≤–æ–¥—ã</span>
                </button>
                <button id="mobile-admin-btn" data-section="admin" class="nav-btn w-full text-left p-3 rounded-lg hover:bg-slate-700/50 transition flex items-center space-x-3 hidden">
                    <i class="fas fa-shield-alt text-red-400 w-5"></i>
                    <span class="text-red-300">–ê–¥–º–∏–Ω-–ø–∞–Ω–µ–ª—å</span>
                </button>
            </div>

            <div class="pt-8 border-t border-slate-700">
                <div class="bg-slate-800/50 rounded-xl p-4 mb-4">
                    <h3 class="font-bold text-sm mb-3 text-blue-300">üëë –¢–û–ü –ö–ª–∞–Ω–æ–≤</h3>
                    <div id="mobile-clan-leaderboard" class="space-y-2">
                        <!-- –ó–∞–ø–æ–ª–Ω–∏—Ç—Å—è –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏ -->
                    </div>
                </div>

                <div class="p-4 bg-slate-800/30 rounded-xl mb-4">
                    <div class="flex items-center justify-between mb-2">
                        <span class="text-sm font-medium">–ë–∞–ª–∞–Ω—Å</span>
                        <span id="mobile-user-balance" class="text-lg font-bold text-yellow-300">0 C</span>
                    </div>
                    <button data-section="transfers" class="nav-btn w-full bg-slate-700 hover:bg-slate-600 py-2 rounded-lg text-sm transition">
                        –ü–æ–ø–æ–ª–Ω–∏—Ç—å / –ü–µ—Ä–µ–≤–µ—Å—Ç–∏
                    </button>
                </div>

                <button id="mobile-logout-btn" class="w-full bg-slate-800 hover:bg-slate-700 py-3 rounded-xl flex items-center justify-center space-x-2 transition tap-highlight">
                    <i class="fas fa-sign-out-alt"></i>
                    <span>–í—ã–π—Ç–∏</span>
                </button>
            </div>
        </div>
    </div>
    
    <div id="mobile-sidebar-overlay" class="mobile-sidebar-overlay mobile-only"></div>

    <!-- –û—Å–Ω–æ–≤–Ω–æ–π –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä -->
    <div id="app" class="min-h-screen flex flex-col">
        <!-- –≠–∫—Ä–∞–Ω –≤—Ö–æ–¥–∞/—Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏ (–º–æ–±–∏–ª—å–Ω–∞—è –≤–µ—Ä—Å–∏—è) -->
        <div id="auth-screen" class="flex items-center justify-center min-h-screen w-full p-4">
            <div class="glassmorphism rounded-2xl p-6 w-full max-w-md card-hover">
                <div class="text-center mb-6">
                    <div class="w-16 h-16 rounded-full bg-gradient-to-r from-blue-600 to-cyan-500 flex items-center justify-center text-3xl mx-auto mb-4">
                        ü§†
                    </div>
                    <h2 class="text-2xl font-bold gradient-text">Cowboy Messenger</h2>
                    <p class="text-gray-400 mt-2 text-sm">–ü—Ä–∏—Å–æ–µ–¥–∏–Ω—è–π—Ç–µ—Å—å –∫ –∫–æ–≤–±–æ–π—Å–∫–æ–º—É —Å–æ–æ–±—â–µ—Å—Ç–≤—É!</p>
                </div>

                <!-- –í–∫–ª–∞–¥–∫–∏ -->
                <div class="flex mb-4 bg-slate-800 rounded-xl p-1">
                    <button id="mobile-login-tab" class="flex-1 py-3 rounded-lg font-medium text-sm tab-active tap-highlight">–í—Ö–æ–¥</button>
                    <button id="mobile-register-tab" class="flex-1 py-3 rounded-lg font-medium text-sm tab-inactive tap-highlight">–†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è</button>
                </div>

                <!-- –§–æ—Ä–º–∞ –≤—Ö–æ–¥–∞ -->
                <div id="mobile-login-form" class="space-y-4">
                    <div>
                        <label class="block text-sm font-medium mb-2">–ù–∏–∫–Ω–µ–π–º (@username)</label>
                        <input type="text" id="mobile-login-username" class="w-full bg-slate-800 border border-slate-700 rounded-xl px-4 py-3 text-base focus:outline-none focus:ring-2 focus:ring-blue-500" placeholder="@karkarich">
                    </div>
                    <div>
                        <label class="block text-sm font-medium mb-2">–ü–∞—Ä–æ–ª—å</label>
                        <input type="password" id="mobile-login-password" class="w-full bg-slate-800 border border-slate-700 rounded-xl px-4 py-3 text-base focus:outline-none focus:ring-2 focus:ring-blue-500" placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢">
                    </div>
                    <button id="mobile-login-btn" class="w-full btn-primary text-white py-3 rounded-xl font-bold mt-4 tap-highlight">
                        –í–æ–π—Ç–∏ –≤ –∞–∫–∫–∞—É–Ω—Ç
                    </button>
                </div>

                <!-- –§–æ—Ä–º–∞ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏ -->
                <div id="mobile-register-form" class="space-y-4 hidden">
                    <div>
                        <label class="block text-sm font-medium mb-2">–í—ã–±–µ—Ä–∏—Ç–µ –∫–ª–∞–Ω</label>
                        <div class="grid mobile-grid-4 gap-2" id="mobile-clan-selection">
                            <button type="button" data-clan="ü¶Å" class="clan-btn p-3 rounded-xl bg-slate-800 hover:bg-slate-700 transition text-lg tap-highlight">ü¶Å</button>
                            <button type="button" data-clan="ü¶Ö" class="clan-btn p-3 rounded-xl bg-slate-800 hover:bg-slate-700 transition text-lg tap-highlight">ü¶Ö</button>
                            <button type="button" data-clan="üê∫" class="clan-btn p-3 rounded-xl bg-slate-800 hover:bg-slate-700 transition text-lg tap-highlight">üê∫</button>
                            <button type="button" data-clan="üêª" class="clan-btn p-3 rounded-xl bg-slate-800 hover:bg-slate-700 transition text-lg tap-highlight">üêª</button>
                            <button type="button" data-clan="ü¶ä" class="clan-btn p-3 rounded-xl bg-slate-800 hover:bg-slate-700 transition text-lg tap-highlight">ü¶ä</button>
                            <button type="button" data-clan="üêØ" class="clan-btn p-3 rounded-xl bg-slate-800 hover:bg-slate-700 transition text-lg tap-highlight">üêØ</button>
                            <button type="button" data-clan="ü¶â" class="clan-btn p-3 rounded-xl bg-slate-800 hover:bg-slate-700 transition text-lg tap-highlight">ü¶â</button>
                            <button type="button" data-clan="üêç" class="clan-btn p-3 rounded-xl bg-slate-800 hover:bg-slate-700 transition text-lg tap-highlight">üêç</button>
                        </div>
                        <p class="text-xs text-red-400 mt-2 hidden" id="mobile-clan-error">–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –≤—ã–±–µ—Ä–∏—Ç–µ –∫–ª–∞–Ω</p>
                    </div>

                    <div>
                        <label class="block text-sm font-medium mb-2">–ù–∏–∫–Ω–µ–π–º</label>
                        <input type="text" id="mobile-reg-username" class="w-full bg-slate-800 border border-slate-700 rounded-xl px-4 py-3 text-base focus:outline-none focus:ring-2 focus:ring-blue-500" placeholder="@username">
                        <p class="text-xs text-gray-400 mt-1">–ù–∞—á–∏–Ω–∞–µ—Ç—Å—è —Å @, —Ç–æ–ª—å–∫–æ –±—É–∫–≤—ã, —Ü–∏—Ñ—Ä—ã, _ –∏ -</p>
                    </div>

                    <div>
                        <label class="block text-sm font-medium mb-2">–ü–∞—Ä–æ–ª—å</label>
                        <input type="password" id="mobile-reg-password" class="w-full bg-slate-800 border border-slate-700 rounded-xl px-4 py-3 text-base focus:outline-none focus:ring-2 focus:ring-blue-500" placeholder="–ú–∏–Ω–∏–º—É–º 8 —Å–∏–º–≤–æ–ª–æ–≤">
                    </div>

                    <div class="grid grid-cols-2 gap-3">
                        <div>
                            <label class="block text-sm font-medium mb-2">–ò–º—è (–Ω–µ–æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ)</label>
                            <input type="text" id="mobile-reg-firstname" class="w-full bg-slate-800 border border-slate-700 rounded-xl px-4 py-3 text-base focus:outline-none focus:ring-2 focus:ring-blue-500">
                        </div>
                        <div>
                            <label class="block text-sm font-medium mb-2">–§–∞–º–∏–ª–∏—è (–Ω–µ–æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ)</label>
                            <input type="text" id="mobile-reg-lastname" class="w-full bg-slate-800 border border-slate-700 rounded-xl px-4 py-3 text-base focus:outline-none focus:ring-2 focus:ring-blue-500">
                        </div>
                    </div>

                    <button id="mobile-register-btn" class="w-full btn-primary text-white py-3 rounded-xl font-bold mt-4 tap-highlight">
                        –°–æ–∑–¥–∞—Ç—å –∞–∫–∫–∞—É–Ω—Ç
                    </button>
                </div>

                <p class="text-center text-gray-400 mt-6 text-xs">
                    –°–æ–∑–¥–∞–≤–∞—è –∞–∫–∫–∞—É–Ω—Ç, –≤—ã —Å–æ–≥–ª–∞—à–∞–µ—Ç–µ—Å—å —Å –Ω–∞—à–∏–º–∏ –ø—Ä–∞–≤–∏–ª–∞–º–∏
                </p>
            </div>
        </div>

        <!-- –û—Å–Ω–æ–≤–Ω–æ–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ (–º–æ–±–∏–ª—å–Ω–∞—è –≤–µ—Ä—Å–∏—è) -->
        <div id="main-app" class="hidden w-full h-screen flex flex-col">
            <!-- –ú–æ–±–∏–ª—å–Ω—ã–π –∑–∞–≥–æ–ª–æ–≤–æ–∫ -->
            <div class="mobile-header flex items-center justify-between">
                <button id="mobile-menu-btn" class="w-10 h-10 rounded-lg bg-slate-800/50 flex items-center justify-center tap-highlight">
                    <i class="fas fa-bars"></i>
                </button>
                
                <div class="text-center flex-1 px-4">
                    <h1 class="text-lg font-bold gradient-text" id="mobile-current-section">–õ–µ–Ω—Ç–∞</h1>
                    <p class="text-xs text-gray-400" id="mobile-section-description">–ü–æ—Å–ª–µ–¥–Ω–∏–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è</p>
                </div>
                
                <div class="flex items-center space-x-2">
                    <div class="bg-slate-800/50 rounded-full px-3 py-1.5 flex items-center space-x-1.5">
                        <span id="mobile-header-balance" class="text-yellow-300 font-bold text-sm">0 C</span>
                        <span class="text-blue-300">ü§†</span>
                    </div>
                </div>
            </div>

            <!-- –ö–æ–Ω—Ç–µ–π–Ω–µ—Ä –¥–ª—è –∫–æ–Ω—Ç–µ–Ω—Ç–∞ -->
            <div id="mobile-content" class="flex-1 overflow-y-auto mobile-content">
                <!-- –õ–µ–Ω—Ç–∞ (–º–æ–±–∏–ª—å–Ω–∞—è) -->
                <div id="mobile-feed-content" class="section-content section-active p-4">
                    <!-- –°–æ–∑–¥–∞–Ω–∏–µ –ø–æ—Å—Ç–∞ -->
                    <div class="glassmorphism rounded-2xl p-4 mb-4">
                        <div class="flex items-center space-x-3 mb-3">
                            <div class="w-10 h-10 rounded-full bg-gradient-to-r from-blue-500 to-cyan-400 flex items-center justify-center">
                                <span id="mobile-user-avatar">ü§†</span>
                            </div>
                            <div class="flex-1">
                                <div class="font-bold text-sm" id="mobile-user-name">–í—ã</div>
                                <div class="text-xs text-gray-400">–°–æ–∑–¥–∞—Ç—å –ø–æ—Å—Ç</div>
                            </div>
                        </div>
                        
                        <textarea id="mobile-post-content" class="w-full bg-slate-800/50 border border-slate-700 rounded-xl px-4 py-3 h-24 focus:outline-none focus:ring-2 focus:ring-blue-500 mb-3 text-base" placeholder="–ß—Ç–æ —É –≤–∞—Å –Ω–æ–≤–æ–≥–æ, –∫–æ–≤–±–æ–π?"></textarea>
                        
                        <div class="mb-3">
                            <div class="flex space-x-2">
                                <label class="cursor-pointer flex-1">
                                    <input type="file" id="mobile-post-media" class="hidden" accept="image/*,video/*" multiple>
                                    <div class="px-3 py-2 bg-slate-800 hover:bg-slate-700 rounded-xl flex items-center justify-center space-x-2 text-sm tap-highlight">
                                        <i class="fas fa-image"></i>
                                        <span>–§–æ—Ç–æ/–í–∏–¥–µ–æ</span>
                                    </div>
                                </label>
                                <button id="mobile-clear-media" class="px-3 py-2 bg-red-800/30 hover:bg-red-700/40 rounded-xl tap-highlight">
                                    <i class="fas fa-trash"></i>
                                </button>
                            </div>
                            <div id="mobile-media-preview" class="mt-3 grid mobile-grid-3 gap-2 hidden">
                                <!-- –ü—Ä–µ–≤—å—é –º–µ–¥–∏–∞—Ñ–∞–π–ª–æ–≤ -->
                            </div>
                        </div>
                        
                        <button id="mobile-create-post-btn" class="w-full btn-primary py-3 rounded-xl font-bold text-sm tap-highlight">
                            –û–ø—É–±–ª–∏–∫–æ–≤–∞—Ç—å
                        </button>
                    </div>

                    <!-- –ü–æ—Å—Ç—ã -->
                    <div id="mobile-posts-container">
                        <!-- –ü–æ—Å—Ç—ã –±—É–¥—É—Ç –∑–¥–µ—Å—å -->
                    </div>
                </div>

                <!-- –ú–µ—Å—Å–µ–Ω–¥–∂–µ—Ä (–º–æ–±–∏–ª—å–Ω–∞—è –≤–µ—Ä—Å–∏—è) -->
                <div id="mobile-messenger-content" class="section-content h-full">
                    <!-- –°–ø–∏—Å–æ–∫ —á–∞—Ç–æ–≤ -->
                    <div class="h-full">
                        <div class="p-4">
                            <div class="flex items-center justify-between mb-4">
                                <h2 class="text-xl font-bold">–°–æ–æ–±—â–µ–Ω–∏—è</h2>
                                <button id="mobile-new-chat-btn" class="w-10 h-10 rounded-full bg-blue-600 hover:bg-blue-700 flex items-center justify-center tap-highlight">
                                    <i class="fas fa-plus"></i>
                                </button>
                            </div>
                            
                            <div id="mobile-chats-list" class="space-y-3">
                                <!-- –°–ø–∏—Å–æ–∫ —á–∞—Ç–æ–≤ -->
                            </div>
                        </div>
                    </div>
                    
                    <!-- –û–∫–Ω–æ —á–∞—Ç–∞ (–æ—Ç–¥–µ–ª—å–Ω–∞—è —Å—Ç—Ä–∞–Ω–∏—Ü–∞) -->
                    <div id="mobile-chat-window" class="hidden fixed inset-0 z-50 bg-slate-900">
                        <div class="h-full flex flex-col">
                            <!-- –ó–∞–≥–æ–ª–æ–≤–æ–∫ —á–∞—Ç–∞ -->
                            <div class="mobile-header flex items-center p-4 border-b border-slate-700">
                                <button id="mobile-back-to-chats" class="mobile-back-btn tap-highlight">
                                    <i class="fas fa-arrow-left"></i>
                                </button>
                                <div id="mobile-chat-header" class="text-center flex-1 px-12">
                                    <!-- –ó–∞–ø–æ–ª–Ω–∏—Ç—Å—è –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏ -->
                                </div>
                            </div>
                            
                            <!-- –°–æ–æ–±—â–µ–Ω–∏—è -->
                            <div id="mobile-messages-container" class="flex-1 overflow-y-auto p-4 mobile-messages-container">
                                <!-- –°–æ–æ–±—â–µ–Ω–∏—è –±—É–¥—É—Ç –∑–¥–µ—Å—å -->
                            </div>
                            
                            <!-- –í–≤–æ–¥ —Å–æ–æ–±—â–µ–Ω–∏—è -->
                            <div class="mobile-chat-input">
                                <div id="mobile-typing-indicator" class="typing-indicator hidden mb-2">
                                    <span></span><span></span><span></span>
                                </div>
                                <div class="flex space-x-2">
                                    <label class="cursor-pointer">
                                        <input type="file" id="mobile-chat-media" class="hidden" accept="image/*,video/*">
                                        <div class="w-10 h-10 rounded-lg bg-slate-800 hover:bg-slate-700 flex items-center justify-center tap-highlight">
                                            <i class="fas fa-image"></i>
                                        </div>
                                    </label>
                                    <input type="text" id="mobile-message-input" class="flex-1 bg-slate-800/50 border border-slate-700 rounded-xl px-4 py-3 focus:outline-none focus:ring-2 focus:ring-blue-500 text-base" placeholder="–°–æ–æ–±—â–µ–Ω–∏–µ...">
                                    <button id="mobile-send-message-btn" class="btn-primary px-4 rounded-xl font-bold tap-highlight">
                                        <i class="fas fa-paper-plane"></i>
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- –ü—Ä–æ—Ñ–∏–ª—å (–º–æ–±–∏–ª—å–Ω–∞—è –≤–µ—Ä—Å–∏—è) -->
                <div id="mobile-profile-content" class="section-content p-4">
                    <div class="glassmorphism rounded-2xl overflow-hidden mb-4">
                        <div class="h-32 bg-gradient-to-r from-blue-900/50 to-cyan-900/50 relative"></div>
                        <div class="p-4 relative">
                            <div class="absolute -top-8 left-4">
                                <div id="mobile-profile-avatar" class="w-16 h-16 rounded-full bg-gradient-to-r from-blue-600 to-cyan-500 flex items-center justify-center text-2xl border-4 border-slate-900">
                                    <!-- –ê–≤–∞—Ç–∞—Ä -->
                                </div>
                            </div>
                            <div class="ml-20">
                                <h2 id="mobile-profile-name" class="text-lg font-bold line-clamp-1"></h2>
                                <p id="mobile-profile-username" class="text-blue-300 text-sm line-clamp-1"></p>
                                <div class="flex items-center space-x-2 mt-1">
                                    <div id="mobile-profile-clan" class="px-2 py-0.5 bg-slate-800 rounded-full text-xs"></div>
                                    <div class="text-yellow-300 font-bold" id="mobile-profile-balance"></div>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="grid grid-cols-3 gap-3 mb-4">
                        <div class="glassmorphism rounded-xl p-3 text-center">
                            <div class="text-blue-400 text-lg mb-1">
                                <i class="fas fa-users"></i>
                            </div>
                            <div class="text-xs text-gray-400">–î—Ä—É–∑—å—è</div>
                            <div id="mobile-friends-count" class="font-bold text-sm">0</div>
                        </div>
                        <div class="glassmorphism rounded-xl p-3 text-center">
                            <div class="text-blue-400 text-lg mb-1">
                                <i class="fas fa-newspaper"></i>
                            </div>
                            <div class="text-xs text-gray-400">–ü–æ—Å—Ç—ã</div>
                            <div id="mobile-posts-count" class="font-bold text-sm">0</div>
                        </div>
                        <div class="glassmorphism rounded-xl p-3 text-center">
                            <div class="text-blue-400 text-lg mb-1">
                                <i class="fas fa-gift"></i>
                            </div>
                            <div class="text-xs text-gray-400">–ü–æ–¥–∞—Ä–∫–∏</div>
                            <div id="mobile-gifts-count" class="font-bold text-sm">0</div>
                        </div>
                    </div>
                    
                    <!-- –í–∏—Ç—Ä–∏–Ω–∞ –ø–æ–¥–∞—Ä–∫–æ–≤ -->
                    <div class="glassmorphism rounded-2xl p-4 mb-4">
                        <h3 class="text-lg font-bold mb-3">üéÅ –í–∏—Ç—Ä–∏–Ω–∞ –ø–æ–¥–∞—Ä–∫–æ–≤</h3>
                        <div id="mobile-profile-showcase" class="grid mobile-grid-4 gap-3">
                            <!-- –í–∏—Ç—Ä–∏–Ω–∞ –ø–æ–¥–∞—Ä–∫–æ–≤ -->
                        </div>
                        <p id="mobile-no-showcase" class="text-gray-400 text-center py-4 text-sm">–ù–∞ –≤–∏—Ç—Ä–∏–Ω–µ –ø–æ–∫–∞ –Ω–µ—Ç –ø–æ–¥–∞—Ä–∫–æ–≤</p>
                    </div>
                    
                    <!-- –ò–Ω–≤–µ–Ω—Ç–∞—Ä—å -->
                    <div class="glassmorphism rounded-2xl p-4 mb-4">
                        <div class="flex items-center justify-between mb-3">
                            <h3 class="text-lg font-bold">üéí –ú–æ–π –∏–Ω–≤–µ–Ω—Ç–∞—Ä—å</h3>
                            <button data-section="shop" class="text-blue-400 text-sm flex items-center tap-highlight">
                                <i class="fas fa-store mr-1"></i> –ú–∞–≥–∞–∑–∏–Ω
                            </button>
                        </div>
                        <div id="mobile-inventory-items" class="space-y-2 max-h-60 overflow-y-auto">
                            <!-- –ò–Ω–≤–µ–Ω—Ç–∞—Ä—å -->
                        </div>
                    </div>
                    
                    <!-- –ü–æ—Å—Ç—ã –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è -->
                    <div class="glassmorphism rounded-2xl p-4">
                        <h3 class="text-lg font-bold mb-3">üìù –ú–æ–∏ –ø–æ—Å—Ç—ã</h3>
                        <div id="mobile-profile-posts" class="space-y-3">
                            <!-- –ü–æ—Å—Ç—ã –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è -->
                        </div>
                    </div>
                </div>

                <!-- –î—Ä—É–∑—å—è (–º–æ–±–∏–ª—å–Ω–∞—è –≤–µ—Ä—Å–∏—è) -->
                <div id="mobile-friends-content" class="section-content p-4">
                    <div class="glassmorphism rounded-2xl p-4">
                        <div class="text-center mb-6">
                            <div class="w-16 h-16 rounded-full bg-slate-800 flex items-center justify-center text-2xl mb-4 mx-auto">
                                <i class="fas fa-users text-blue-400"></i>
                            </div>
                            <h2 class="text-xl font-bold mb-2">–î—Ä—É–∑—å—è</h2>
                            <p class="text-gray-400 text-sm">–ù–∞–π–¥–∏—Ç–µ –Ω–æ–≤—ã—Ö –¥—Ä—É–∑–µ–π –∏ –æ–±—â–∞–π—Ç–µ—Å—å</p>
                        </div>
                        
                        <div class="mb-4">
                            <div class="flex space-x-2">
                                <input type="text" id="mobile-search-friend-input" class="flex-1 bg-slate-800/50 border border-slate-700 rounded-xl px-4 py-3 text-sm focus:outline-none focus:ring-2 focus:ring-blue-500" placeholder="–ü–æ–∏—Å–∫ –ø–æ –Ω–∏–∫–Ω–µ–π–º—É...">
                                <button id="mobile-search-friend-btn" class="btn-primary px-4 rounded-xl font-bold text-sm tap-highlight">
                                    <i class="fas fa-search"></i>
                                </button>
                            </div>
                        </div>
                        
                        <div id="mobile-search-results" class="hidden mb-4">
                            <!-- –†–µ–∑—É–ª—å—Ç–∞—Ç—ã –ø–æ–∏—Å–∫–∞ -->
                        </div>
                        
                        <div class="space-y-4">
                            <div class="glassmorphism rounded-xl p-3">
                                <h3 class="text-md font-bold mb-3 text-blue-300">–í–∞—à–∏ –¥—Ä—É–∑—å—è</h3>
                                <div id="mobile-friends-list" class="space-y-2">
                                    <!-- –°–ø–∏—Å–æ–∫ –¥—Ä—É–∑–µ–π -->
                                </div>
                            </div>
                            
                            <div class="glassmorphism rounded-xl p-3">
                                <h3 class="text-md font-bold mb-3 text-yellow-300">–ó–∞—è–≤–∫–∏ –≤ –¥—Ä—É–∑—å—è</h3>
                                <div id="mobile-friend-requests" class="space-y-2">
                                    <!-- –ó–∞—è–≤–∫–∏ -->
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- –ú–∞–≥–∞–∑–∏–Ω (–º–æ–±–∏–ª—å–Ω–∞—è –≤–µ—Ä—Å–∏—è) -->
                <div id="mobile-shop-content" class="section-content p-4">
                    <div class="glassmorphism rounded-2xl p-4">
                        <div class="flex items-center justify-between mb-6">
                            <div>
                                <h2 class="text-xl font-bold gradient-text">üéÅ –ú–∞–≥–∞–∑–∏–Ω</h2>
                                <p class="text-gray-400 text-sm">–ö—É–ø–∏—Ç–µ –ø–æ–¥–∞—Ä–∫–∏ –¥–ª—è —Å–µ–±—è –∏–ª–∏ –¥—Ä—É–∑–µ–π</p>
                            </div>
                            <div class="bg-slate-800/50 px-4 py-2 rounded-xl">
                                <span class="text-gray-400 text-xs mr-1">–ë–∞–ª–∞–Ω—Å:</span>
                                <span id="mobile-shop-balance" class="text-lg font-bold text-yellow-300">0 C</span>
                            </div>
                        </div>

                        <div id="mobile-gifts-shop" class="grid mobile-grid-2 gap-4">
                            <!-- –¢–æ–≤–∞—Ä—ã –º–∞–≥–∞–∑–∏–Ω–∞ -->
                        </div>
                    </div>
                </div>

                <!-- –ü–µ—Ä–µ–≤–æ–¥—ã (–º–æ–±–∏–ª—å–Ω–∞—è –≤–µ—Ä—Å–∏—è) -->
                <div id="mobile-transfers-content" class="section-content p-4">
                    <div class="glassmorphism rounded-2xl p-4">
                        <div class="text-center mb-6">
                            <div class="w-16 h-16 rounded-full bg-slate-800 flex items-center justify-center text-2xl mb-4 mx-auto">
                                <i class="fas fa-money-bill-transfer text-blue-400"></i>
                            </div>
                            <h2 class="text-xl font-bold mb-2">–ü–µ—Ä–µ–≤–æ–¥—ã Cowboy</h2>
                            <p class="text-gray-400 text-sm">–û—Ç–ø—Ä–∞–≤–ª—è–π—Ç–µ –≤–∞–ª—é—Ç—É –¥—Ä—É–∑—å—è–º –∏ –∑–Ω–∞–∫–æ–º—ã–º</p>
                        </div>
                        
                        <div class="bg-slate-800/30 rounded-xl p-4 mb-6">
                            <h4 class="font-bold mb-4 text-lg">–ù–æ–≤—ã–π –ø–µ—Ä–µ–≤–æ–¥</h4>
                            <div class="space-y-4">
                                <div>
                                    <label class="block text-sm font-medium mb-2">–ù–∏–∫–Ω–µ–π–º –ø–æ–ª—É—á–∞—Ç–µ–ª—è</label>
                                    <input type="text" id="mobile-transfer-to" class="w-full bg-slate-800/50 border border-slate-700 rounded-xl px-4 py-3 text-base focus:outline-none focus:ring-2 focus:ring-blue-500" placeholder="@username">
                                </div>
                                <div>
                                    <label class="block text-sm font-medium mb-2">–°—É–º–º–∞ (C)</label>
                                    <input type="number" id="mobile-transfer-amount" class="w-full bg-slate-800/50 border border-slate-700 rounded-xl px-4 py-3 text-base focus:outline-none focus:ring-2 focus:ring-blue-500" min="1" placeholder="10">
                                </div>
                                <div>
                                    <label class="block text-sm font-medium mb-2">–°–æ–æ–±—â–µ–Ω–∏–µ (–Ω–µ–æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ)</label>
                                    <input type="text" id="mobile-transfer-message" class="w-full bg-slate-800/50 border border-slate-700 rounded-xl px-4 py-3 text-base focus:outline-none focus:ring-2 focus:ring-blue-500" placeholder="–ó–∞ —á—Ç–æ –ø–µ—Ä–µ–≤–æ–¥">
                                </div>
                                <button id="mobile-make-transfer-btn" class="w-full btn-primary py-3 rounded-xl font-bold tap-highlight">
                                    –û—Ç–ø—Ä–∞–≤–∏—Ç—å –ø–µ—Ä–µ–≤–æ–¥
                                </button>
                            </div>
                        </div>
                        
                        <div>
                            <h4 class="font-bold mb-4 text-lg">üìä –ò—Å—Ç–æ—Ä–∏—è –ø–µ—Ä–µ–≤–æ–¥–æ–≤</h4>
                            <div id="mobile-transfers-history" class="space-y-3 max-h-80 overflow-y-auto">
                                <!-- –ò—Å—Ç–æ—Ä–∏—è -->
                            </div>
                        </div>
                    </div>
                </div>

                <!-- –ê–¥–º–∏–Ω-–ø–∞–Ω–µ–ª—å (–º–æ–±–∏–ª—å–Ω–∞—è –≤–µ—Ä—Å–∏—è) -->
                <div id="mobile-admin-content" class="section-content p-4">
                    <div class="glassmorphism rounded-2xl p-4">
                        <div class="flex items-center mb-6">
                            <div class="w-12 h-12 rounded-full bg-gradient-to-r from-red-600 to-pink-500 flex items-center justify-center text-xl mr-3">
                                üëë
                            </div>
                            <div>
                                <h2 class="text-xl font-bold gradient-text">–ê–¥–º–∏–Ω-–ø–∞–Ω–µ–ª—å</h2>
                                <p class="text-gray-400 text-sm">–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Å–∏—Å—Ç–µ–º–æ–π</p>
                            </div>
                        </div>

                        <div class="space-y-4">
                            <div class="bg-slate-800/30 rounded-xl p-4">
                                <h3 class="font-bold mb-4 text-lg">üí∞ –ò–∑–º–µ–Ω–∏—Ç—å –±–∞–ª–∞–Ω—Å</h3>
                                <div class="space-y-4">
                                    <div>
                                        <label class="block text-sm font-medium mb-2">–ù–∏–∫–Ω–µ–π–º –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è</label>
                                        <input type="text" id="mobile-admin-username" class="w-full bg-slate-800/50 border border-slate-700 rounded-xl px-4 py-3 text-base focus:outline-none focus:ring-2 focus:ring-blue-500" placeholder="@username">
                                    </div>
                                    <div>
                                        <label class="block text-sm font-medium mb-2">–ù–æ–≤—ã–π –±–∞–ª–∞–Ω—Å (C)</label>
                                        <input type="number" id="mobile-admin-balance" class="w-full bg-slate-800/50 border border-slate-700 rounded-xl px-4 py-3 text-base focus:outline-none focus:ring-2 focus:ring-blue-500" placeholder="1000">
                                    </div>
                                    <button id="mobile-admin-set-balance-btn" class="w-full bg-gradient-to-r from-red-600 to-pink-500 hover:from-red-700 hover:to-pink-600 py-3 rounded-xl font-bold tap-highlight">
                                        –£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –±–∞–ª–∞–Ω—Å
                                    </button>
                                </div>
                            </div>

                            <div class="bg-slate-800/30 rounded-xl p-4">
                                <h3 class="font-bold mb-4 text-lg">üéØ –†–∞–∑–¥–∞—á–∞ –∫–ª–∞–Ω—É</h3>
                                <div class="space-y-4">
                                    <div>
                                        <label class="block text-sm font-medium mb-2">–í—ã–±–µ—Ä–∏—Ç–µ –∫–ª–∞–Ω</label>
                                        <select id="mobile-admin-clan" class="w-full bg-slate-800/50 border border-slate-700 rounded-xl px-4 py-3 text-base focus:outline-none focus:ring-2 focus:ring-blue-500">
                                            <option value="ü¶Å">ü¶Å –õ—å–≤—ã</option>
                                            <option value="ü¶Ö">ü¶Ö –û—Ä–ª—ã</option>
                                            <option value="üê∫">üê∫ –í–æ–ª–∫–∏</option>
                                            <option value="üêª">üêª –ú–µ–¥–≤–µ–¥–∏</option>
                                            <option value="ü¶ä">ü¶ä –õ–∏—Å—ã</option>
                                            <option value="üêØ">üêØ –¢–∏–≥—Ä—ã</option>
                                            <option value="ü¶â">ü¶â –°–æ–≤—ã</option>
                                            <option value="üêç">üêç –ó–º–µ–∏</option>
                                        </select>
                                    </div>
                                    <div>
                                        <label class="block text-sm font-medium mb-2">–°—É–º–º–∞ –∫–∞–∂–¥–æ–º—É —É—á–∞—Å—Ç–Ω–∏–∫—É (C)</label>
                                        <input type="number" id="mobile-admin-clan-amount" class="w-full bg-slate-800/50 border border-slate-700 rounded-xl px-4 py-3 text-base focus:outline-none focus:ring-2 focus:ring-blue-500" placeholder="100">
                                    </div>
                                    <button id="mobile-admin-distribute-btn" class="w-full bg-gradient-to-r from-green-600 to-emerald-500 hover:from-green-700 hover:to-emerald-600 py-3 rounded-xl font-bold tap-highlight">
                                        –†–∞–∑–¥–∞—Ç—å –∫–ª–∞–Ω—É
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- –ú–æ–±–∏–ª—å–Ω–∞—è –Ω–∞–≤–∏–≥–∞—Ü–∏—è –≤–Ω–∏–∑—É -->
            <div class="mobile-bottom-nav">
                <div class="flex justify-between">
                    <button data-section="feed" class="mobile-bottom-nav-btn active flex flex-col items-center tap-highlight">
                        <i class="fas fa-newspaper text-lg mb-1"></i>
                        <span>–õ–µ–Ω—Ç–∞</span>
                    </button>
                    <button data-section="messenger" class="mobile-bottom-nav-btn flex flex-col items-center tap-highlight">
                        <i class="fas fa-comments text-lg mb-1"></i>
                        <span>–ß–∞—Ç</span>
                    </button>
                    <button data-section="profile" class="mobile-bottom-nav-btn flex flex-col items-center tap-highlight">
                        <i class="fas fa-user text-lg mb-1"></i>
                        <span>–ü—Ä–æ—Ñ–∏–ª—å</span>
                    </button>
                    <button data-section="friends" class="mobile-bottom-nav-btn flex flex-col items-center tap-highlight">
                        <i class="fas fa-users text-lg mb-1"></i>
                        <span>–î—Ä—É–∑—å—è</span>
                    </button>
                    <button data-section="shop" class="mobile-bottom-nav-btn flex flex-col items-center tap-highlight">
                        <i class="fas fa-store text-lg mb-1"></i>
                        <span>–ú–∞–≥–∞–∑–∏–Ω</span>
                    </button>
                </div>
            </div>

            <!-- FAB –¥–ª—è –±—ã—Å—Ç—Ä–æ–≥–æ —Å–æ–∑–¥–∞–Ω–∏—è –ø–æ—Å—Ç–∞ -->
            <button id="mobile-fab" class="mobile-fab tap-highlight hidden">
                <i class="fas fa-plus"></i>
            </button>
        </div>
    </div>

    <!-- –ú–æ–¥–∞–ª—å–Ω—ã–µ –æ–∫–Ω–∞ -->
    <div id="modals-container"></div>

    <script>
        // ===========================================
        // –û–°–ù–û–í–ù–´–ï –ù–ê–°–¢–†–û–ô–ö–ò –î–õ–Ø –ú–û–ë–ò–õ–¨–ù–´–• –£–°–¢–†–û–ô–°–¢–í
        // ===========================================
        const isMobile = /iPhone|iPad|iPod|Android|webOS|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent);
        
        // ===========================================
        // FIREBASE –ò–ù–ò–¶–ò–ê–õ–ò–ó–ê–¶–ò–Ø
        // ===========================================
        // –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è Firebase
        const firebaseConfig = {
            apiKey: "AIzaSyDVmLbWo9zabxoh_nBmin3ft55idyis",
            authDomain: "cowboy-messenger-8a9ab.firebaseapp.com",
            projectId: "cowboy-messenger-8a9ab",
            storageBucket: "cowboy-messenger-8a9ab.firebasestorage.app",
            messagingSenderId: "988951372605",
            appId: "1:988951372605:web:d66917e00f0c8c0c142b54",
            measurementId: "G-TTEXNYQ6E8"
        };

        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è Firebase
        try {
            const app = firebase.initializeApp(firebaseConfig);
            const db = firebase.firestore();
            const auth = firebase.auth();
            console.log("Firebase —É—Å–ø–µ—à–Ω–æ –ø–æ–¥–∫–ª—é—á–µ–Ω!");
            
            // –≠–∫—Å–ø–æ—Ä—Ç–∏—Ä—É–µ–º Firebase –æ–±—ä–µ–∫—Ç—ã –¥–ª—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è
            window.firebaseApp = app;
            window.firestoreDB = db;
            window.firebaseAuth = auth;
        } catch (error) {
            console.error("–û—à–∏–±–∫–∞ –ø—Ä–∏ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–∏ Firebase:", error);
            // –°–æ–∑–¥–∞–µ–º –∑–∞–≥–ª—É—à–∫–∏ –¥–ª—è –æ—Ñ–ª–∞–π–Ω —Ä–µ–∂–∏–º–∞
            window.firebaseApp = null;
            window.firestoreDB = {
                collection: () => ({ 
                    doc: () => ({ 
                        get: () => Promise.reject("Firebase –Ω–µ –ø–æ–¥–∫–ª—é—á–µ–Ω"),
                        set: () => Promise.reject("Firebase –Ω–µ –ø–æ–¥–∫–ª—é—á–µ–Ω"),
                        update: () => Promise.reject("Firebase –Ω–µ –ø–æ–¥–∫–ª—é—á–µ–Ω")
                    }),
                    add: () => Promise.reject("Firebase –Ω–µ –ø–æ–¥–∫–ª—é—á–µ–Ω"),
                    get: () => Promise.reject("Firebase –Ω–µ –ø–æ–¥–∫–ª—é—á–µ–Ω"),
                    onSnapshot: () => () => {}
                })
            };
            window.firebaseAuth = {
                currentUser: null,
                signInWithEmailAndPassword: () => Promise.reject("Firebase –Ω–µ –ø–æ–¥–∫–ª—é—á–µ–Ω"),
                createUserWithEmailAndPassword: () => Promise.reject("Firebase –Ω–µ –ø–æ–¥–∫–ª—é—á–µ–Ω"),
                signOut: () => Promise.reject("Firebase –Ω–µ –ø–æ–¥–∫–ª—é—á–µ–Ω"),
                onAuthStateChanged: () => () => {}
            };
        }

        // ===========================================
        // –ì–õ–û–ë–ê–õ–¨–ù–´–ï –ü–ï–†–ï–ú–ï–ù–ù–´–ï
        // ===========================================
        let currentUser = null;
        let selectedMedia = [];
        let activeChatId = null;
        let activeChatUser = null;
        let unsubscribeFunctions = {}; // –î–ª—è –æ—Ç–ø–∏—Å–∫–∏ –æ—Ç Firebase listeners

        // –°–æ—Å—Ç–æ—è–Ω–∏–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
        const state = {
            selectedClan: null,
            activeModal: null,
            currentSection: 'feed',
            isMobile: isMobile,
            onlineMode: false
        };

        // –õ–æ–∫–∞–ª—å–Ω–æ–µ —Ö—Ä–∞–Ω–∏–ª–∏—â–µ –¥–ª—è –æ—Ñ–ª–∞–π–Ω —Ä–µ–∂–∏–º–∞
        const LOCAL_STORAGE_KEYS = {
            USERS: 'cowboy_users',
            POSTS: 'cowboy_posts',
            CHATS: 'cowboy_chats',
            MESSAGES: 'cowboy_messages',
            GIFTS: 'cowboy_gifts',
            TRANSACTIONS: 'cowboy_transactions',
            FRIEND_REQUESTS: 'cowboy_friend_requests',
            FRIENDSHIPS: 'cowboy_friendships',
            NOTIFICATIONS: 'cowboy_notifications',
            CURRENT_USER: 'cowboy_current_user'
        };

        // –ü—Ä–µ–¥–∑–∞–ø–æ–ª–Ω–µ–Ω–Ω—ã–µ –ø–æ–¥–∞—Ä–∫–∏
        const DEFAULT_GIFTS = [
            { id: 1, name: "üåπ –†–æ–∑–∞", price: 10, emoji: "üåπ", description: "–ö–ª–∞—Å—Å–∏—á–µ—Å–∫–∏–π –ø–æ–¥–∞—Ä–æ–∫", purchases: 0, popular: 50 },
            { id: 2, name: "üöó –ú–∞—à–∏–Ω–∞", price: 500, emoji: "üöó", description: "–°—Ç–∏–ª—å–Ω—ã–π —Ç—Ä–∞–Ω—Å–ø–æ—Ä—Ç", purchases: 0, popular: 30 },
            { id: 3, name: "üöÄ –†–∞–∫–µ—Ç–∞", price: 1000, emoji: "üöÄ", description: "–î–ª—è –∫–æ—Å–º–∏—á–µ—Å–∫–∏—Ö –∞–º–±–∏—Ü–∏–π", purchases: 0, popular: 20 },
            { id: 4, name: "üèÜ –ö—É–±–æ–∫", price: 300, emoji: "üèÜ", description: "–ó–∞ –ø–æ–±–µ–¥—ã", purchases: 0, popular: 40 },
            { id: 5, name: "üíé –ê–ª–º–∞–∑", price: 800, emoji: "üíé", description: "–†–æ—Å–∫–æ—à–Ω—ã–π –ø–æ–¥–∞—Ä–æ–∫", purchases: 0, popular: 25 },
            { id: 6, name: "üé∏ –ì–∏—Ç–∞—Ä–∞", price: 200, emoji: "üé∏", description: "–ú—É–∑—ã–∫–∞–ª—å–Ω—ã–π –ø–æ–¥–∞—Ä–æ–∫", purchases: 0, popular: 35 },
            { id: 7, name: "üëë –ö–æ—Ä–æ–Ω–∞", price: 1500, emoji: "üëë", description: "–ö–æ—Ä–æ–ª–µ–≤—Å–∫–∏–π –ø–æ–¥–∞—Ä–æ–∫", purchases: 0, popular: 15 },
            { id: 8, name: "üõ°Ô∏è –©–∏—Ç", price: 400, emoji: "üõ°Ô∏è", description: "–î–ª—è –∑–∞—â–∏—Ç—ã", purchases: 0, popular: 28 }
        ];

        // ===========================================
        // –ò–ù–ò–¶–ò–ê–õ–ò–ó–ê–¶–ò–Ø –ü–†–ò–õ–û–ñ–ï–ù–ò–Ø
        // ===========================================
        document.addEventListener('DOMContentLoaded', function() {
            console.log("–î–æ–∫—É–º–µ–Ω—Ç –∑–∞–≥—Ä—É–∂–µ–Ω, —É—Å—Ç—Ä–æ–π—Å—Ç–≤–æ:", isMobile ? "–ú–æ–±–∏–ª—å–Ω–æ–µ" : "–î–µ—Å–∫—Ç–æ–ø");
            
            // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ–º –¥–∞–Ω–Ω—ã–µ
            initData();
            
            // –ü—Ä–æ–≤–µ—Ä—è–µ–º –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ Firebase
            checkFirebaseConnection();
            
            // –ù–∞—Å—Ç—Ä–∞–∏–≤–∞–µ–º –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ —Å–æ–±—ã—Ç–∏–π
            setTimeout(() => {
                setupEventListeners();
            }, 100);
        });

        function checkFirebaseConnection() {
            if (window.firebaseApp) {
                state.onlineMode = true;
                console.log("Firebase –ø–æ–¥–∫–ª—é—á–µ–Ω, —Ä–∞–±–æ—Ç–∞–µ–º –≤ ONLINE —Ä–µ–∂–∏–º–µ");
                
                // –ü—Ä–æ–≤–µ—Ä—è–µ–º –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—é Firebase
                firebaseAuth.onAuthStateChanged((user) => {
                    if (user) {
                        console.log("Firebase –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–∞–π–¥–µ–Ω:", user.email);
                        // –ó–∞–≥—Ä—É–∂–∞–µ–º –¥–∞–Ω–Ω—ã–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –∏–∑ Firestore
                        loadUserFromFirestore(user.uid);
                    } else {
                        console.log("Firebase –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–µ –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω");
                        checkLocalUser();
                    }
                });
            } else {
                state.onlineMode = false;
                console.log("Firebase –Ω–µ –ø–æ–¥–∫–ª—é—á–µ–Ω, —Ä–∞–±–æ—Ç–∞–µ–º –≤ OFFLINE —Ä–µ–∂–∏–º–µ");
                checkLocalUser();
            }
        }

        function checkLocalUser() {
            const savedUser = localStorage.getItem(LOCAL_STORAGE_KEYS.CURRENT_USER);
            if (savedUser) {
                try {
                    currentUser = JSON.parse(savedUser);
                    console.log("–õ–æ–∫–∞–ª—å–Ω—ã–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–∞–π–¥–µ–Ω:", currentUser?.username);
                    
                    if (isMobile) {
                        showMobileApp();
                    } else {
                        showApp();
                    }
                } catch (e) {
                    console.error("–û—à–∏–±–∫–∞ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è:", e);
                    if (isMobile) {
                        showMobileAuth();
                    } else {
                        showAuth();
                    }
                }
            } else {
                console.log("–ù–µ—Ç —Å–æ—Ö—Ä–∞–Ω–µ–Ω–Ω–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è, –ø–æ–∫–∞–∑—ã–≤–∞–µ–º —ç–∫—Ä–∞–Ω –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏");
                if (isMobile) {
                    showMobileAuth();
                } else {
                    showAuth();
                }
            }
        }

        function initData() {
            console.log("–ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –¥–∞–Ω–Ω—ã—Ö...");
            
            // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ–º –ø–æ–¥–∞—Ä–∫–∏ –µ—Å–ª–∏ –∏—Ö –Ω–µ—Ç
            const savedGifts = localStorage.getItem(LOCAL_STORAGE_KEYS.GIFTS);
            if (!savedGifts) {
                localStorage.setItem(LOCAL_STORAGE_KEYS.GIFTS, JSON.stringify(DEFAULT_GIFTS));
                console.log("–ü–æ–¥–∞—Ä–∫–∏ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω—ã");
            }
        }

        // ===========================================
        // FIREBASE –§–£–ù–ö–¶–ò–ò
        // ===========================================
        async function loadUserFromFirestore(userId) {
            try {
                const userDoc = await firestoreDB.collection('users').doc(userId).get();
                if (userDoc.exists) {
                    currentUser = userDoc.data();
                    currentUser.id = userId;
                    localStorage.setItem(LOCAL_STORAGE_KEYS.CURRENT_USER, JSON.stringify(currentUser));
                    
                    console.log("–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –∑–∞–≥—Ä—É–∂–µ–Ω –∏–∑ Firestore:", currentUser.username);
                    
                    if (isMobile) {
                        showMobileApp();
                    } else {
                        showApp();
                    }
                    
                    // –ü–æ–¥–ø–∏—Å—ã–≤–∞–µ–º—Å—è –Ω–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
                    subscribeToUserUpdates(userId);
                } else {
                    console.log("–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–µ –Ω–∞–π–¥–µ–Ω –≤ Firestore");
                    checkLocalUser();
                }
            } catch (error) {
                console.error("–û—à–∏–±–∫–∞ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –∏–∑ Firestore:", error);
                checkLocalUser();
            }
        }

        async function saveUserToFirestore(userData) {
            if (!state.onlineMode) return;
            
            try {
                await firestoreDB.collection('users').doc(userData.id).set(userData, { merge: true });
                console.log("–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —Å–æ—Ö—Ä–∞–Ω–µ–Ω –≤ Firestore");
            } catch (error) {
                console.error("–û—à–∏–±–∫–∞ –ø—Ä–∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –≤ Firestore:", error);
            }
        }

        async function createPostInFirestore(postData) {
            if (!state.onlineMode) return;
            
            try {
                const postRef = await firestoreDB.collection('posts').add({
                    ...postData,
                    createdAt: firebase.firestore.FieldValue.serverTimestamp(),
                    updatedAt: firebase.firestore.FieldValue.serverTimestamp()
                });
                console.log("–ü–æ—Å—Ç —Å–æ—Ö—Ä–∞–Ω–µ–Ω –≤ Firestore —Å ID:", postRef.id);
                return postRef.id;
            } catch (error) {
                console.error("–û—à–∏–±–∫–∞ –ø—Ä–∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–∏ –ø–æ—Å—Ç–∞ –≤ Firestore:", error);
                return null;
            }
        }

        async function sendMessageToFirestore(messageData) {
            if (!state.onlineMode) return;
            
            try {
                await firestoreDB.collection('chats').doc(messageData.chatId.toString())
                    .collection('messages').add({
                        ...messageData,
                        createdAt: firebase.firestore.FieldValue.serverTimestamp()
                    });
                console.log("–°–æ–æ–±—â–µ–Ω–∏–µ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–æ –≤ Firestore");
            } catch (error) {
                console.error("–û—à–∏–±–∫–∞ –ø—Ä–∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–∏ —Å–æ–æ–±—â–µ–Ω–∏—è –≤ Firestore:", error);
            }
        }

        function subscribeToUserUpdates(userId) {
            if (!state.onlineMode) return;
            
            if (unsubscribeFunctions.userUpdates) {
                unsubscribeFunctions.userUpdates();
            }
            
            unsubscribeFunctions.userUpdates = firestoreDB.collection('users').doc(userId)
                .onSnapshot((doc) => {
                    if (doc.exists) {
                        const updatedUser = doc.data();
                        currentUser = { ...currentUser, ...updatedUser };
                        localStorage.setItem(LOCAL_STORAGE_KEYS.CURRENT_USER, JSON.stringify(currentUser));
                        updateMobileHeader();
                        console.log("–î–∞–Ω–Ω—ã–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –æ–±–Ω–æ–≤–ª–µ–Ω—ã –∏–∑ Firestore");
                    }
                }, (error) => {
                    console.error("–û—à–∏–±–∫–∞ –ø—Ä–∏ –ø–æ–¥–ø–∏—Å–∫–µ –Ω–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è:", error);
                });
        }

        function subscribeToPosts() {
            if (!state.onlineMode) return;
            
            if (unsubscribeFunctions.posts) {
                unsubscribeFunctions.posts();
            }
            
            unsubscribeFunctions.posts = firestoreDB.collection('posts')
                .orderBy('createdAt', 'desc')
                .limit(50)
                .onSnapshot((snapshot) => {
                    const posts = [];
                    snapshot.forEach(doc => {
                        posts.push({ id: doc.id, ...doc.data() });
                    });
                    
                    // –°–æ—Ö—Ä–∞–Ω—è–µ–º –≤ –ª–æ–∫–∞–ª—å–Ω–æ–µ —Ö—Ä–∞–Ω–∏–ª–∏—â–µ –¥–ª—è –æ—Ñ–ª–∞–π–Ω —Ä–µ–∂–∏–º–∞
                    localStorage.setItem(LOCAL_STORAGE_KEYS.POSTS, JSON.stringify(posts));
                    
                    // –û–±–Ω–æ–≤–ª—è–µ–º –ª–µ–Ω—Ç—É
                    if (state.currentSection === 'feed' && state.isMobile) {
                        loadMobileFeed();
                    }
                    
                    console.log("–ü–æ—Å—Ç—ã –æ–±–Ω–æ–≤–ª–µ–Ω—ã –∏–∑ Firestore:", posts.length);
                }, (error) => {
                    console.error("–û—à–∏–±–∫–∞ –ø—Ä–∏ –ø–æ–¥–ø–∏—Å–∫–µ –Ω–∞ –ø–æ—Å—Ç—ã:", error);
                });
        }

        function subscribeToChat(chatId) {
            if (!state.onlineMode || !chatId) return;
            
            if (unsubscribeFunctions.chatMessages) {
                unsubscribeFunctions.chatMessages();
            }
            
            unsubscribeFunctions.chatMessages = firestoreDB.collection('chats').doc(chatId.toString())
                .collection('messages')
                .orderBy('createdAt', 'asc')
                .onSnapshot((snapshot) => {
                    const messages = [];
                    snapshot.forEach(doc => {
                        messages.push({ id: doc.id, ...doc.data() });
                    });
                    
                    // –û–±–Ω–æ–≤–ª—è–µ–º —Å–æ–æ–±—â–µ–Ω–∏—è –≤ —á–∞—Ç–µ
                    if (activeChatId === chatId && state.isMobile) {
                        updateChatMessages(messages);
                    }
                    
                    console.log("–°–æ–æ–±—â–µ–Ω–∏—è –æ–±–Ω–æ–≤–ª–µ–Ω—ã –∏–∑ Firestore:", messages.length);
                }, (error) => {
                    console.error("–û—à–∏–±–∫–∞ –ø—Ä–∏ –ø–æ–¥–ø–∏—Å–∫–µ –Ω–∞ —Å–æ–æ–±—â–µ–Ω–∏—è —á–∞—Ç–∞:", error);
                });
        }

        // ===========================================
        // –§–£–ù–ö–¶–ò–ò –ê–í–¢–û–†–ò–ó–ê–¶–ò–ò (ONLINE/OFFLINE)
        // ===========================================
        async function register(isMobile = false) {
            console.log("–ù–∞—á–∞–ª–æ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏...", isMobile ? "(–º–æ–±–∏–ª—å–Ω–∞—è)" : "(–¥–µ—Å–∫—Ç–æ–ø)");
            
            let clan, username, password, firstName, lastName;
            
            if (isMobile) {
                clan = state.selectedClan;
                username = document.getElementById('mobile-reg-username')?.value.trim() || '';
                password = document.getElementById('mobile-reg-password')?.value || '';
                firstName = document.getElementById('mobile-reg-firstname')?.value.trim() || '';
                lastName = document.getElementById('mobile-reg-lastname')?.value.trim() || '';
            } else {
                clan = state.selectedClan;
                username = document.getElementById('reg-username')?.value.trim() || '';
                password = document.getElementById('reg-password')?.value || '';
                firstName = document.getElementById('reg-firstname')?.value.trim() || '';
                lastName = document.getElementById('reg-lastname')?.value.trim() || '';
            }

            console.log("–î–∞–Ω–Ω—ã–µ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏:", { clan, username, password: '***', firstName, lastName });

            // –í–∞–ª–∏–¥–∞—Ü–∏—è
            if (!clan) {
                showNotification('–í—ã–±–µ—Ä–∏—Ç–µ –∫–ª–∞–Ω!', 'error');
                if (isMobile) {
                    const clanError = document.getElementById('mobile-clan-error');
                    if (clanError) clanError.classList.remove('hidden');
                }
                return;
            }

            if (!username.startsWith('@') || username.length < 3) {
                showNotification('–ù–∏–∫–Ω–µ–π–º –¥–æ–ª–∂–µ–Ω –Ω–∞—á–∏–Ω–∞—Ç—å—Å—è —Å @ –∏ —Å–æ–¥–µ—Ä–∂–∞—Ç—å –º–∏–Ω–∏–º—É–º 3 —Å–∏–º–≤–æ–ª–∞', 'error');
                return;
            }

            if (!/^@[a-zA-Z0-9_-]+$/.test(username)) {
                showNotification('–ù–∏–∫–Ω–µ–π–º –º–æ–∂–µ—Ç —Å–æ–¥–µ—Ä–∂–∞—Ç—å —Ç–æ–ª—å–∫–æ –∞–Ω–≥–ª–∏–π—Å–∫–∏–µ –±—É–∫–≤—ã, —Ü–∏—Ñ—Ä—ã, _ –∏ -', 'error');
                return;
            }

            // –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—É—â–µ—Å—Ç–≤—É—é—â–µ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
            if (state.onlineMode) {
                // –ü—Ä–æ–≤–µ—Ä–∫–∞ –≤ Firestore
                try {
                    const usersSnapshot = await firestoreDB.collection('users').where('username', '==', username).get();
                    if (!usersSnapshot.empty) {
                        showNotification('–≠—Ç–æ—Ç –Ω–∏–∫–Ω–µ–π–º —É–∂–µ –∑–∞–Ω—è—Ç', 'error');
                        return;
                    }
                } catch (error) {
                    console.error("–û—à–∏–±–∫–∞ –ø—Ä–∏ –ø—Ä–æ–≤–µ—Ä–∫–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –≤ Firestore:", error);
                }
            } else {
                // –ü—Ä–æ–≤–µ—Ä–∫–∞ –≤ –ª–æ–∫–∞–ª—å–Ω–æ–º —Ö—Ä–∞–Ω–∏–ª–∏—â–µ
                const savedUsers = JSON.parse(localStorage.getItem(LOCAL_STORAGE_KEYS.USERS)) || [];
                if (savedUsers.find(u => u.username === username)) {
                    showNotification('–≠—Ç–æ—Ç –Ω–∏–∫–Ω–µ–π–º —É–∂–µ –∑–∞–Ω—è—Ç', 'error');
                    return;
                }
            }

            if (password.length < 8) {
                showNotification('–ü–∞—Ä–æ–ª—å –¥–æ–ª–∂–µ–Ω —Å–æ–¥–µ—Ä–∂–∞—Ç—å –º–∏–Ω–∏–º—É–º 8 —Å–∏–º–≤–æ–ª–æ–≤', 'error');
                return;
            }

            // –°–æ–∑–¥–∞–µ–º –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
            const userId = Date.now().toString();
            const newUser = {
                id: userId,
                username,
                password, // –í —Ä–µ–∞–ª—å–Ω–æ–º –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–∏ –ø–∞—Ä–æ–ª—å –Ω—É–∂–Ω–æ —Ö—ç—à–∏—Ä–æ–≤–∞—Ç—å!
                firstName: firstName || '',
                lastName: lastName || '',
                clan,
                balance: username === '@karkarich' ? 1000000000 : 1000,
                avatar: clan,
                createdAt: new Date().toISOString(),
                inventory: [],
                showcase: [],
                posts: [],
                friends: [],
                email: `${username.replace('@', '')}@cowboy.com` // –ì–µ–Ω–µ—Ä–∏—Ä—É–µ–º email –¥–ª—è Firebase
            };

            if (state.onlineMode) {
                try {
                    // –°–æ–∑–¥–∞–µ–º –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –≤ Firebase Auth
                    const userCredential = await firebaseAuth.createUserWithEmailAndPassword(
                        newUser.email,
                        password
                    );
                    
                    // –°–æ—Ö—Ä–∞–Ω—è–µ–º –≤ Firestore
                    await saveUserToFirestore(newUser);
                    
                    currentUser = newUser;
                    localStorage.setItem(LOCAL_STORAGE_KEYS.CURRENT_USER, JSON.stringify(currentUser));
                    
                    console.log("–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —Å–æ–∑–¥–∞–Ω –≤ Firebase:", userCredential.user.uid);
                    
                    if (isMobile) {
                        showMobileApp();
                    } else {
                        showApp();
                    }
                    
                    showNotification('–†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è —É—Å–ø–µ—à–Ω–∞! –î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å –≤ Cowboy Messenger!', 'success');
                    
                } catch (error) {
                    console.error("–û—à–∏–±–∫–∞ –ø—Ä–∏ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏ –≤ Firebase:", error);
                    showNotification('–û—à–∏–±–∫–∞ –ø—Ä–∏ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –ø–æ–∑–∂–µ.', 'error');
                    return;
                }
            } else {
                // –û—Ñ–ª–∞–π–Ω —Ä–µ–∂–∏–º
                const savedUsers = JSON.parse(localStorage.getItem(LOCAL_STORAGE_KEYS.USERS)) || [];
                savedUsers.push(newUser);
                localStorage.setItem(LOCAL_STORAGE_KEYS.USERS, JSON.stringify(savedUsers));
                
                currentUser = newUser;
                localStorage.setItem(LOCAL_STORAGE_KEYS.CURRENT_USER, JSON.stringify(currentUser));
                
                if (isMobile) {
                    showMobileApp();
                } else {
                    showApp();
                }
                
                showNotification('–†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è —É—Å–ø–µ—à–Ω–∞! –î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å –≤ Cowboy Messenger!', 'success');
            }

            // –û—á–∏—â–∞–µ–º —Ñ–æ—Ä–º—É
            if (isMobile) {
                document.getElementById('mobile-reg-username').value = '';
                document.getElementById('mobile-reg-password').value = '';
                document.getElementById('mobile-reg-firstname').value = '';
                document.getElementById('mobile-reg-lastname').value = '';
                state.selectedClan = null;
                document.querySelectorAll('#mobile-clan-selection .clan-btn').forEach(btn => {
                    btn.classList.remove('clan-selected');
                });
            }
            
            // –ü–æ–¥–ø–∏—Å—ã–≤–∞–µ–º—Å—è –Ω–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è
            if (state.onlineMode) {
                subscribeToPosts();
            }
        }

        async function login(isMobile = false) {
            console.log("–ü–æ–ø—ã—Ç–∫–∞ –≤—Ö–æ–¥–∞...", isMobile ? "(–º–æ–±–∏–ª—å–Ω–∞—è)" : "(–¥–µ—Å–∫—Ç–æ–ø)");
            
            let username, password;
            
            if (isMobile) {
                username = document.getElementById('mobile-login-username')?.value.trim() || '';
                password = document.getElementById('mobile-login-password')?.value || '';
            } else {
                username = document.getElementById('login-username')?.value.trim() || '';
                password = document.getElementById('login-password')?.value || '';
            }

            console.log("–í—Ö–æ–¥ —Å –¥–∞–Ω–Ω—ã–º–∏:", { username, password: '***' });

            if (state.onlineMode) {
                // –û–Ω–ª–∞–π–Ω —Ä–µ–∂–∏–º: –ø—Ä–æ–≤–µ—Ä–∫–∞ —á–µ—Ä–µ–∑ Firebase
                try {
                    const email = `${username.replace('@', '')}@cowboy.com`;
                    const userCredential = await firebaseAuth.signInWithEmailAndPassword(email, password);
                    
                    // –ó–∞–≥—Ä—É–∂–∞–µ–º –¥–∞–Ω–Ω—ã–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –∏–∑ Firestore
                    await loadUserFromFirestore(userCredential.user.uid);
                    
                    showNotification('–í—Ö–æ–¥ –≤—ã–ø–æ–ª–Ω–µ–Ω —É—Å–ø–µ—à–Ω–æ!', 'success');
                    
                    // –ü–æ–¥–ø–∏—Å—ã–≤–∞–µ–º—Å—è –Ω–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è
                    subscribeToPosts();
                    
                } catch (error) {
                    console.error("–û—à–∏–±–∫–∞ –ø—Ä–∏ –≤—Ö–æ–¥–µ –≤ Firebase:", error);
                    showNotification('–ù–µ–≤–µ—Ä–Ω—ã–π –Ω–∏–∫–Ω–µ–π–º –∏–ª–∏ –ø–∞—Ä–æ–ª—å', 'error');
                    return;
                }
            } else {
                // –û—Ñ–ª–∞–π–Ω —Ä–µ–∂–∏–º: –ø—Ä–æ–≤–µ—Ä–∫–∞ –≤ –ª–æ–∫–∞–ª—å–Ω–æ–º —Ö—Ä–∞–Ω–∏–ª–∏—â–µ
                const savedUsers = JSON.parse(localStorage.getItem(LOCAL_STORAGE_KEYS.USERS)) || [];
                const user = savedUsers.find(u => u.username === username && u.password === password);
                
                if (user) {
                    console.log("–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–∞–π–¥–µ–Ω:", user.username);
                    currentUser = user;
                    localStorage.setItem(LOCAL_STORAGE_KEYS.CURRENT_USER, JSON.stringify(currentUser));
                    
                    if (isMobile) {
                        showMobileApp();
                    } else {
                        showApp();
                    }
                    
                    showNotification('–í—Ö–æ–¥ –≤—ã–ø–æ–ª–Ω–µ–Ω —É—Å–ø–µ—à–Ω–æ!', 'success');
                } else {
                    console.log("–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–µ –Ω–∞–π–¥–µ–Ω –∏–ª–∏ –Ω–µ–≤–µ—Ä–Ω—ã–π –ø–∞—Ä–æ–ª—å");
                    showNotification('–ù–µ–≤–µ—Ä–Ω—ã–π –Ω–∏–∫–Ω–µ–π–º –∏–ª–∏ –ø–∞—Ä–æ–ª—å', 'error');
                }
            }

            // –û—á–∏—â–∞–µ–º —Ñ–æ—Ä–º—É
            if (isMobile) {
                document.getElementById('mobile-login-username').value = '';
                document.getElementById('mobile-login-password').value = '';
            }
        }

        async function logout() {
            console.log("–í—ã—Ö–æ–¥ –∏–∑ —Å–∏—Å—Ç–µ–º—ã");
            
            // –û—Ç–ø–∏—Å—ã–≤–∞–µ–º—Å—è –æ—Ç –≤—Å–µ—Ö listeners
            Object.values(unsubscribeFunctions).forEach(unsubscribe => {
                if (typeof unsubscribe === 'function') {
                    unsubscribe();
                }
            });
            unsubscribeFunctions = {};
            
            if (state.onlineMode) {
                try {
                    await firebaseAuth.signOut();
                } catch (error) {
                    console.error("–û—à–∏–±–∫–∞ –ø—Ä–∏ –≤—ã—Ö–æ–¥–µ –∏–∑ Firebase:", error);
                }
            }
            
            currentUser = null;
            localStorage.removeItem(LOCAL_STORAGE_KEYS.CURRENT_USER);
            
            if (state.isMobile) {
                showMobileAuth();
            } else {
                showAuth();
            }
            
            showNotification('–í—ã –≤—ã—à–ª–∏ –∏–∑ —Å–∏—Å—Ç–µ–º—ã', 'info');
        }

        // ===========================================
        // –§–£–ù–ö–¶–ò–ò –†–ê–ë–û–¢–´ –° –ü–û–°–¢–ê–ú–ò (ONLINE/OFFLINE)
        // ===========================================
        async function createPost(isMobile = false) {
            if (!currentUser) return;
            
            let content, mediaInput;
            
            if (isMobile) {
                content = document.getElementById('mobile-post-content')?.value.trim() || '';
                mediaInput = document.getElementById('mobile-post-media');
            } else {
                content = document.getElementById('post-content')?.value.trim() || '';
                mediaInput = document.getElementById('post-media');
            }
            
            if (!content && selectedMedia.length === 0) {
                showNotification('–î–æ–±–∞–≤—å—Ç–µ —Ç–µ–∫—Å—Ç –∏–ª–∏ –º–µ–¥–∏–∞—Ñ–∞–π–ª—ã', 'error');
                return;
            }
            
            const newPost = {
                userId: currentUser.id,
                username: currentUser.username,
                userAvatar: currentUser.avatar,
                userClan: currentUser.clan,
                content: content,
                media: selectedMedia,
                likes: [],
                comments: [],
                likesCount: 0,
                commentsCount: 0,
                createdAt: new Date().toISOString()
            };
            
            if (state.onlineMode) {
                // –°–æ—Ö—Ä–∞–Ω—è–µ–º –≤ Firestore
                const postId = await createPostInFirestore(newPost);
                if (postId) {
                    newPost.id = postId;
                    
                    // –û–±–Ω–æ–≤–ª—è–µ–º —Å—á–µ—Ç—á–∏–∫ –ø–æ—Å—Ç–æ–≤ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
                    currentUser.postsCount = (currentUser.postsCount || 0) + 1;
                    await saveUserToFirestore(currentUser);
                }
            } else {
                // –û—Ñ–ª–∞–π–Ω —Ä–µ–∂–∏–º: —Å–æ—Ö—Ä–∞–Ω—è–µ–º –≤ –ª–æ–∫–∞–ª—å–Ω–æ–µ —Ö—Ä–∞–Ω–∏–ª–∏—â–µ
                newPost.id = Date.now();
                const savedPosts = JSON.parse(localStorage.getItem(LOCAL_STORAGE_KEYS.POSTS)) || [];
                savedPosts.push(newPost);
                localStorage.setItem(LOCAL_STORAGE_KEYS.POSTS, JSON.stringify(savedPosts));
            }
            
            // –û—á–∏—â–∞–µ–º —Ñ–æ—Ä–º—É
            if (isMobile) {
                document.getElementById('mobile-post-content').value = '';
                clearMedia(true);
            }
            
            // –û–±–Ω–æ–≤–ª—è–µ–º –ª–µ–Ω—Ç—É
            if (isMobile) {
                loadMobileFeed();
            }
            
            showNotification('–ü–æ—Å—Ç –æ–ø—É–±–ª–∏–∫–æ–≤–∞–Ω!', 'success');
            
            // –û–±–Ω–æ–≤–ª—è–µ–º —Å—á–µ—Ç—á–∏–∫ –ø–æ—Å—Ç–æ–≤ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
            if (isMobile) {
                updateMobileProfileStats();
            }
        }

        async function toggleLike(postId, isMobile = false) {
            if (!currentUser) return;
            
            if (state.onlineMode) {
                try {
                    const postRef = firestoreDB.collection('posts').doc(postId);
                    const postDoc = await postRef.get();
                    
                    if (postDoc.exists) {
                        const post = postDoc.data();
                        const likes = post.likes || [];
                        const likeIndex = likes.indexOf(currentUser.id);
                        
                        if (likeIndex === -1) {
                            // –î–æ–±–∞–≤–ª—è–µ–º –ª–∞–π–∫
                            likes.push(currentUser.id);
                            await postRef.update({
                                likes: likes,
                                likesCount: firebase.firestore.FieldValue.increment(1)
                            });
                            
                            // –°–æ–∑–¥–∞–µ–º —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ
                            if (post.userId !== currentUser.id) {
                                await createNotificationInFirestore({
                                    userId: post.userId,
                                    type: 'like',
                                    fromUserId: currentUser.id,
                                    fromUsername: currentUser.username,
                                    postId: postId,
                                    message: `${currentUser.username} –ª–∞–π–∫–Ω—É–ª(–∞) –≤–∞—à –ø–æ—Å—Ç`,
                                    read: false,
                                    createdAt: new Date().toISOString()
                                });
                            }
                        } else {
                            // –£–¥–∞–ª—è–µ–º –ª–∞–π–∫
                            likes.splice(likeIndex, 1);
                            await postRef.update({
                                likes: likes,
                                likesCount: firebase.firestore.FieldValue.increment(-1)
                            });
                        }
                    }
                } catch (error) {
                    console.error("–û—à–∏–±–∫–∞ –ø—Ä–∏ —Ä–∞–±–æ—Ç–µ —Å –ª–∞–π–∫–æ–º:", error);
                }
            } else {
                // –û—Ñ–ª–∞–π–Ω —Ä–µ–∂–∏–º
                const savedPosts = JSON.parse(localStorage.getItem(LOCAL_STORAGE_KEYS.POSTS)) || [];
                const postIndex = savedPosts.findIndex(p => p.id === postId);
                
                if (postIndex !== -1) {
                    const post = savedPosts[postIndex];
                    const likeIndex = post.likes.indexOf(currentUser.id);
                    
                    if (likeIndex === -1) {
                        post.likes.push(currentUser.id);
                    } else {
                        post.likes.splice(likeIndex, 1);
                    }
                    
                    localStorage.setItem(LOCAL_STORAGE_KEYS.POSTS, JSON.stringify(savedPosts));
                    
                    if (isMobile) {
                        loadMobileFeed();
                    }
                }
            }
            
            updateNotifications();
        }

        // ===========================================
        // –§–£–ù–ö–¶–ò–ò –ß–ê–¢–ê (ONLINE/OFFLINE)
        // ===========================================
        async function sendMessage(isMobile = false) {
            if (!currentUser || !activeChatId) return;
            
            let input, content;
            
            if (isMobile) {
                input = document.getElementById('mobile-message-input');
                content = input?.value.trim() || '';
            } else {
                input = document.getElementById('message-input');
                content = input?.value.trim() || '';
            }

            if (!content) return;

            const message = {
                id: Date.now().toString(),
                chatId: activeChatId,
                senderId: currentUser.id,
                senderUsername: currentUser.username,
                senderAvatar: currentUser.avatar,
                type: 'text',
                content: content,
                read: false,
                createdAt: new Date().toISOString()
            };

            if (state.onlineMode) {
                await sendMessageToFirestore(message);
                subscribeToChat(activeChatId);
            } else {
                // –û—Ñ–ª–∞–π–Ω —Ä–µ–∂–∏–º
                const savedMessages = JSON.parse(localStorage.getItem(LOCAL_STORAGE_KEYS.MESSAGES)) || [];
                savedMessages.push(message);
                localStorage.setItem(LOCAL_STORAGE_KEYS.MESSAGES, JSON.stringify(savedMessages));
            }

            // –û—á–∏—â–∞–µ–º –ø–æ–ª–µ –≤–≤–æ–¥–∞
            if (input) input.value = '';

            // –û–±–Ω–æ–≤–ª—è–µ–º —Å–æ–æ–±—â–µ–Ω–∏—è
            if (isMobile) {
                loadMobileChatMessages(activeChatId);
                loadMobileMessenger();
            }

            // –°–æ–∑–¥–∞–µ–º —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ
            if (activeChatUser) {
                createNotification({
                    id: Date.now(),
                    userId: activeChatUser.id,
                    type: 'message',
                    fromUserId: currentUser.id,
                    fromUsername: currentUser.username,
                    chatId: activeChatId,
                    message: `–ù–æ–≤–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ –æ—Ç ${currentUser.username}`,
                    read: false,
                    createdAt: new Date().toISOString()
                });
            }
        }

        // ===========================================
        // –§–£–ù–ö–¶–ò–ò –£–í–ï–î–û–ú–õ–ï–ù–ò–ô
        // ===========================================
        async function createNotificationInFirestore(notification) {
            if (!state.onlineMode) return;
            
            try {
                await firestoreDB.collection('notifications').add({
                    ...notification,
                    createdAt: firebase.firestore.FieldValue.serverTimestamp()
                });
            } catch (error) {
                console.error("–û—à–∏–±–∫–∞ –ø—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è:", error);
            }
        }

        // ===========================================
        // –§–£–ù–ö–¶–ò–ò –ú–û–ë–ò–õ–¨–ù–û–ì–û –ò–ù–¢–ï–†–§–ï–ô–°–ê
        // ===========================================
        function showMobileAuth() {
            const authScreen = document.getElementById('auth-screen');
            const mainApp = document.getElementById('main-app');
            
            if (authScreen) authScreen.classList.remove('hidden');
            if (mainApp) mainApp.classList.add('hidden');
            switchAuthTab('login', true);
        }

        function showMobileApp() {
            const authScreen = document.getElementById('auth-screen');
            const mainApp = document.getElementById('main-app');
            
            if (authScreen) authScreen.classList.add('hidden');
            if (mainApp) mainApp.classList.remove('hidden');
            
            updateMobileHeader();
            showMobileSection(state.currentSection);
            updateNotifications();
            
            if (state.onlineMode) {
                subscribeToPosts();
            }
        }

        function loadMobileFeed() {
            const container = document.getElementById('mobile-posts-container');
            if (!container) return;
            
            container.innerHTML = '';

            let posts = [];
            
            if (state.onlineMode) {
                // –ó–∞–≥—Ä—É–∂–∞–µ–º –∏–∑ –ª–æ–∫–∞–ª—å–Ω–æ–≥–æ —Ö—Ä–∞–Ω–∏–ª–∏—â–∞ (–∫–æ—Ç–æ—Ä–æ–µ –æ–±–Ω–æ–≤–ª—è–µ—Ç—Å—è —á–µ—Ä–µ–∑ Firebase listener)
                posts = JSON.parse(localStorage.getItem(LOCAL_STORAGE_KEYS.POSTS)) || [];
            } else {
                // –û—Ñ–ª–∞–π–Ω —Ä–µ–∂–∏–º
                posts = JSON.parse(localStorage.getItem(LOCAL_STORAGE_KEYS.POSTS)) || [];
            }

            // –°–æ—Ä—Ç–∏—Ä—É–µ–º –ø–æ –¥–∞—Ç–µ (–Ω–æ–≤—ã–µ –ø–µ—Ä–≤—ã–º–∏)
            posts = posts.sort((a, b) => new Date(b.createdAt) - new Date(a.createdAt));

            if (posts.length === 0) {
                container.innerHTML = `
                    <div class="glassmorphism rounded-2xl p-6 text-center">
                        <div class="w-16 h-16 rounded-full bg-slate-800 flex items-center justify-center text-2xl mx-auto mb-4">
                            ü§†
                        </div>
                        <h3 class="text-lg font-bold mb-2">–õ–µ–Ω—Ç–∞ –ø—É—Å—Ç–∞</h3>
                        <p class="text-gray-400 text-sm">–ë—É–¥—å—Ç–µ –ø–µ—Ä–≤—ã–º, –∫—Ç–æ –æ–ø—É–±–ª–∏–∫—É–µ—Ç —á—Ç–æ-—Ç–æ –∏–Ω—Ç–µ—Ä–µ—Å–Ω–æ–µ!</p>
                    </div>
                `;
                return;
            }

            posts.forEach(post => {
                const isLiked = post.likes && post.likes.includes(currentUser.id);
                const isAuthor = post.userId === currentUser.id;

                const postElement = document.createElement('div');
                postElement.className = 'glassmorphism rounded-2xl p-4 mb-4 fade-in';
                postElement.innerHTML = `
                    <div class="flex items-start justify-between mb-3">
                        <div class="flex items-center space-x-3">
                            <div class="w-10 h-10 rounded-full bg-gradient-to-r from-blue-500 to-cyan-400 flex items-center justify-center">
                                ${post.userClan || 'ü§†'}
                            </div>
                            <div>
                                <div class="font-bold text-sm">${post.username}</div>
                                <div class="text-xs text-gray-400">${formatDate(post.createdAt)}</div>
                            </div>
                        </div>
                        ${isAuthor ? `
                        <button class="post-menu-btn text-gray-400 tap-highlight" data-post-id="${post.id}">
                            <i class="fas fa-ellipsis-h"></i>
                        </button>` : ''}
                    </div>

                    <p class="mb-3 text-sm whitespace-pre-line">${post.content || ''}</p>

                    ${post.media && post.media.length > 0 ? `
                    <div class="mb-4">
                        <div class="grid ${post.media.length === 1 ? 'grid-cols-1' : 'grid-cols-2'} gap-2">
                            ${post.media.slice(0, 4).map((url, index) => {
                                if (url.includes('data:video')) {
                                    return `<video src="${url}" controls class="w-full h-40 object-cover rounded-lg"></video>`;
                                } else {
                                    return `<img src="${url}" class="post-image w-full h-40 object-cover rounded-lg" onclick="showFullMedia('${url}')">`;
                                }
                            }).join('')}
                        </div>
                    </div>` : ''}

                    <div class="flex items-center justify-between pt-3 border-t border-slate-700">
                        <div class="flex items-center space-x-4">
                            <button class="like-btn flex items-center space-x-1 ${isLiked ? 'text-red-500' : 'text-gray-400'} tap-highlight" data-post-id="${post.id}">
                                <i class="${isLiked ? 'fas' : 'far'} fa-heart text-sm"></i>
                                <span class="text-xs">${post.likesCount || post.likes?.length || 0}</span>
                            </button>
                            <button class="comments-btn flex items-center space-x-1 text-gray-400 tap-highlight" data-post-id="${post.id}">
                                <i class="far fa-comment text-sm"></i>
                                <span class="text-xs">${post.commentsCount || post.comments?.length || 0}</span>
                            </button>
                        </div>
                    </div>
                `;
                container.appendChild(postElement);
            });

            // –î–æ–±–∞–≤–ª—è–µ–º –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∏
            setTimeout(() => {
                document.querySelectorAll('.like-btn').forEach(btn => {
                    btn.addEventListener('click', function(e) {
                        e.preventDefault();
                        const postId = this.getAttribute('data-post-id');
                        toggleLike(postId, true);
                    });
                });
            }, 100);
        }

        // ===========================================
        // –û–°–¢–ê–õ–¨–ù–´–ï –§–£–ù–ö–¶–ò–ò
        // ===========================================
        function setupEventListeners() {
            console.log("–ù–∞—Å—Ç—Ä–æ–π–∫–∞ –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–æ–≤ —Å–æ–±—ã—Ç–∏–π...");
            
            if (state.isMobile) {
                setupMobileListeners();
            }
        }

        function setupMobileListeners() {
            console.log("–ù–∞—Å—Ç—Ä–æ–π–∫–∞ –º–æ–±–∏–ª—å–Ω—ã—Ö –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–æ–≤...");
            
            // –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –≤–∫–ª–∞–¥–æ–∫ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏
            const loginTab = document.getElementById('mobile-login-tab');
            const registerTab = document.getElementById('mobile-register-tab');
            
            if (loginTab) loginTab.addEventListener('click', () => switchAuthTab('login', true));
            if (registerTab) registerTab.addEventListener('click', () => switchAuthTab('register', true));
            
            // –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –∫–Ω–æ–ø–æ–∫ –≤—Ö–æ–¥–∞/—Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏
            const loginBtn = document.getElementById('mobile-login-btn');
            const registerBtn = document.getElementById('mobile-register-btn');
            
            if (loginBtn) loginBtn.addEventListener('click', () => login(true));
            if (registerBtn) registerBtn.addEventListener('click', () => register(true));
            
            // –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –≤—ã–±–æ—Ä–∞ –∫–ª–∞–Ω–∞
            document.querySelectorAll('#mobile-clan-selection .clan-btn').forEach(btn => {
                btn.addEventListener('click', function() {
                    selectClan(this.getAttribute('data-clan'), true);
                });
            });
            
            // –û–±—Ä–∞–±–æ—Ç—á–∏–∫ Enter –≤ —Ñ–æ—Ä–º–µ –ª–æ–≥–∏–Ω–∞
            const loginPassword = document.getElementById('mobile-login-password');
            if (loginPassword) {
                loginPassword.addEventListener('keypress', (e) => {
                    if (e.key === 'Enter') login(true);
                });
            }
            
            // –û–±—Ä–∞–±–æ—Ç—á–∏–∫ Enter –≤ —Ñ–æ—Ä–º–µ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏
            const regPassword = document.getElementById('mobile-reg-password');
            if (regPassword) {
                regPassword.addEventListener('keypress', (e) => {
                    if (e.key === 'Enter') register(true);
                });
            }
            
            // –ú–æ–±–∏–ª—å–Ω–æ–µ –º–µ–Ω—é
            const menuBtn = document.getElementById('mobile-menu-btn');
            const closeSidebarBtn = document.getElementById('mobile-close-sidebar');
            const sidebarOverlay = document.getElementById('mobile-sidebar-overlay');
            
            if (menuBtn) menuBtn.addEventListener('click', openMobileSidebar);
            if (closeSidebarBtn) closeSidebarBtn.addEventListener('click', closeMobileSidebar);
            if (sidebarOverlay) sidebarOverlay.addEventListener('click', closeMobileSidebar);
            
            // –ú–æ–±–∏–ª—å–Ω–∞—è –Ω–∞–≤–∏–≥–∞—Ü–∏—è
            document.querySelectorAll('.mobile-bottom-nav-btn').forEach(btn => {
                btn.addEventListener('click', function() {
                    const section = this.getAttribute('data-section');
                    if (section) showMobileSection(section);
                });
            });
            
            // –ù–∞–≤–∏–≥–∞—Ü–∏—è –≤ —Å–∞–π–¥–±–∞—Ä–µ
            document.querySelectorAll('#mobile-sidebar .nav-btn').forEach(btn => {
                btn.addEventListener('click', function() {
                    const section = this.getAttribute('data-section');
                    if (section) {
                        showMobileSection(section);
                        closeMobileSidebar();
                    }
                });
            });
            
            // –í—ã—Ö–æ–¥
            const logoutBtn = document.getElementById('mobile-logout-btn');
            if (logoutBtn) logoutBtn.addEventListener('click', logout);
            
            // –°–æ–∑–¥–∞–Ω–∏–µ –ø–æ—Å—Ç–∞
            const createPostBtn = document.getElementById('mobile-create-post-btn');
            if (createPostBtn) createPostBtn.addEventListener('click', () => createPost(true));
            
            const clearMediaBtn = document.getElementById('mobile-clear-media');
            if (clearMediaBtn) clearMediaBtn.addEventListener('click', () => clearMedia(true));
            
            // –ú–µ—Å—Å–µ–Ω–¥–∂–µ—Ä
            const newChatBtn = document.getElementById('mobile-new-chat-btn');
            if (newChatBtn) newChatBtn.addEventListener('click', () => showNewChatModal(true));
            
            const backToChatsBtn = document.getElementById('mobile-back-to-chats');
            if (backToChatsBtn) backToChatsBtn.addEventListener('click', closeChatWindow);
            
            const sendMessageBtn = document.getElementById('mobile-send-message-btn');
            if (sendMessageBtn) sendMessageBtn.addEventListener('click', () => sendMessage(true));
            
            const messageInput = document.getElementById('mobile-message-input');
            if (messageInput) {
                messageInput.addEventListener('keypress', (e) => {
                    if (e.key === 'Enter') sendMessage(true);
                });
            }
            
            // FAB –∫–Ω–æ–ø–∫–∞
            const fabBtn = document.getElementById('mobile-fab');
            if (fabBtn) {
                fabBtn.addEventListener('click', function() {
                    if (state.currentSection === 'feed') {
                        document.getElementById('mobile-post-content').focus();
                        window.scrollTo({ top: 0, behavior: 'smooth' });
                    }
                });
            }
            
            // –ú–µ–¥–∏–∞ –≤ –ø–æ—Å—Ç–∞—Ö
            const postMediaInput = document.getElementById('mobile-post-media');
            if (postMediaInput) {
                postMediaInput.addEventListener('change', (e) => handleMediaSelect(e, true));
            }
        }

        function switchAuthTab(tab, isMobile) {
            if (isMobile) {
                const loginTab = document.getElementById('mobile-login-tab');
                const registerTab = document.getElementById('mobile-register-tab');
                const loginForm = document.getElementById('mobile-login-form');
                const registerForm = document.getElementById('mobile-register-form');

                if (tab === 'login') {
                    loginTab.classList.remove('tab-inactive');
                    loginTab.classList.add('tab-active');
                    registerTab.classList.remove('tab-active');
                    registerTab.classList.add('tab-inactive');
                    loginForm.classList.remove('hidden');
                    registerForm.classList.add('hidden');
                } else {
                    registerTab.classList.remove('tab-inactive');
                    registerTab.classList.add('tab-active');
                    loginTab.classList.remove('tab-active');
                    loginTab.classList.add('tab-inactive');
                    registerForm.classList.remove('hidden');
                    loginForm.classList.add('hidden');
                }
            }
        }

        function selectClan(clan, isMobile) {
            state.selectedClan = clan;
            
            if (isMobile) {
                document.querySelectorAll('#mobile-clan-selection .clan-btn').forEach(btn => {
                    btn.classList.remove('clan-selected');
                    if (btn.getAttribute('data-clan') === clan) {
                        btn.classList.add('clan-selected');
                    }
                });
                
                const clanError = document.getElementById('mobile-clan-error');
                if (clanError) clanError.classList.add('hidden');
            }
        }

        function updateMobileHeader() {
            if (!currentUser) return;

            const headerBalance = document.getElementById('mobile-header-balance');
            const userBalance = document.getElementById('mobile-user-balance');
            
            if (headerBalance) headerBalance.textContent = `${currentUser.balance} C`;
            if (userBalance) userBalance.textContent = `${currentUser.balance} C`;
            
            const userAvatar = document.getElementById('mobile-user-avatar');
            const userName = document.getElementById('mobile-user-name');
            
            if (userAvatar) userAvatar.textContent = currentUser.clan;
            if (userName) userName.textContent = currentUser.firstName || currentUser.username;
        }

        function showMobileSection(section) {
            state.currentSection = section;
            
            // –û–±–Ω–æ–≤–ª—è–µ–º –∞–∫—Ç–∏–≤–Ω—É—é –∫–Ω–æ–ø–∫—É –≤ –Ω–∏–∂–Ω–µ–π –Ω–∞–≤–∏–≥–∞—Ü–∏–∏
            document.querySelectorAll('.mobile-bottom-nav-btn').forEach(btn => {
                btn.classList.remove('active');
                if (btn.getAttribute('data-section') === section) {
                    btn.classList.add('active');
                }
            });
            
            // –°–∫—Ä—ã–≤–∞–µ–º –≤—Å–µ —Ä–∞–∑–¥–µ–ª—ã –∫–æ–Ω—Ç–µ–Ω—Ç–∞
            document.querySelectorAll('#mobile-content .section-content').forEach(div => {
                div.classList.remove('section-active');
            });
            
            // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –≤—ã–±—Ä–∞–Ω–Ω—ã–π —Ä–∞–∑–¥–µ–ª
            const sectionElement = document.getElementById(`mobile-${section}-content`);
            if (sectionElement) {
                sectionElement.classList.add('section-active');
            }
            
            // –û–±–Ω–æ–≤–ª—è–µ–º –∑–∞–≥–æ–ª–æ–≤–æ–∫
            const titles = {
                'feed': '–õ–µ–Ω—Ç–∞',
                'messenger': '–ú–µ—Å—Å–µ–Ω–¥–∂–µ—Ä',
                'profile': '–ü—Ä–æ—Ñ–∏–ª—å',
                'friends': '–î—Ä—É–∑—å—è',
                'shop': '–ú–∞–≥–∞–∑–∏–Ω',
                'transfers': '–ü–µ—Ä–µ–≤–æ–¥—ã',
                'admin': '–ê–¥–º–∏–Ω-–ø–∞–Ω–µ–ª—å'
            };

            const descriptions = {
                'feed': '–ü–æ—Å–ª–µ–¥–Ω–∏–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è',
                'messenger': '–õ–∏—á–Ω—ã–µ —Å–æ–æ–±—â–µ–Ω–∏—è',
                'profile': '–í–∞—à –ø—Ä–æ—Ñ–∏–ª—å',
                'friends': '–ü–æ–∏—Å–∫ –¥—Ä—É–∑–µ–π',
                'shop': '–ü–æ–∫—É–ø–∫–∞ –ø–æ–¥–∞—Ä–∫–æ–≤',
                'transfers': '–ü–µ—Ä–µ–≤–æ–¥—ã',
                'admin': '–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Å–∏—Å—Ç–µ–º–æ–π'
            };

            const currentSectionEl = document.getElementById('mobile-current-section');
            const sectionDescriptionEl = document.getElementById('mobile-section-description');
            
            if (currentSectionEl) currentSectionEl.textContent = titles[section] || '–õ–µ–Ω—Ç–∞';
            if (sectionDescriptionEl) sectionDescriptionEl.textContent = descriptions[section] || '–ü–æ—Å–ª–µ–¥–Ω–∏–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è';
            
            // –ó–∞–≥—Ä—É–∂–∞–µ–º –∫–æ–Ω—Ç–µ–Ω—Ç —Ä–∞–∑–¥–µ–ª–∞
            if (section === 'feed') {
                loadMobileFeed();
            }
        }

        function handleMediaSelect(event, isMobile) {
            const files = event.target.files;
            selectedMedia = [];
            
            for (let i = 0; i < Math.min(files.length, 4); i++) {
                const file = files[i];
                const reader = new FileReader();
                
                reader.onload = function(e) {
                    selectedMedia.push(e.target.result);
                    if (isMobile) updateMobileMediaPreview();
                };
                
                if (file.type.includes('image') || file.type.includes('video')) {
                    reader.readAsDataURL(file);
                }
            }
        }

        function updateMobileMediaPreview() {
            const previewContainer = document.getElementById('mobile-media-preview');
            if (!previewContainer) return;
            
            if (selectedMedia.length === 0) {
                previewContainer.classList.add('hidden');
                return;
            }
            
            previewContainer.classList.remove('hidden');
            previewContainer.innerHTML = '';
            
            selectedMedia.forEach((media, index) => {
                const isVideo = media.includes('data:video');
                const previewItem = document.createElement('div');
                previewItem.className = 'relative';
                previewItem.innerHTML = `
                    ${isVideo ? 
                        `<video src="${media}" class="w-full h-24 object-cover rounded-lg"></video>` :
                        `<img src="${media}" class="w-full h-24 object-cover rounded-lg">`
                    }
                    <button class="absolute -top-2 -right-2 w-6 h-6 bg-red-500 rounded-full flex items-center justify-center text-xs" onclick="removeSelectedMedia(${index}, true)">
                        <i class="fas fa-times"></i>
                    </button>
                `;
                previewContainer.appendChild(previewItem);
            });
        }

        function clearMedia(isMobile) {
            selectedMedia = [];
            
            if (isMobile) {
                const previewContainer = document.getElementById('mobile-media-preview');
                const mediaInput = document.getElementById('mobile-post-media');
                
                if (previewContainer) previewContainer.classList.add('hidden');
                if (mediaInput) mediaInput.value = '';
            }
        }

        function openMobileSidebar() {
            document.getElementById('mobile-sidebar').classList.add('open');
            document.getElementById('mobile-sidebar-overlay').classList.add('open');
            document.body.style.overflow = 'hidden';
        }

        function closeMobileSidebar() {
            document.getElementById('mobile-sidebar').classList.remove('open');
            document.getElementById('mobile-sidebar-overlay').classList.remove('open');
            document.body.style.overflow = '';
        }

        // ===========================================
        // –í–°–ü–û–ú–û–ì–ê–¢–ï–õ–¨–ù–´–ï –§–£–ù–ö–¶–ò–ò
        // ===========================================
        function formatDate(dateString) {
            try {
                const date = new Date(dateString);
                const now = new Date();
                const diffMs = now - date;
                const diffMins = Math.floor(diffMs / (1000 * 60));
                const diffHours = Math.floor(diffMs / (1000 * 60 * 60));
                const diffDays = Math.floor(diffMs / (1000 * 60 * 60 * 24));
                
                if (diffMins < 1) return '–¢–æ–ª—å–∫–æ —á—Ç–æ';
                else if (diffMins < 60) return `${diffMins} –º–∏–Ω –Ω–∞–∑–∞–¥`;
                else if (diffHours < 24) return `${diffHours} —á –Ω–∞–∑–∞–¥`;
                else if (diffDays === 1) return '–í—á–µ—Ä–∞';
                else if (diffDays < 7) return `${diffDays} –¥–Ω –Ω–∞–∑–∞–¥`;
                else return date.toLocaleDateString('ru-RU');
            } catch (e) {
                return '–ù–µ–¥–∞–≤–Ω–æ';
            }
        }

        function showNotification(message, type = 'info') {
            const notification = document.createElement('div');
            notification.className = `fixed top-20 right-4 left-4 p-4 rounded-xl z-50 fade-in ${
                type === 'error' ? 'bg-red-600/90' :
                type === 'success' ? 'bg-green-600/90' :
                type === 'warning' ? 'bg-yellow-600/90' : 'bg-blue-600/90'
            }`;
            notification.innerHTML = `
                <div class="flex items-center space-x-3">
                    <i class="fas fa-${type === 'error' ? 'exclamation-circle' : type === 'success' ? 'check-circle' : 'info-circle'}"></i>
                    <span class="text-sm">${message}</span>
                </div>
            `;
            document.body.appendChild(notification);
            
            setTimeout(() => {
                notification.classList.add('opacity-0', 'transition-opacity', 'duration-300');
                setTimeout(() => notification.remove(), 300);
            }, 3000);
        }

        // –ì–ª–æ–±–∞–ª—å–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏
        window.showFullMedia = function(url) {
            const isVideo = url.includes('data:video');
            
            const modal = document.createElement('div');
            modal.className = 'fixed inset-0 bg-black/90 flex items-center justify-center z-50 p-4 fade-in mobile-modal';
            modal.innerHTML = `
                <div class="mobile-modal-content w-full max-w-md">
                    <div class="bg-slate-900 rounded-2xl p-4">
                        <div class="flex justify-between items-center mb-4">
                            <div></div>
                            <button onclick="this.closest('.mobile-modal').remove(); document.body.style.overflow=''" class="w-10 h-10 rounded-full bg-slate-800 hover:bg-slate-700 flex items-center justify-center tap-highlight">
                                <i class="fas fa-times"></i>
                            </button>
                        </div>
                        <div class="flex justify-center">
                            ${isVideo ? 
                                `<video src="${url}" controls autoplay class="w-full rounded-lg" playsinline></video>` :
                                `<img src="${url}" class="max-w-full rounded-lg">`
                            }
                        </div>
                    </div>
                </div>
            `;
            modal.onclick = (e) => {
                if (e.target === modal) {
                    modal.remove();
                    document.body.style.overflow = '';
                }
            };
            document.getElementById('modals-container').appendChild(modal);
            document.body.style.overflow = 'hidden';
        };

        window.removeSelectedMedia = function(index, isMobile) {
            selectedMedia.splice(index, 1);
            if (isMobile) updateMobileMediaPreview();
        };

        console.log("–ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–æ! –†–µ–∂–∏–º:", state.onlineMode ? "ONLINE" : "OFFLINE");
    </script>
</body>
</html>
    <style>
        * {
            font-family: 'Inter', 'Poppins', sans-serif;
        }
        body {
            background: linear-gradient(135deg, #0f172a 0%, #1e293b 100%);
            min-height: 100vh;
        }
        .glassmorphism {
            background: rgba(30, 41, 59, 0.7);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.1);
        }
        .card-hover {
            transition: all 0.3s ease;
        }
        .card-hover:hover {
            transform: translateY(-5px);
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.3);
        }
        .gradient-text {
            background: linear-gradient(90deg, #60a5fa 0%, #38bdf8 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }
        .btn-primary {
            background: linear-gradient(90deg, #3b82f6 0%, #1d4ed8 100%);
            transition: all 0.3s ease;
        }
        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 25px rgba(59, 130, 246, 0.4);
        }
        .fade-in {
            animation: fadeIn 0.4s ease-out;
        }
        .scrollbar-custom::-webkit-scrollbar {
            width: 6px;
        }
        .scrollbar-custom::-webkit-scrollbar-track {
            background: rgba(30, 41, 59, 0.5);
            border-radius: 10px;
        }
        .scrollbar-custom::-webkit-scrollbar-thumb {
            background: linear-gradient(180deg, #3b82f6 0%, #1d4ed8 100%);
            border-radius: 10px;
        }
        .message-bubble {
            border-radius: 20px;
            position: relative;
        }
        .clan-badge {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 20px;
            margin: 0 auto;
        }
        .tab-active {
            background: linear-gradient(90deg, #3b82f6 0%, #1d4ed8 100%);
            color: white;
        }
        .tab-inactive {
            background: #1e293b;
            color: #94a3b8;
        }
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }
        .clan-selected {
            border: 2px solid #3b82f6;
            background: rgba(59, 130, 246, 0.2) !important;
            transform: scale(1.05);
        }
        .nav-active {
            background: rgba(59, 130, 246, 0.2);
            border-left: 4px solid #3b82f6;
        }
        .section-content {
            display: none;
        }
        .section-active {
            display: block;
        }
        .gift-in-showcase {
            border: 2px solid #3b82f6;
            position: relative;
        }
        .gift-in-showcase::after {
            content: "‚≠ê";
            position: absolute;
            top: -8px;
            right: -8px;
            font-size: 16px;
            background: #1e293b;
            border-radius: 50%;
            width: 24px;
            height: 24px;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        .notification-dot {
            width: 8px;
            height: 8px;
            background: #ef4444;
            border-radius: 50%;
            position: absolute;
            top: 0;
            right: 0;
        }
        .video-player {
            max-width: 100%;
            border-radius: 12px;
            overflow: hidden;
        }
        .message-image {
            max-width: 300px;
            border-radius: 12px;
            margin-top: 8px;
            cursor: pointer;
        }
        .unread-badge {
            background: #ef4444;
            color: white;
            font-size: 12px;
            padding: 2px 6px;
            border-radius: 10px;
            margin-left: auto;
        }
        .typing-indicator {
            display: flex;
            align-items: center;
            gap: 4px;
            padding: 8px 12px;
            background: rgba(30, 41, 59, 0.5);
            border-radius: 12px;
            width: fit-content;
            margin: 4px 0;
        }
        .typing-indicator span {
            width: 8px;
            height: 8px;
            background: #60a5fa;
            border-radius: 50%;
            animation: typing 1.4s infinite;
        }
        .typing-indicator span:nth-child(2) { animation-delay: 0.2s; }
        .typing-indicator span:nth-child(3) { animation-delay: 0.4s; }
        @keyframes typing {
            0%, 60%, 100% { transform: translateY(0); }
            30% { transform: translateY(-4px); }
        }
        .post-image {
            max-width: 100%;
            border-radius: 12px;
            margin-top: 8px;
            cursor: pointer;
        }
        .like-animation {
            animation: like 0.6s ease;
        }
        @keyframes like {
            0% { transform: scale(1); }
            50% { transform: scale(1.3); }
            100% { transform: scale(1); }
        }
        .cursor-not-allowed {
            cursor: not-allowed;
            opacity: 0.5;
        }
        .btn-disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }
        .btn-disabled:hover {
            transform: none !important;
            box-shadow: none !important;
        }
    </style>
</head>
<body class="text-gray-200">
    <div id="app" class="min-h-screen flex">
        <!-- –≠–∫—Ä–∞–Ω –≤—Ö–æ–¥–∞/—Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏ -->
        <div id="auth-screen" class="flex items-center justify-center min-h-screen w-full">
            <div class="glassmorphism rounded-2xl p-8 max-w-md w-full card-hover">
                <div class="text-center mb-8">
                    <div class="w-20 h-20 rounded-full bg-gradient-to-r from-blue-600 to-cyan-500 flex items-center justify-center text-4xl mx-auto mb-4">
                        ü§†
                    </div>
                    <h2 class="text-3xl font-bold gradient-text">Cowboy Messenger</h2>
                    <p class="text-gray-400 mt-2">–ü—Ä–∏—Å–æ–µ–¥–∏–Ω—è–π—Ç–µ—Å—å –∫ –∫–æ–≤–±–æ–π—Å–∫–æ–º—É —Å–æ–æ–±—â–µ—Å—Ç–≤—É!</p>
                </div>

                <!-- –í–∫–ª–∞–¥–∫–∏ -->
                <div class="flex mb-6 bg-slate-800 rounded-xl p-1">
                    <button id="login-tab" class="flex-1 py-3 rounded-lg font-medium tab-active">–í—Ö–æ–¥</button>
                    <button id="register-tab" class="flex-1 py-3 rounded-lg font-medium tab-inactive">–†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è</button>
                </div>

                <!-- –§–æ—Ä–º–∞ –≤—Ö–æ–¥–∞ -->
                <div id="login-form" class="space-y-4">
                    <div>
                        <label class="block text-sm font-medium mb-2">–ù–∏–∫–Ω–µ–π–º (@username)</label>
                        <input type="text" id="login-username" class="w-full bg-slate-800 border border-slate-700 rounded-xl px-4 py-3 focus:outline-none focus:ring-2 focus:ring-blue-500" placeholder="@karkarich">
                    </div>
                    <div>
                        <label class="block text-sm font-medium mb-2">–ü–∞—Ä–æ–ª—å</label>
                        <input type="password" id="login-password" class="w-full bg-slate-800 border border-slate-700 rounded-xl px-4 py-3 focus:outline-none focus:ring-2 focus:ring-blue-500" placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢">
                    </div>
                    <button id="login-btn" class="w-full btn-primary text-white py-3 rounded-xl font-bold mt-6">
                        –í–æ–π—Ç–∏ –≤ –∞–∫–∫–∞—É–Ω—Ç
                    </button>
                </div>

                <!-- –§–æ—Ä–º–∞ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏ -->
                <div id="register-form" class="space-y-4 hidden">
                    <div>
                        <label class="block text-sm font-medium mb-2">–í—ã–±–µ—Ä–∏—Ç–µ –∫–ª–∞–Ω</label>
                        <div class="grid grid-cols-4 gap-3" id="clan-selection">
                            <button type="button" data-clan="ü¶Å" class="clan-btn p-3 rounded-xl bg-slate-800 hover:bg-slate-700 transition">ü¶Å</button>
                            <button type="button" data-clan="ü¶Ö" class="clan-btn p-3 rounded-xl bg-slate-800 hover:bg-slate-700 transition">ü¶Ö</button>
                            <button type="button" data-clan="üê∫" class="clan-btn p-3 rounded-xl bg-slate-800 hover:bg-slate-700 transition">üê∫</button>
                            <button type="button" data-clan="üêª" class="clan-btn p-3 rounded-xl bg-slate-800 hover:bg-slate-700 transition">üêª</button>
                            <button type="button" data-clan="ü¶ä" class="clan-btn p-3 rounded-xl bg-slate-800 hover:bg-slate-700 transition">ü¶ä</button>
                            <button type="button" data-clan="üêØ" class="clan-btn p-3 rounded-xl bg-slate-800 hover:bg-slate-700 transition">üêØ</button>
                            <button type="button" data-clan="ü¶â" class="clan-btn p-3 rounded-xl bg-slate-800 hover:bg-slate-700 transition">ü¶â</button>
                            <button type="button" data-clan="üêç" class="clan-btn p-3 rounded-xl bg-slate-800 hover:bg-slate-700 transition">üêç</button>
                        </div>
                        <p class="text-xs text-red-400 mt-2 hidden" id="clan-error">–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –≤—ã–±–µ—Ä–∏—Ç–µ –∫–ª–∞–Ω</p>
                    </div>

                    <div>
                        <label class="block text-sm font-medium mb-2">–ù–∏–∫–Ω–µ–π–º</label>
                        <input type="text" id="reg-username" class="w-full bg-slate-800 border border-slate-700 rounded-xl px-4 py-3 focus:outline-none focus:ring-2 focus:ring-blue-500" placeholder="@username">
                        <p class="text-xs text-gray-400 mt-1">–ù–∞—á–∏–Ω–∞–µ—Ç—Å—è —Å @, —Ç–æ–ª—å–∫–æ –±—É–∫–≤—ã, —Ü–∏—Ñ—Ä—ã, _ –∏ -</p>
                    </div>

                    <div>
                        <label class="block text-sm font-medium mb-2">–ü–∞—Ä–æ–ª—å</label>
                        <input type="password" id="reg-password" class="w-full bg-slate-800 border border-slate-700 rounded-xl px-4 py-3 focus:outline-none focus:ring-2 focus:ring-blue-500" placeholder="–ú–∏–Ω–∏–º—É–º 8 —Å–∏–º–≤–æ–ª–æ–≤">
                    </div>

                    <div class="grid grid-cols-2 gap-4">
                        <div>
                            <label class="block text-sm font-medium mb-2">–ò–º—è (–Ω–µ–æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ)</label>
                            <input type="text" id="reg-firstname" class="w-full bg-slate-800 border border-slate-700 rounded-xl px-4 py-3 focus:outline-none focus:ring-2 focus:ring-blue-500">
                        </div>
                        <div>
                            <label class="block text-sm font-medium mb-2">–§–∞–º–∏–ª–∏—è (–Ω–µ–æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ)</label>
                            <input type="text" id="reg-lastname" class="w-full bg-slate-800 border border-slate-700 rounded-xl px-4 py-3 focus:outline-none focus:ring-2 focus:ring-blue-500">
                        </div>
                    </div>

                    <button id="register-btn" class="w-full btn-primary text-white py-3 rounded-xl font-bold mt-6">
                        –°–æ–∑–¥–∞—Ç—å –∞–∫–∫–∞—É–Ω—Ç
                    </button>
                </div>

                <p class="text-center text-gray-400 mt-6 text-sm">
                    –°–æ–∑–¥–∞–≤–∞—è –∞–∫–∫–∞—É–Ω—Ç, –≤—ã —Å–æ–≥–ª–∞—à–∞–µ—Ç–µ—Å—å —Å –Ω–∞—à–∏–º–∏ –ø—Ä–∞–≤–∏–ª–∞–º–∏
                </p>
            </div>
        </div>

        <!-- –û—Å–Ω–æ–≤–Ω–æ–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ -->
        <div id="main-app" class="hidden w-full">
            <div class="flex h-screen">
                <!-- –ë–æ–∫–æ–≤–æ–µ –º–µ–Ω—é —Å–ª–µ–≤–∞ -->
                <div class="w-64 glassmorphism p-6 flex flex-col space-y-8">
                    <div class="flex items-center space-x-3 mb-8">
                        <div class="w-12 h-12 rounded-full bg-gradient-to-r from-blue-500 to-cyan-400 flex items-center justify-center text-white text-2xl relative">
                            ü§†
                            <div id="notifications-dot" class="notification-dot hidden"></div>
                        </div>
                        <div>
                            <h2 class="text-xl font-bold gradient-text">Cowboy Messenger</h2>
                            <p class="text-xs text-blue-300">–í–∞—à –∫–æ–≤–±–æ–π—Å–∫–∏–π —Ä–∞–π</p>
                        </div>
                    </div>

                    <div class="space-y-2">
                        <button data-section="feed" class="nav-btn w-full text-left p-3 rounded-lg hover:bg-slate-700/50 transition flex items-center space-x-3 nav-active">
                            <i class="fas fa-newspaper text-blue-400 w-5"></i>
                            <span>–õ–µ–Ω—Ç–∞</span>
                            <span id="feed-notifications" class="unread-badge hidden">0</span>
                        </button>
                        <button data-section="messenger" class="nav-btn w-full text-left p-3 rounded-lg hover:bg-slate-700/50 transition flex items-center space-x-3">
                            <i class="fas fa-comments text-blue-400 w-5"></i>
                            <span>–ú–µ—Å—Å–µ–Ω–¥–∂–µ—Ä</span>
                            <span id="unread-chats-count" class="unread-badge hidden">0</span>
                        </button>
                        <button data-section="profile" class="nav-btn w-full text-left p-3 rounded-lg hover:bg-slate-700/50 transition flex items-center space-x-3">
                            <i class="fas fa-user text-blue-400 w-5"></i>
                            <span>–ü—Ä–æ—Ñ–∏–ª—å</span>
                        </button>
                        <button data-section="friends" class="nav-btn w-full text-left p-3 rounded-lg hover:bg-slate-700/50 transition flex items-center space-x-3">
                            <i class="fas fa-users text-blue-400 w-5"></i>
                            <span>–î—Ä—É–∑—å—è</span>
                            <span id="friend-requests-count" class="unread-badge hidden">0</span>
                        </button>
                        <button data-section="shop" class="nav-btn w-full text-left p-3 rounded-lg hover:bg-slate-700/50 transition flex items-center space-x-3">
                            <i class="fas fa-store text-blue-400 w-5"></i>
                            <span>–ú–∞–≥–∞–∑–∏–Ω</span>
                        </button>
                        <button data-section="transfers" class="nav-btn w-full text-left p-3 rounded-lg hover:bg-slate-700/50 transition flex items-center space-x-3">
                            <i class="fas fa-money-bill-transfer text-blue-400 w-5"></i>
                            <span>–ü–µ—Ä–µ–≤–æ–¥—ã</span>
                        </button>
                        <button id="admin-btn" data-section="admin" class="nav-btn w-full text-left p-3 rounded-lg hover:bg-slate-700/50 transition flex items-center space-x-3 hidden">
                            <i class="fas fa-shield-alt text-red-400 w-5"></i>
                            <span class="text-red-300">–ê–¥–º–∏–Ω-–ø–∞–Ω–µ–ª—å</span>
                        </button>
                    </div>

                    <div class="mt-auto pt-8 border-t border-slate-700">
                        <div class="bg-slate-800/50 rounded-xl p-4">
                            <h3 class="font-bold text-sm mb-3 text-blue-300">üëë –¢–û–ü –ö–ª–∞–Ω–æ–≤</h3>
                            <div id="clan-leaderboard" class="space-y-2">
                                <!-- –î–∏–Ω–∞–º–∏—á–µ—Å–∫–∏ –∑–∞–ø–æ–ª–Ω–∏—Ç—Å—è -->
                            </div>
                        </div>

                        <div class="mt-6 p-4 bg-slate-800/30 rounded-xl">
                            <div class="flex items-center justify-between mb-2">
                                <span class="text-sm font-medium">–ë–∞–ª–∞–Ω—Å</span>
                                <span id="user-balance" class="text-lg font-bold text-yellow-300">0 C</span>
                            </div>
                            <button data-section="transfers" class="nav-btn w-full bg-slate-700 hover:bg-slate-600 py-2 rounded-lg text-sm transition">
                                –ü–æ–ø–æ–ª–Ω–∏—Ç—å / –ü–µ—Ä–µ–≤–µ—Å—Ç–∏
                            </button>
                        </div>

                        <button id="logout-btn" class="w-full mt-4 bg-slate-800 hover:bg-slate-700 py-3 rounded-xl flex items-center justify-center space-x-2 transition">
                            <i class="fas fa-sign-out-alt"></i>
                            <span>–í—ã–π—Ç–∏</span>
                        </button>
                    </div>
                </div>

                <!-- –û—Å–Ω–æ–≤–Ω–æ–π –∫–æ–Ω—Ç–µ–Ω—Ç -->
                <div class="flex-1 flex flex-col">
                    <!-- –®–∞–ø–∫–∞ -->
                    <header class="glassmorphism p-6">
                        <div class="flex justify-between items-center">
                            <div>
                                <h1 class="text-2xl font-bold gradient-text" id="current-section">–õ–µ–Ω—Ç–∞</h1>
                                <p class="text-sm text-gray-400" id="current-section-description">–ü–æ—Å–ª–µ–¥–Ω–∏–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –æ—Ç –¥—Ä—É–∑–µ–π</p>
                            </div>
                            <div class="flex items-center space-x-4">
                                <div class="bg-slate-800/50 rounded-full px-4 py-2 flex items-center space-x-2">
                                    <span id="header-balance" class="text-yellow-300 font-bold">0 C</span>
                                    <span class="text-blue-300">ü§†</span>
                                </div>
                                <div id="header-user" class="flex items-center space-x-3">
                                    <!-- –ó–∞–ø–æ–ª–Ω–∏—Ç—Å—è –ø–æ—Å–ª–µ –≤—Ö–æ–¥–∞ -->
                                </div>
                            </div>
                        </div>
                    </header>

                    <!-- –ö–æ–Ω—Ç–µ–π–Ω–µ—Ä –¥–ª—è –∫–æ–Ω—Ç–µ–Ω—Ç–∞ -->
                    <main class="flex-1 p-6 overflow-y-auto scrollbar-custom">
                        <!-- –õ–µ–Ω—Ç–∞ -->
                        <div id="feed-content" class="section-content section-active">
                            <div class="max-w-4xl mx-auto">
                                <div class="glassmorphism rounded-2xl p-6 mb-6">
                                    <h3 class="text-xl font-bold mb-4">–°–æ–∑–¥–∞—Ç—å –ø–æ—Å—Ç</h3>
                                    <textarea id="post-content" class="w-full bg-slate-800/50 border border-slate-700 rounded-xl px-4 py-3 h-32 focus:outline-none focus:ring-2 focus:ring-blue-500 mb-4" placeholder="–ß—Ç–æ —É –≤–∞—Å –Ω–æ–≤–æ–≥–æ, –∫–æ–≤–±–æ–π?"></textarea>
                                    
                                    <div class="mb-4">
                                        <label class="block text-sm font-medium mb-2">–ú–µ–¥–∏–∞—Ñ–∞–π–ª—ã</label>
                                        <div class="flex space-x-4">
                                            <label class="cursor-pointer">
                                                <input type="file" id="post-media" class="hidden" accept="image/*,video/*" multiple>
                                                <div class="px-4 py-2 bg-slate-800 hover:bg-slate-700 rounded-xl flex items-center space-x-2">
                                                    <i class="fas fa-image"></i>
                                                    <span>–§–æ—Ç–æ/–í–∏–¥–µ–æ</span>
                                                </div>
                                            </label>
                                            <button id="clear-media-btn" class="px-4 py-2 bg-red-800/30 hover:bg-red-700/40 rounded-xl">
                                                <i class="fas fa-trash"></i>
                                            </button>
                                        </div>
                                        <div id="media-preview" class="mt-4 grid grid-cols-3 gap-2 hidden">
                                            <!-- –ü—Ä–µ–≤—å—é –º–µ–¥–∏–∞—Ñ–∞–π–ª–æ–≤ -->
                                        </div>
                                    </div>
                                    
                                    <div class="flex justify-between">
                                        <button id="create-post-btn" class="btn-primary px-6 py-3 rounded-xl font-bold">
                                            –û–ø—É–±–ª–∏–∫–æ–≤–∞—Ç—å
                                        </button>
                                        <div class="text-sm text-gray-400">
                                            <i class="fas fa-image mr-2"></i>
                                            –ú–æ–∂–Ω–æ –ø—Ä–∏–∫—Ä–µ–ø–∏—Ç—å —Ñ–æ—Ç–æ –∏–ª–∏ –≤–∏–¥–µ–æ
                                        </div>
                                    </div>
                                </div>

                                <div id="posts-container">
                                    <!-- –ü–æ—Å—Ç—ã –±—É–¥—É—Ç –∑–¥–µ—Å—å -->
                                </div>
                            </div>
                        </div>

                        <!-- –ú–µ—Å—Å–µ–Ω–¥–∂–µ—Ä -->
                        <div id="messenger-content" class="section-content">
                            <div class="max-w-6xl mx-auto h-full">
                                <div class="grid grid-cols-3 gap-6 h-[calc(100vh-200px)]">
                                    <!-- –°–ø–∏—Å–æ–∫ —á–∞—Ç–æ–≤ -->
                                    <div class="col-span-1">
                                        <div class="glassmorphism rounded-2xl p-4 h-full flex flex-col">
                                            <div class="flex justify-between items-center mb-4">
                                                <h3 class="text-lg font-bold">–í–∞—à–∏ —á–∞—Ç—ã</h3>
                                                <button id="start-new-chat-btn" class="bg-blue-600 hover:bg-blue-700 w-8 h-8 rounded-full flex items-center justify-center">
                                                    <i class="fas fa-plus"></i>
                                                </button>
                                            </div>
                                            <div id="chats-list" class="flex-1 overflow-y-auto space-y-3">
                                                <!-- –°–ø–∏—Å–æ–∫ —á–∞—Ç–æ–≤ -->
                                            </div>
                                        </div>
                                    </div>
                                    
                                    <!-- –û–∫–Ω–æ —á–∞—Ç–∞ -->
                                    <div class="col-span-2">
                                        <div id="no-chat-selected" class="glassmorphism rounded-2xl p-8 h-full flex items-center justify-center">
                                            <div class="text-center">
                                                <div class="w-20 h-20 rounded-full bg-slate-800 flex items-center justify-center text-3xl mb-4 mx-auto">
                                                    ü§†
                                                </div>
                                                <h3 class="text-xl font-bold mb-2">–í—ã–±–µ—Ä–∏—Ç–µ —á–∞—Ç</h3>
                                                <p class="text-gray-400">–ù–∞—á–Ω–∏—Ç–µ –æ–±—â–µ–Ω–∏–µ —Å –¥—Ä—É–∑—å—è–º–∏</p>
                                            </div>
                                        </div>
                                        
                                        <div id="active-chat" class="glassmorphism rounded-2xl h-full flex flex-col hidden">
                                            <div id="chat-header" class="p-4 border-b border-slate-700">
                                                <!-- –ó–∞–≥–æ–ª–æ–≤–æ–∫ —á–∞—Ç–∞ -->
                                            </div>
                                            
                                            <div id="messages-container" class="flex-1 overflow-y-auto p-4 space-y-4">
                                                <!-- –°–æ–æ–±—â–µ–Ω–∏—è -->
                                            </div>
                                            
                                            <div class="p-4 border-t border-slate-700">
                                                <div id="typing-indicator" class="typing-indicator hidden mb-2">
                                                    <span></span><span></span><span></span>
                                                </div>
                                                <div class="flex space-x-3">
                                                    <label class="cursor-pointer">
                                                        <input type="file" id="chat-media" class="hidden" accept="image/*,video/*">
                                                        <div class="w-10 h-10 rounded-lg bg-slate-800 hover:bg-slate-700 flex items-center justify-center">
                                                            <i class="fas fa-image"></i>
                                                        </div>
                                                    </label>
                                                    <input type="text" id="message-input" class="flex-1 bg-slate-800/50 border border-slate-700 rounded-xl px-4 py-3 focus:outline-none focus:ring-2 focus:ring-blue-500" placeholder="–ù–∞–ø–∏—à–∏—Ç–µ —Å–æ–æ–±—â–µ–Ω–∏–µ...">
                                                    <button id="send-message-btn" class="btn-primary px-6 rounded-xl font-bold">
                                                        <i class="fas fa-paper-plane"></i>
                                                    </button>
                                                    <button id="send-money-chat-btn" class="bg-green-600 hover:bg-green-700 px-4 rounded-xl font-bold">
                                                        <i class="fas fa-money-bill"></i>
                                                    </button>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- –ü—Ä–æ—Ñ–∏–ª—å -->
                        <div id="profile-content" class="section-content">
                            <div class="max-w-4xl mx-auto">
                                <div class="glassmorphism rounded-2xl overflow-hidden mb-6">
                                    <div class="h-48 bg-gradient-to-r from-blue-900/50 to-cyan-900/50 relative"></div>
                                    <div class="p-6 relative">
                                        <div class="absolute -top-12 left-6">
                                            <div id="profile-avatar" class="w-24 h-24 rounded-full bg-gradient-to-r from-blue-600 to-cyan-500 flex items-center justify-center text-4xl border-4 border-slate-900">
                                                <!-- –ê–≤–∞—Ç–∞—Ä -->
                                            </div>
                                        </div>
                                        <div class="ml-32">
                                            <div class="flex justify-between items-start">
                                                <div>
                                                    <h2 id="profile-name" class="text-2xl font-bold"></h2>
                                                    <p id="profile-username" class="text-blue-300"></p>
                                                    <div class="flex items-center space-x-4 mt-2">
                                                        <div id="profile-clan" class="px-3 py-1 bg-slate-800 rounded-full text-sm"></div>
                                                        <div class="text-yellow-300 font-bold text-lg" id="profile-balance"></div>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                
                                <div class="grid grid-cols-3 gap-6">
                                    <!-- –õ–µ–≤–∞—è –∫–æ–ª–æ–Ω–∫–∞: –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ -->
                                    <div class="col-span-1">
                                        <div class="glassmorphism rounded-2xl p-6 mb-6">
                                            <h3 class="text-xl font-bold mb-4">üìä –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞</h3>
                                            <div class="space-y-4">
                                                <div class="flex justify-between items-center">
                                                    <span>–î—Ä—É–∑—å—è</span>
                                                    <span id="friends-count" class="font-bold">0</span>
                                                </div>
                                                <div class="flex justify-between items-center">
                                                    <span>–ü–æ—Å—Ç—ã</span>
                                                    <span id="posts-count" class="font-bold">0</span>
                                                </div>
                                                <div class="flex justify-between items-center">
                                                    <span>–ü–æ–¥–∞—Ä–∫–∏</span>
                                                    <span id="gifts-count" class="font-bold">0</span>
                                                </div>
                                                <div class="flex justify-between items-center">
                                                    <span>–í —Å–∏—Å—Ç–µ–º–µ</span>
                                                    <span id="member-since" class="font-bold"></span>
                                                </div>
                                            </div>
                                        </div>
                                        
                                        <div class="glassmorphism rounded-2xl p-6">
                                            <h3 class="text-xl font-bold mb-4">üéí –ú–æ–π –∏–Ω–≤–µ–Ω—Ç–∞—Ä—å</h3>
                                            <div id="inventory-items" class="space-y-3 max-h-80 overflow-y-auto scrollbar-custom">
                                                <!-- –ò–Ω–≤–µ–Ω—Ç–∞—Ä—å -->
                                            </div>
                                            <button data-section="shop" class="nav-btn w-full mt-4 bg-slate-800 hover:bg-slate-700 py-3 rounded-xl">
                                                <i class="fas fa-store mr-2"></i>–ö—É–ø–∏—Ç—å –ø–æ–¥–∞—Ä–∫–∏
                                            </button>
                                        </div>
                                    </div>
                                    
                                    <!-- –ü—Ä–∞–≤–∞—è –∫–æ–ª–æ–Ω–∫–∞: –í–∏—Ç—Ä–∏–Ω–∞ -->
                                    <div class="col-span-2">
                                        <div class="glassmorphism rounded-2xl p-6">
                                            <h3 class="text-xl font-bold mb-4">üéÅ –í–∏—Ç—Ä–∏–Ω–∞ –ø–æ–¥–∞—Ä–∫–æ–≤</h3>
                                            <div id="profile-showcase" class="grid grid-cols-4 gap-4">
                                                <!-- –í–∏—Ç—Ä–∏–Ω–∞ –ø–æ–¥–∞—Ä–∫–æ–≤ -->
                                            </div>
                                            <p id="no-showcase" class="text-gray-400 text-center py-4">–ù–∞ –≤–∏—Ç—Ä–∏–Ω–µ –ø–æ–∫–∞ –Ω–µ—Ç –ø–æ–¥–∞—Ä–∫–æ–≤</p>
                                        </div>
                                        
                                        <div class="glassmorphism rounded-2xl p-6 mt-6">
                                            <h3 class="text-xl font-bold mb-4">üìù –°—Ç–µ–Ω–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è</h3>
                                            <div id="profile-posts">
                                                <!-- –ü–æ—Å—Ç—ã –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è -->
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- –î—Ä—É–∑—å—è -->
                        <div id="friends-content" class="section-content">
                            <div class="max-w-4xl mx-auto">
                                <div class="glassmorphism rounded-2xl p-8">
                                    <div class="text-center mb-8">
                                        <i class="fas fa-users text-5xl text-blue-400 mb-4"></i>
                                        <h2 class="text-2xl font-bold mb-2">–î—Ä—É–∑—å—è</h2>
                                        <p class="text-gray-400">–ù–∞–π–¥–∏—Ç–µ –Ω–æ–≤—ã—Ö –¥—Ä—É–∑–µ–π –∏ –æ–±—â–∞–π—Ç–µ—Å—å</p>
                                    </div>
                                    
                                    <div class="mb-6">
                                        <div class="flex space-x-4">
                                            <input type="text" id="search-friend-input" class="flex-1 bg-slate-800/50 border border-slate-700 rounded-xl px-4 py-3 focus:outline-none focus:ring-2 focus:ring-blue-500" placeholder="–ü–æ–∏—Å–∫ –ø–æ –Ω–∏–∫–Ω–µ–π–º—É...">
                                            <button id="search-friend-btn" class="btn-primary px-6 rounded-xl font-bold">
                                                <i class="fas fa-search mr-2"></i>–ù–∞–π—Ç–∏
                                            </button>
                                        </div>
                                    </div>
                                    
                                    <div id="search-results" class="hidden mb-6">
                                        <!-- –†–µ–∑—É–ª—å—Ç–∞—Ç—ã –ø–æ–∏—Å–∫–∞ -->
                                    </div>
                                    
                                    <div class="grid grid-cols-2 gap-6">
                                        <div class="glassmorphism rounded-2xl p-6">
                                            <h3 class="text-lg font-bold mb-4 text-blue-300">–í–∞—à–∏ –¥—Ä—É–∑—å—è</h3>
                                            <div id="friends-list" class="space-y-3">
                                                <!-- –°–ø–∏—Å–æ–∫ –¥—Ä—É–∑–µ–π -->
                                            </div>
                                        </div>
                                        
                                        <div class="glassmorphism rounded-2xl p-6">
                                            <h3 class="text-lg font-bold mb-4 text-yellow-300">–ó–∞—è–≤–∫–∏ –≤ –¥—Ä—É–∑—å—è</h3>
                                            <div id="friend-requests" class="space-y-3">
                                                <!-- –ó–∞—è–≤–∫–∏ -->
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- –ú–∞–≥–∞–∑–∏–Ω -->
                        <div id="shop-content" class="section-content">
                            <div class="max-w-6xl mx-auto">
                                <div class="glassmorphism rounded-2xl p-8">
                                    <div class="flex justify-between items-center mb-8">
                                        <div>
                                            <h2 class="text-2xl font-bold gradient-text">üéÅ –ú–∞–≥–∞–∑–∏–Ω –ø–æ–¥–∞—Ä–∫–æ–≤</h2>
                                            <p class="text-gray-400">–ö—É–ø–∏—Ç–µ –ø–æ–¥–∞—Ä–∫–∏ –¥–ª—è —Å–µ–±—è –∏–ª–∏ –¥—Ä—É–∑–µ–π</p>
                                        </div>
                                        <div class="bg-slate-800/50 px-6 py-3 rounded-xl">
                                            <span class="text-gray-400 mr-2">–í–∞—à –±–∞–ª–∞–Ω—Å:</span>
                                            <span id="shop-balance" class="text-2xl font-bold text-yellow-300">0 C</span>
                                        </div>
                                    </div>

                                    <div id="gifts-shop" class="grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-6">
                                        <!-- –¢–æ–≤–∞—Ä—ã –º–∞–≥–∞–∑–∏–Ω–∞ -->
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- –ü–µ—Ä–µ–≤–æ–¥—ã -->
                        <div id="transfers-content" class="section-content">
                            <div class="max-w-2xl mx-auto">
                                <div class="glassmorphism rounded-2xl p-8">
                                    <div class="text-center mb-8">
                                        <i class="fas fa-money-bill-transfer text-5xl text-blue-400 mb-4"></i>
                                        <h2 class="text-2xl font-bold mb-2">–ü–µ—Ä–µ–≤–æ–¥—ã Cowboy</h2>
                                        <p class="text-gray-400">–û—Ç–ø—Ä–∞–≤–ª—è–π—Ç–µ –≤–∞–ª—é—Ç—É –¥—Ä—É–∑—å—è–º –∏ –∑–Ω–∞–∫–æ–º—ã–º</p>
                                    </div>
                                    
                                    <div class="bg-slate-800/30 rounded-xl p-6 mb-6">
                                        <h4 class="font-bold mb-4 text-lg">–ù–æ–≤—ã–π –ø–µ—Ä–µ–≤–æ–¥</h4>
                                        <div class="space-y-4">
                                            <div>
                                                <label class="block text-sm font-medium mb-2">–ù–∏–∫–Ω–µ–π–º –ø–æ–ª—É—á–∞—Ç–µ–ª—è</label>
                                                <input type="text" id="transfer-to" class="w-full bg-slate-800/50 border border-slate-700 rounded-xl px-4 py-3 focus:outline-none focus:ring-2 focus:ring-blue-500" placeholder="@username">
                                            </div>
                                            <div>
                                                <label class="block text-sm font-medium mb-2">–°—É–º–º–∞ (C)</label>
                                                <input type="number" id="transfer-amount" class="w-full bg-slate-800/50 border border-slate-700 rounded-xl px-4 py-3 focus:outline-none focus:ring-2 focus:ring-blue-500" min="1" placeholder="10">
                                            </div>
                                            <div>
                                                <label class="block text-sm font-medium mb-2">–°–æ–æ–±—â–µ–Ω–∏–µ (–Ω–µ–æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ)</label>
                                                <input type="text" id="transfer-message" class="w-full bg-slate-800/50 border border-slate-700 rounded-xl px-4 py-3 focus:outline-none focus:ring-2 focus:ring-blue-500" placeholder="–ó–∞ —á—Ç–æ –ø–µ—Ä–µ–≤–æ–¥">
                                            </div>
                                            <button id="make-transfer-btn" class="w-full btn-primary py-3 rounded-xl font-bold">
                                                –û—Ç–ø—Ä–∞–≤–∏—Ç—å –ø–µ—Ä–µ–≤–æ–¥
                                            </button>
                                        </div>
                                    </div>
                                    
                                    <div>
                                        <h4 class="font-bold mb-4 text-lg">üìä –ò—Å—Ç–æ—Ä–∏—è –ø–µ—Ä–µ–≤–æ–¥–æ–≤</h4>
                                        <div id="transfers-history" class="space-y-3 max-h-96 overflow-y-auto scrollbar-custom">
                                            <!-- –ò—Å—Ç–æ—Ä–∏—è -->
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- –ê–¥–º–∏–Ω-–ø–∞–Ω–µ–ª—å -->
                        <div id="admin-content" class="section-content">
                            <div class="max-w-6xl mx-auto">
                                <div class="glassmorphism rounded-2xl p-8">
                                    <div class="flex items-center mb-8">
                                        <div class="w-16 h-16 rounded-full bg-gradient-to-r from-red-600 to-pink-500 flex items-center justify-center text-2xl mr-4">
                                            üëë
                                        </div>
                                        <div>
                                            <h2 class="text-2xl font-bold gradient-text">–ê–¥–º–∏–Ω-–ø–∞–Ω–µ–ª—å</h2>
                                            <p class="text-gray-400">–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Å–∏—Å—Ç–µ–º–æ–π Cowboy Messenger</p>
                                        </div>
                                    </div>

                                    <div class="grid grid-cols-2 gap-6 mb-8">
                                        <div class="bg-slate-800/30 rounded-xl p-6">
                                            <h3 class="font-bold mb-4 text-xl">üí∞ –ò–∑–º–µ–Ω–∏—Ç—å –±–∞–ª–∞–Ω—Å</h3>
                                            <div class="space-y-4">
                                                <div>
                                                    <label class="block text-sm font-medium mb-2">–ù–∏–∫–Ω–µ–π–º –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è</label>
                                                    <input type="text" id="admin-username" class="w-full bg-slate-800/50 border border-slate-700 rounded-xl px-4 py-3 focus:outline-none focus:ring-2 focus:ring-blue-500" placeholder="@username">
                                                </div>
                                                <div>
                                                    <label class="block text-sm font-medium mb-2">–ù–æ–≤—ã–π –±–∞–ª–∞–Ω—Å (C)</label>
                                                    <input type="number" id="admin-balance" class="w-full bg-slate-800/50 border border-slate-700 rounded-xl px-4 py-3 focus:outline-none focus:ring-2 focus:ring-blue-500" placeholder="1000">
                                                </div>
                                                <button id="admin-set-balance-btn" class="w-full bg-gradient-to-r from-red-600 to-pink-500 hover:from-red-700 hover:to-pink-600 py-3 rounded-xl font-bold">
                                                    –£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –±–∞–ª–∞–Ω—Å
                                                </button>
                                            </div>
                                        </div>

                                        <div class="bg-slate-800/30 rounded-xl p-6">
                                            <h3 class="font-bold mb-4 text-xl">üéØ –†–∞–∑–¥–∞—á–∞ –∫–ª–∞–Ω—É</h3>
                                            <div class="space-y-4">
                                                <div>
                                                    <label class="block text-sm font-medium mb-2">–í—ã–±–µ—Ä–∏—Ç–µ –∫–ª–∞–Ω</label>
                                                    <select id="admin-clan" class="w-full bg-slate-800/50 border border-slate-700 rounded-xl px-4 py-3 focus:outline-none focus:ring-2 focus:ring-blue-500">
                                                        <option value="ü¶Å">ü¶Å –õ—å–≤—ã</option>
                                                        <option value="ü¶Ö">ü¶Ö –û—Ä–ª—ã</option>
                                                        <option value="üê∫">üê∫ –í–æ–ª–∫–∏</option>
                                                        <option value="üêª">üêª –ú–µ–¥–≤–µ–¥–∏</option>
                                                        <option value="ü¶ä">ü¶ä –õ–∏—Å—ã</option>
                                                        <option value="üêØ">üêØ –¢–∏–≥—Ä—ã</option>
                                                        <option value="ü¶â">ü¶â –°–æ–≤—ã</option>
                                                        <option value="üêç">üêç –ó–º–µ–∏</option>
                                                    </select>
                                                </div>
                                                <div>
                                                    <label class="block text-sm font-medium mb-2">–°—É–º–º–∞ –∫–∞–∂–¥–æ–º—É —É—á–∞—Å—Ç–Ω–∏–∫—É (C)</label>
                                                    <input type="number" id="admin-clan-amount" class="w-full bg-slate-800/50 border border-slate-700 rounded-xl px-4 py-3 focus:outline-none focus:ring-2 focus:ring-blue-500" placeholder="100">
                                                </div>
                                                <button id="admin-distribute-btn" class="w-full bg-gradient-to-r from-green-600 to-emerald-500 hover:from-green-700 hover:to-emerald-600 py-3 rounded-xl font-bold">
                                                    –†–∞–∑–¥–∞—Ç—å –∫–ª–∞–Ω—É
                                                </button>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </main>
                </div>

                <!-- –ë–æ–∫–æ–≤–∞—è –ø–∞–Ω–µ–ª—å —Å–ø—Ä–∞–≤–∞ - –ª–∏–¥–µ—Ä–±–æ—Ä–¥ –∫–ª–∞–Ω–æ–≤ -->
                <div class="w-80 glassmorphism p-6">
                    <div class="mb-8">
                        <h3 class="text-xl font-bold gradient-text mb-4">üèÜ –õ–∏–¥–µ—Ä—ã –∫–ª–∞–Ω–æ–≤</h3>
                        <div id="clan-stats" class="space-y-4">
                            <!-- –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –∫–ª–∞–Ω–æ–≤ -->
                        </div>
                    </div>
                    
                    <div class="bg-slate-800/50 rounded-xl p-4">
                        <h4 class="font-bold text-sm mb-3 text-blue-300">üìä –û–±—â–∞—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞</h4>
                        <div class="space-y-2">
                            <div class="flex justify-between">
                                <span class="text-sm">–í—Å–µ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π:</span>
                                <span id="total-users" class="font-bold">0</span>
                            </div>
                            <div class="flex justify-between">
                                <span class="text-sm">–í—Å–µ–≥–æ –ø–æ—Å—Ç–æ–≤:</span>
                                <span id="total-posts" class="font-bold">0</span>
                            </div>
                            <div class="flex justify-between">
                                <span class="text-sm">–ê–∫—Ç–∏–≤–Ω—ã—Ö —á–∞—Ç–æ–≤:</span>
                                <span id="total-chats" class="font-bold">0</span>
                            </div>
                            <div class="flex justify-between">
                                <span class="text-sm">–û–±—â–∏–π –±–∞–ª–∞–Ω—Å:</span>
                                <span id="total-balance" class="font-bold text-yellow-300">0 C</span>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- –ú–æ–¥–∞–ª—å–Ω—ã–µ –æ–∫–Ω–∞ -->
    <div id="modals-container"></div>

    <script>
        // ===========================================
        // –ò–ù–ò–¶–ò–ê–õ–ò–ó–ê–¶–ò–Ø –î–ê–ù–ù–´–•
        // ===========================================
        const DB = {
            users: JSON.parse(localStorage.getItem('cowboy_users')) || [],
            posts: JSON.parse(localStorage.getItem('cowboy_posts')) || [],
            chats: JSON.parse(localStorage.getItem('cowboy_chats')) || [],
            gifts: JSON.parse(localStorage.getItem('cowboy_gifts')) || [],
            transactions: JSON.parse(localStorage.getItem('cowboy_transactions')) || [],
            friendRequests: JSON.parse(localStorage.getItem('cowboy_friend_requests')) || [],
            friendships: JSON.parse(localStorage.getItem('cowboy_friendships')) || [],
            notifications: JSON.parse(localStorage.getItem('cowboy_notifications')) || [],
            chatMessages: JSON.parse(localStorage.getItem('cowboy_chat_messages')) || []
        };

        // –ü—Ä–µ–¥–∑–∞–ø–æ–ª–Ω–µ–Ω–Ω—ã–µ –ø–æ–¥–∞—Ä–∫–∏
        const DEFAULT_GIFTS = [
            { id: 1, name: "üåπ –†–æ–∑–∞", price: 10, emoji: "üåπ", description: "–ö–ª–∞—Å—Å–∏—á–µ—Å–∫–∏–π –ø–æ–¥–∞—Ä–æ–∫", purchases: 0, popular: 50 },
            { id: 2, name: "üöó –ú–∞—à–∏–Ω–∞", price: 500, emoji: "üöó", description: "–°—Ç–∏–ª—å–Ω—ã–π —Ç—Ä–∞–Ω—Å–ø–æ—Ä—Ç", purchases: 0, popular: 30 },
            { id: 3, name: "üöÄ –†–∞–∫–µ—Ç–∞", price: 1000, emoji: "üöÄ", description: "–î–ª—è –∫–æ—Å–º–∏—á–µ—Å–∫–∏—Ö –∞–º–±–∏—Ü–∏–π", purchases: 0, popular: 20 },
            { id: 4, name: "üèÜ –ö—É–±–æ–∫", price: 300, emoji: "üèÜ", description: "–ó–∞ –ø–æ–±–µ–¥—ã", purchases: 0, popular: 40 },
            { id: 5, name: "üíé –ê–ª–º–∞–∑", price: 800, emoji: "üíé", description: "–†–æ—Å–∫–æ—à–Ω—ã–π –ø–æ–¥–∞—Ä–æ–∫", purchases: 0, popular: 25 },
            { id: 6, name: "üé∏ –ì–∏—Ç–∞—Ä–∞", price: 200, emoji: "üé∏", description: "–ú—É–∑—ã–∫–∞–ª—å–Ω—ã–π –ø–æ–¥–∞—Ä–æ–∫", purchases: 0, popular: 35 },
            { id: 7, name: "üëë –ö–æ—Ä–æ–Ω–∞", price: 1500, emoji: "üëë", description: "–ö–æ—Ä–æ–ª–µ–≤—Å–∫–∏–π –ø–æ–¥–∞—Ä–æ–∫", purchases: 0, popular: 15 },
            { id: 8, name: "üõ°Ô∏è –©–∏—Ç", price: 400, emoji: "üõ°Ô∏è", description: "–î–ª—è –∑–∞—â–∏—Ç—ã", purchases: 0, popular: 28 }
        ];

        // –¢–µ–∫—É—â–∏–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å
        let currentUser = null;
        let selectedMedia = [];
        let activeChatId = null;
        let activeChatUser = null;

        // –°–æ—Å—Ç–æ—è–Ω–∏–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
        const state = {
            selectedClan: null,
            activeModal: null,
            currentSection: 'feed'
        };

        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ
        document.addEventListener('DOMContentLoaded', function() {
            console.log("–î–æ–∫—É–º–µ–Ω—Ç –∑–∞–≥—Ä—É–∂–µ–Ω, –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ–º –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ...");
            initApp();
        });

        function initApp() {
            console.log("–ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è...");
            
            // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ–º –ø–æ–¥–∞—Ä–∫–∏ –µ—Å–ª–∏ –∏—Ö –Ω–µ—Ç
            if (DB.gifts.length === 0) {
                DB.gifts = DEFAULT_GIFTS;
                saveToDB('gifts');
                console.log("–ü–æ–¥–∞—Ä–∫–∏ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω—ã");
            }

            // –ü—Ä–æ–≤–µ—Ä—è–µ–º, –µ—Å—Ç—å –ª–∏ –∞–∫—Ç–∏–≤–Ω—ã–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å
            const savedUser = localStorage.getItem('cowboy_current_user');
            if (savedUser) {
                try {
                    currentUser = JSON.parse(savedUser);
                    console.log("–ù–∞–π–¥–µ–Ω —Å–æ—Ö—Ä–∞–Ω–µ–Ω–Ω—ã–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å:", currentUser.username);
                    showApp();
                } catch (e) {
                    console.error("–û—à–∏–±–∫–∞ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è:", e);
                    showAuth();
                }
            } else {
                console.log("–ù–µ—Ç —Å–æ—Ö—Ä–∞–Ω–µ–Ω–Ω–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è, –ø–æ–∫–∞–∑—ã–≤–∞–µ–º —ç–∫—Ä–∞–Ω –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏");
                showAuth();
            }

            // –ù–∞—Å—Ç—Ä–∞–∏–≤–∞–µ–º –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ —Å–æ–±—ã—Ç–∏–π
            setupEventListeners();
        }

        // –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–æ–≤ —Å–æ–±—ã—Ç–∏–π
        function setupEventListeners() {
            console.log("–ù–∞—Å—Ç—Ä–æ–π–∫–∞ –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–æ–≤ —Å–æ–±—ã—Ç–∏–π...");
            
            // –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –≤–∫–ª–∞–¥–æ–∫ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏
            document.getElementById('login-tab').addEventListener('click', function() {
                console.log("–ö–ª–∏–∫ –Ω–∞ –≤–∫–ª–∞–¥–∫—É –í—Ö–æ–¥");
                switchAuthTab('login');
            });
            
            document.getElementById('register-tab').addEventListener('click', function() {
                console.log("–ö–ª–∏–∫ –Ω–∞ –≤–∫–ª–∞–¥–∫—É –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è");
                switchAuthTab('register');
            });
            
            // –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –∫–Ω–æ–ø–æ–∫ –≤—Ö–æ–¥–∞/—Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏
            document.getElementById('login-btn').addEventListener('click', function(e) {
                e.preventDefault();
                e.stopPropagation();
                login();
            });
            
            document.getElementById('register-btn').addEventListener('click', function(e) {
                e.preventDefault();
                e.stopPropagation();
                register();
            });
            
            // –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –≤—ã–±–æ—Ä–∞ –∫–ª–∞–Ω–∞
            document.querySelectorAll('.clan-btn').forEach(btn => {
                btn.addEventListener('click', function() {
                    const clan = this.getAttribute('data-clan');
                    console.log("–í—ã–±—Ä–∞–Ω –∫–ª–∞–Ω:", clan);
                    selectClan(clan);
                });
            });
            
            // –û–±—Ä–∞–±–æ—Ç—á–∏–∫ Enter –≤ —Ñ–æ—Ä–º–µ –ª–æ–≥–∏–Ω–∞
            document.getElementById('login-password').addEventListener('keypress', function(e) {
                if (e.key === 'Enter') {
                    console.log("Enter –≤ —Ñ–æ—Ä–º–µ –ª–æ–≥–∏–Ω–∞");
                    e.preventDefault();
                    login();
                }
            });
            
            // –û–±—Ä–∞–±–æ—Ç—á–∏–∫ Enter –≤ —Ñ–æ—Ä–º–µ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏
            document.getElementById('reg-password').addEventListener('keypress', function(e) {
                if (e.key === 'Enter') {
                    console.log("Enter –≤ —Ñ–æ—Ä–º–µ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏");
                    e.preventDefault();
                    register();
                }
            });
            
            console.log("–û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ —Å–æ–±—ã—Ç–∏–π –Ω–∞—Å—Ç—Ä–æ–µ–Ω—ã");
        }

        // –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –≤ –±–∞–∑—É –¥–∞–Ω–Ω—ã—Ö
        function saveToDB(key) {
            localStorage.setItem(`cowboy_${key}`, JSON.stringify(DB[key]));
        }

        // –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ —Ç–µ–∫—É—â–µ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
        function saveCurrentUser() {
            localStorage.setItem('cowboy_current_user', JSON.stringify(currentUser));
        }

        // –ü–æ–∫–∞–∑–∞—Ç—å —ç–∫—Ä–∞–Ω –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏
        function showAuth() {
            console.log("–ü–æ–∫–∞–∑—ã–≤–∞–µ–º —ç–∫—Ä–∞–Ω –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏");
            document.getElementById('auth-screen').classList.remove('hidden');
            document.getElementById('main-app').classList.add('hidden');
            switchAuthTab('login');
        }

        // –ü–æ–∫–∞–∑–∞—Ç—å –æ—Å–Ω–æ–≤–Ω–æ–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ
        function showApp() {
            console.log("–ü–æ–∫–∞–∑—ã–≤–∞–µ–º –æ—Å–Ω–æ–≤–Ω–æ–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ");
            document.getElementById('auth-screen').classList.add('hidden');
            document.getElementById('main-app').classList.remove('hidden');
            
            // –û–±–Ω–æ–≤–ª—è–µ–º –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –≤ —à–∞–ø–∫–µ
            updateHeader();
            
            // –û–±–Ω–æ–≤–ª—è–µ–º —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É –∫–ª–∞–Ω–æ–≤
            updateClanStats();
            
            // –û–±–Ω–æ–≤–ª—è–µ–º –æ–±—â—É—é —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É
            updateGlobalStats();
            
            // –ó–∞–≥—Ä—É–∂–∞–µ–º —Ç–µ–∫—É—â–∏–π —Ä–∞–∑–¥–µ–ª
            loadCurrentSection();
            
            // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –∫–Ω–æ–ø–∫—É –∞–¥–º–∏–Ω–∞ –µ—Å–ª–∏ –Ω—É–∂–Ω–æ (—Ç–æ–ª—å–∫–æ –¥–ª—è @karkarich)
            updateAdminButton();
            
            // –û–±–Ω–æ–≤–ª—è–µ–º —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è
            updateNotifications();
            
            // –ù–∞—Å—Ç—Ä–∞–∏–≤–∞–µ–º –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –¥–ª—è –æ—Å–Ω–æ–≤–Ω–æ–≥–æ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
            setupMainAppListeners();
        }

        // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∫–Ω–æ–ø–∫–∏ –∞–¥–º–∏–Ω-–ø–∞–Ω–µ–ª–∏
        function updateAdminButton() {
            const adminBtn = document.getElementById('admin-btn');
            if (currentUser && currentUser.username === '@karkarich') {
                adminBtn.classList.remove('hidden');
            } else {
                adminBtn.classList.add('hidden');
            }
        }

        // –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–æ–≤ –¥–ª—è –æ—Å–Ω–æ–≤–Ω–æ–≥–æ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
        function setupMainAppListeners() {
            // –ù–∞–≤–∏–≥–∞—Ü–∏—è
            document.querySelectorAll('.nav-btn').forEach(btn => {
                btn.addEventListener('click', function(e) {
                    e.preventDefault();
                    e.stopPropagation();
                    const section = this.getAttribute('data-section');
                    if (section) {
                        showSection(section);
                    }
                });
            });
            
            // –í—ã—Ö–æ–¥
            document.getElementById('logout-btn').addEventListener('click', function(e) {
                e.preventDefault();
                e.stopPropagation();
                logout();
            });
            
            // –°–æ–∑–¥–∞–Ω–∏–µ –ø–æ—Å—Ç–∞
            document.getElementById('create-post-btn').addEventListener('click', function(e) {
                e.preventDefault();
                e.stopPropagation();
                createPost();
            });
            
            document.getElementById('clear-media-btn').addEventListener('click', function(e) {
                e.preventDefault();
                e.stopPropagation();
                clearMedia();
            });
            
            // –ó–∞–≥—Ä—É–∑–∫–∞ –º–µ–¥–∏–∞—Ñ–∞–π–ª–æ–≤
            document.getElementById('post-media').addEventListener('change', function(e) {
                e.preventDefault();
                e.stopPropagation();
                handleMediaUpload(e);
            });
            
            // –ú–µ—Å—Å–µ–Ω–¥–∂–µ—Ä
            document.getElementById('start-new-chat-btn').addEventListener('click', function(e) {
                e.preventDefault();
                e.stopPropagation();
                showNewChatModal();
            });
            
            document.getElementById('send-message-btn').addEventListener('click', function(e) {
                e.preventDefault();
                e.stopPropagation();
                sendMessage();
            });
            
            document.getElementById('message-input').addEventListener('keypress', function(e) {
                if (e.key === 'Enter') {
                    e.preventDefault();
                    e.stopPropagation();
                    sendMessage();
                }
            });
            
            document.getElementById('chat-media').addEventListener('change', function(e) {
                e.preventDefault();
                e.stopPropagation();
                handleChatMedia(e);
            });
            
            document.getElementById('send-money-chat-btn').addEventListener('click', function(e) {
                e.preventDefault();
                e.stopPropagation();
                sendMoneyInChat();
            });
            
            // –î—Ä—É–∑—å—è
            document.getElementById('search-friend-btn').addEventListener('click', function(e) {
                e.preventDefault();
                e.stopPropagation();
                searchFriend();
            });
            
            document.getElementById('search-friend-input').addEventListener('keypress', function(e) {
                if (e.key === 'Enter') {
                    e.preventDefault();
                    e.stopPropagation();
                    searchFriend();
                }
            });
            
            // –ü–µ—Ä–µ–≤–æ–¥—ã
            document.getElementById('make-transfer-btn').addEventListener('click', function(e) {
                e.preventDefault();
                e.stopPropagation();
                makeTransfer();
            });
            
            // –ê–¥–º–∏–Ω-–ø–∞–Ω–µ–ª—å
            document.getElementById('admin-set-balance-btn')?.addEventListener('click', function(e) {
                e.preventDefault();
                e.stopPropagation();
                adminSetBalance();
            });
            
            document.getElementById('admin-distribute-btn')?.addEventListener('click', function(e) {
                e.preventDefault();
                e.stopPropagation();
                adminDistributeToClan();
            });
            
            console.log("–û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –æ—Å–Ω–æ–≤–Ω–æ–≥–æ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è –Ω–∞—Å—Ç—Ä–æ–µ–Ω—ã");
        }

        // –ü–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ –≤–∫–ª–∞–¥–æ–∫ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏
        function switchAuthTab(tab) {
            console.log("–ü–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ –Ω–∞ –≤–∫–ª–∞–¥–∫—É:", tab);
            const loginTab = document.getElementById('login-tab');
            const registerTab = document.getElementById('register-tab');
            const loginForm = document.getElementById('login-form');
            const registerForm = document.getElementById('register-form');

            if (tab === 'login') {
                loginTab.classList.remove('tab-inactive');
                loginTab.classList.add('tab-active');
                registerTab.classList.remove('tab-active');
                registerTab.classList.add('tab-inactive');
                loginForm.classList.remove('hidden');
                registerForm.classList.add('hidden');
            } else {
                registerTab.classList.remove('tab-inactive');
                registerTab.classList.add('tab-active');
                loginTab.classList.remove('tab-active');
                loginTab.classList.add('tab-inactive');
                registerForm.classList.remove('hidden');
                loginForm.classList.add('hidden');
            }
        }

        // –í—ã–±–æ—Ä –∫–ª–∞–Ω–∞
        function selectClan(clan) {
            state.selectedClan = clan;
            console.log("–£—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω –∫–ª–∞–Ω:", clan);
            
            // –°–Ω–∏–º–∞–µ–º –≤—ã–¥–µ–ª–µ–Ω–∏–µ —Å–æ –≤—Å–µ—Ö –∫–Ω–æ–ø–æ–∫
            document.querySelectorAll('.clan-btn').forEach(btn => {
                btn.classList.remove('clan-selected');
            });
            
            // –í—ã–¥–µ–ª—è–µ–º –≤—ã–±—Ä–∞–Ω–Ω—É—é –∫–Ω–æ–ø–∫—É
            document.querySelectorAll('.clan-btn').forEach(btn => {
                if (btn.getAttribute('data-clan') === clan) {
                    btn.classList.add('clan-selected');
                }
            });
            
            // –°–∫—Ä—ã–≤–∞–µ–º –æ—à–∏–±–∫—É –≤—ã–±–æ—Ä–∞ –∫–ª–∞–Ω–∞
            document.getElementById('clan-error').classList.add('hidden');
        }

        // –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è
        function register() {
            console.log("–ù–∞—á–∞–ª–æ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏...");
            const clan = state.selectedClan;
            const username = document.getElementById('reg-username').value.trim();
            const password = document.getElementById('reg-password').value;
            const firstName = document.getElementById('reg-firstname').value.trim();
            const lastName = document.getElementById('reg-lastname').value.trim();

            console.log("–î–∞–Ω–Ω—ã–µ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏:", { clan, username, password: '***', firstName, lastName });

            // –í–∞–ª–∏–¥–∞—Ü–∏—è
            if (!clan) {
                document.getElementById('clan-error').classList.remove('hidden');
                showNotification('–í—ã–±–µ—Ä–∏—Ç–µ –∫–ª–∞–Ω!', 'error');
                return;
            }

            if (!username.startsWith('@') || username.length < 3) {
                showNotification('–ù–∏–∫–Ω–µ–π–º –¥–æ–ª–∂–µ–Ω –Ω–∞—á–∏–Ω–∞—Ç—å—Å—è —Å @ –∏ —Å–æ–¥–µ—Ä–∂–∞—Ç—å –º–∏–Ω–∏–º—É–º 3 —Å–∏–º–≤–æ–ª–∞', 'error');
                return;
            }

            if (!/^@[a-zA-Z0-9_-]+$/.test(username)) {
                showNotification('–ù–∏–∫–Ω–µ–π–º –º–æ–∂–µ—Ç —Å–æ–¥–µ—Ä–∂–∞—Ç—å —Ç–æ–ª—å–∫–æ –∞–Ω–≥–ª–∏–π—Å–∫–∏–µ –±—É–∫–≤—ã, —Ü–∏—Ñ—Ä—ã, _ –∏ -', 'error');
                return;
            }

            if (DB.users.find(u => u.username === username)) {
                showNotification('–≠—Ç–æ—Ç –Ω–∏–∫–Ω–µ–π–º —É–∂–µ –∑–∞–Ω—è—Ç', 'error');
                return;
            }

            if (password.length < 8) {
                showNotification('–ü–∞—Ä–æ–ª—å –¥–æ–ª–∂–µ–Ω —Å–æ–¥–µ—Ä–∂–∞—Ç—å –º–∏–Ω–∏–º—É–º 8 —Å–∏–º–≤–æ–ª–æ–≤', 'error');
                return;
            }

            // –°–æ–∑–¥–∞–µ–º –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
            const newUser = {
                id: Date.now(),
                username,
                password,
                firstName: firstName || '',
                lastName: lastName || '',
                clan,
                balance: username === '@karkarich' ? 1000000000 : 1000, // –°—Ç–∞—Ä—Ç–æ–≤—ã–π –±–∞–ª–∞–Ω—Å 1000 –¥–ª—è –≤—Å–µ—Ö, –∫—Ä–æ–º–µ karkarich
                avatar: clan,
                createdAt: new Date().toISOString(),
                inventory: [],
                showcase: [],
                posts: [],
                friends: []
            };

            DB.users.push(newUser);
            saveToDB('users');
            
            // –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π –≤—Ö–æ–¥
            currentUser = newUser;
            saveCurrentUser();
            showApp();
            showNotification('–†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è —É—Å–ø–µ—à–Ω–∞! –î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å –≤ Cowboy Messenger!', 'success');
            
            // –û—á–∏—â–∞–µ–º —Ñ–æ—Ä–º—É
            document.getElementById('reg-username').value = '';
            document.getElementById('reg-password').value = '';
            document.getElementById('reg-firstname').value = '';
            document.getElementById('reg-lastname').value = '';
            
            // –û–±–Ω–æ–≤–ª—è–µ–º —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É
            updateClanStats();
            updateGlobalStats();
        }

        // –í—Ö–æ–¥
        function login() {
            console.log("–ü–æ–ø—ã—Ç–∫–∞ –≤—Ö–æ–¥–∞...");
            const username = document.getElementById('login-username').value.trim();
            const password = document.getElementById('login-password').value;

            console.log("–í—Ö–æ–¥ —Å –¥–∞–Ω–Ω—ã–º–∏:", { username, password: '***' });

            const user = DB.users.find(u => u.username === username && u.password === password);
            
            if (user) {
                console.log("–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–∞–π–¥–µ–Ω:", user.username);
                currentUser = user;
                saveCurrentUser();
                showApp();
                showNotification('–í—Ö–æ–¥ –≤—ã–ø–æ–ª–Ω–µ–Ω —É—Å–ø–µ—à–Ω–æ!', 'success');
                
                // –û—á–∏—â–∞–µ–º —Ñ–æ—Ä–º—É
                document.getElementById('login-username').value = '';
                document.getElementById('login-password').value = '';
                
                // –û–±–Ω–æ–≤–ª—è–µ–º —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É
                updateClanStats();
                updateGlobalStats();
                updateNotifications();
            } else {
                console.log("–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–µ –Ω–∞–π–¥–µ–Ω –∏–ª–∏ –Ω–µ–≤–µ—Ä–Ω—ã–π –ø–∞—Ä–æ–ª—å");
                showNotification('–ù–µ–≤–µ—Ä–Ω—ã–π –Ω–∏–∫–Ω–µ–π–º –∏–ª–∏ –ø–∞—Ä–æ–ª—å', 'error');
            }
        }

        // –í—ã—Ö–æ–¥
        function logout() {
            console.log("–í—ã—Ö–æ–¥ –∏–∑ —Å–∏—Å—Ç–µ–º—ã");
            currentUser = null;
            localStorage.removeItem('cowboy_current_user');
            showAuth();
            showNotification('–í—ã –≤—ã—à–ª–∏ –∏–∑ —Å–∏—Å—Ç–µ–º—ã', 'info');
        }

        // –ü–æ–∫–∞–∑–∞—Ç—å —Ä–∞–∑–¥–µ–ª
        function showSection(section) {
            console.log("–ü–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ –Ω–∞ —Ä–∞–∑–¥–µ–ª:", section);
            
            // –°–æ—Ö—Ä–∞–Ω—è–µ–º —Ç–µ–∫—É—â–∏–π —Ä–∞–∑–¥–µ–ª
            state.currentSection = section;
            
            // –û–±–Ω–æ–≤–ª—è–µ–º –∞–∫—Ç–∏–≤–Ω—É—é –∫–Ω–æ–ø–∫—É –≤ –Ω–∞–≤–∏–≥–∞—Ü–∏–∏
            document.querySelectorAll('.nav-btn').forEach(btn => {
                btn.classList.remove('nav-active');
                if (btn.getAttribute('data-section') === section) {
                    btn.classList.add('nav-active');
                }
            });
            
            // –°–∫—Ä—ã–≤–∞–µ–º –≤—Å–µ —Ä–∞–∑–¥–µ–ª—ã –∫–æ–Ω—Ç–µ–Ω—Ç–∞
            document.querySelectorAll('.section-content').forEach(div => {
                div.classList.remove('section-active');
            });
            
            // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –≤—ã–±—Ä–∞–Ω–Ω—ã–π —Ä–∞–∑–¥–µ–ª
            const sectionElement = document.getElementById(`${section}-content`);
            if (sectionElement) {
                sectionElement.classList.add('section-active');
            }
            
            // –û–±–Ω–æ–≤–ª—è–µ–º –∑–∞–≥–æ–ª–æ–≤–æ–∫
            const titles = {
                'feed': '–õ–µ–Ω—Ç–∞',
                'messenger': '–ú–µ—Å—Å–µ–Ω–¥–∂–µ—Ä',
                'profile': '–ü—Ä–æ—Ñ–∏–ª—å',
                'friends': '–î—Ä—É–∑—å—è',
                'shop': '–ú–∞–≥–∞–∑–∏–Ω',
                'transfers': '–ü–µ—Ä–µ–≤–æ–¥—ã',
                'admin': '–ê–¥–º–∏–Ω-–ø–∞–Ω–µ–ª—å'
            };

            const descriptions = {
                'feed': '–ü–æ—Å–ª–µ–¥–Ω–∏–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –æ—Ç –¥—Ä—É–∑–µ–π',
                'messenger': '–õ–∏—á–Ω—ã–µ —Å–æ–æ–±—â–µ–Ω–∏—è',
                'profile': '–í–∞—à –ø—Ä–æ—Ñ–∏–ª—å –∏ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞',
                'friends': '–ü–æ–∏—Å–∫ –∏ —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –¥—Ä—É–∑—å—è–º–∏',
                'shop': '–ü–æ–∫—É–ø–∫–∞ –∏ –ø—Ä–æ–¥–∞–∂–∞ –ø–æ–¥–∞—Ä–∫–æ–≤',
                'transfers': '–ü–µ—Ä–µ–≤–æ–¥—ã –∏ –∏—Å—Ç–æ—Ä–∏—è –æ–ø–µ—Ä–∞—Ü–∏–π',
                'admin': '–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Å–∏—Å—Ç–µ–º–æ–π'
            };

            document.getElementById('current-section').textContent = titles[section] || '–õ–µ–Ω—Ç–∞';
            document.getElementById('current-section-description').textContent = descriptions[section] || '–ü–æ—Å–ª–µ–¥–Ω–∏–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –æ—Ç –¥—Ä—É–∑–µ–π';
            
            // –ó–∞–≥—Ä—É–∂–∞–µ–º –∫–æ–Ω—Ç–µ–Ω—Ç —Ä–∞–∑–¥–µ–ª–∞
            loadSectionContent(section);
            
            // –û–±–Ω–æ–≤–ª—è–µ–º —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –ø—Ä–∏ –ø–µ—Ä–µ—Ö–æ–¥–µ –≤ —Ä–∞–∑–¥–µ–ª
            if (section === 'messenger' || section === 'friends' || section === 'feed') {
                updateNotifications();
            }
        }

        // –ó–∞–≥—Ä—É–∑–∏—Ç—å –∫–æ–Ω—Ç–µ–Ω—Ç —Ä–∞–∑–¥–µ–ª–∞
        function loadSectionContent(section) {
            switch(section) {
                case 'feed':
                    loadFeed();
                    break;
                case 'messenger':
                    loadMessenger();
                    break;
                case 'profile':
                    loadProfile();
                    break;
                case 'friends':
                    loadFriends();
                    break;
                case 'shop':
                    loadShop();
                    break;
                case 'transfers':
                    loadTransfers();
                    break;
                case 'admin':
                    loadAdminPanel();
                    break;
            }
        }

        // –ó–∞–≥—Ä—É–∑–∏—Ç—å —Ç–µ–∫—É—â–∏–π —Ä–∞–∑–¥–µ–ª (–ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è)
        function loadCurrentSection() {
            loadSectionContent(state.currentSection);
        }

        // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —à–∞–ø–∫–∏
        function updateHeader() {
            if (!currentUser) return;

            document.getElementById('header-user').innerHTML = `
                <div class="text-right">
                    <div class="font-bold">${currentUser.firstName || currentUser.username}</div>
                    <div class="text-xs text-gray-400">${currentUser.clan} ${currentUser.username}</div>
                </div>
                <div class="w-10 h-10 rounded-full bg-gradient-to-r from-blue-500 to-cyan-400 flex items-center justify-center text-lg">
                    ${currentUser.clan}
                </div>
            `;

            document.getElementById('header-balance').textContent = `${currentUser.balance} C`;
            document.getElementById('user-balance').textContent = `${currentUser.balance} C`;
        }

        // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏ –∫–ª–∞–Ω–æ–≤ (–ø—Ä–∞–≤–∞—è –ø–∞–Ω–µ–ª—å)
        function updateClanStats() {
            const clanStatsElement = document.getElementById('clan-stats');
            if (!clanStatsElement) return;
            
            // –°–æ–±–∏—Ä–∞–µ–º —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É –ø–æ –∫–ª–∞–Ω–∞–º, –∏—Å–∫–ª—é—á–∞—è @karkarich –∏–∑ —Ä–∞—Å—á–µ—Ç–∞ –±–∞–ª–∞–Ω—Å–∞
            const clanStats = {};
            DB.users.forEach(user => {
                if (user.username === '@karkarich') return; // –ò—Å–∫–ª—é—á–∞–µ–º karkarich –∏–∑ –ª–∏–¥–µ—Ä–æ–≤
                
                if (!clanStats[user.clan]) {
                    clanStats[user.clan] = {
                        count: 0,
                        totalBalance: 0,
                        emoji: user.clan
                    };
                }
                clanStats[user.clan].count++;
                clanStats[user.clan].totalBalance += user.balance;
            });
            
            // –ü—Ä–µ–æ–±—Ä–∞–∑—É–µ–º –≤ –º–∞—Å—Å–∏–≤ –∏ —Å–æ—Ä—Ç–∏—Ä—É–µ–º –ø–æ –∫–æ–ª–∏—á–µ—Å—Ç–≤—É —É—á–∞—Å—Ç–Ω–∏–∫–æ–≤
            const sortedClans = Object.entries(clanStats)
                .map(([clan, stats]) => ({
                    clan,
                    ...stats
                }))
                .sort((a, b) => b.count - a.count);
            
            if (sortedClans.length === 0) {
                clanStatsElement.innerHTML = '<p class="text-gray-400 text-center">–ù–µ—Ç –¥–∞–Ω–Ω—ã—Ö –æ –∫–ª–∞–Ω–∞—Ö</p>';
                return;
            }
            
            clanStatsElement.innerHTML = sortedClans.map((clan, index) => `
                <div class="bg-slate-800/50 rounded-xl p-4 hover:bg-slate-800 transition cursor-pointer ${currentUser?.clan === clan.clan ? 'border border-blue-500' : ''}">
                    <div class="flex items-center justify-between mb-2">
                        <div class="flex items-center space-x-3">
                            <div class="text-2xl">${clan.emoji}</div>
                            <div>
                                <div class="font-bold">${getClanName(clan.clan)}</div>
                                <div class="text-xs text-gray-400">${index === 0 ? 'üëë –õ–∏–¥–µ—Ä' : index === 1 ? 'ü•à 2 –º–µ—Å—Ç–æ' : index === 2 ? 'ü•â 3 –º–µ—Å—Ç–æ' : `${index + 1} –º–µ—Å—Ç–æ`}</div>
                            </div>
                        </div>
                        <div class="text-right">
                            <div class="font-bold">${clan.count} —á–µ–ª.</div>
                            <div class="text-xs text-yellow-300">${clan.totalBalance} C</div>
                        </div>
                    </div>
                    <div class="w-full bg-slate-700 rounded-full h-2">
                        <div class="bg-gradient-to-r from-blue-500 to-cyan-400 h-2 rounded-full" style="width: ${Math.min(100, (clan.count / Math.max(1, sortedClans[0].count)) * 100)}%"></div>
                    </div>
                </div>
            `).join('');
            
            // –û–±–Ω–æ–≤–ª—è–µ–º –ª–∏–¥–µ—Ä–±–æ—Ä–¥ –≤ –ª–µ–≤–æ–π –ø–∞–Ω–µ–ª–∏
            updateClanLeaderboard();
        }

        // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –ª–∏–¥–µ—Ä–±–æ—Ä–¥–∞ –∫–ª–∞–Ω–æ–≤ (–ª–µ–≤–∞—è –ø–∞–Ω–µ–ª—å)
        function updateClanLeaderboard() {
            const leaderboard = document.getElementById('clan-leaderboard');
            if (!leaderboard) return;
            
            // –°–æ–±–∏—Ä–∞–µ–º —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É –ø–æ –∫–ª–∞–Ω–∞–º, –∏—Å–∫–ª—é—á–∞—è @karkarich
            const clanStats = {};
            DB.users.forEach(user => {
                if (user.username === '@karkarich') return; // –ò—Å–∫–ª—é—á–∞–µ–º karkarich
                
                if (!clanStats[user.clan]) {
                    clanStats[user.clan] = {
                        count: 0,
                        totalBalance: 0,
                        emoji: user.clan
                    };
                }
                clanStats[user.clan].count++;
                clanStats[user.clan].totalBalance += user.balance;
            });
            
            // –ü—Ä–µ–æ–±—Ä–∞–∑—É–µ–º –≤ –º–∞—Å—Å–∏–≤ –∏ —Å–æ—Ä—Ç–∏—Ä—É–µ–º –ø–æ –∫–æ–ª–∏—á–µ—Å—Ç–≤—É —É—á–∞—Å—Ç–Ω–∏–∫–æ–≤, –±–µ—Ä–µ–º —Ç–æ–ø 3
            const topClans = Object.entries(clanStats)
                .map(([clan, stats]) => ({
                    clan,
                    ...stats
                }))
                .sort((a, b) => b.count - a.count)
                .slice(0, 3);
            
            if (topClans.length === 0) {
                leaderboard.innerHTML = '<p class="text-gray-400 text-sm">–ù–µ—Ç –¥–∞–Ω–Ω—ã—Ö</p>';
                return;
            }
            
            leaderboard.innerHTML = topClans.map((clan, index) => `
                <div class="flex items-center justify-between p-2 hover:bg-slate-800/50 rounded-lg transition">
                    <div class="flex items-center space-x-2">
                        <div class="clan-badge ${index === 0 ? 'bg-gradient-to-r from-yellow-500 to-yellow-300' : index === 1 ? 'bg-gradient-to-r from-gray-400 to-gray-300' : 'bg-gradient-to-r from-amber-700 to-amber-600'}">
                            ${clan.emoji}
                        </div>
                        <div>
                            <div class="text-sm font-bold">${index === 0 ? 'ü•á' : index === 1 ? 'ü•à' : 'ü•â'} ${getClanName(clan.clan)}</div>
                            <div class="text-xs text-gray-400">${clan.count} —É—á–∞—Å—Ç–Ω–∏–∫–æ–≤</div>
                        </div>
                    </div>
                    <div class="text-right">
                        <div class="text-sm text-yellow-300">${clan.totalBalance.toLocaleString()} C</div>
                    </div>
                </div>
            `).join('');
        }

        // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –æ–±—â–µ–π —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏
        function updateGlobalStats() {
            document.getElementById('total-users').textContent = DB.users.length;
            document.getElementById('total-posts').textContent = DB.posts.length;
            
            // –ê–∫—Ç–∏–≤–Ω—ã–µ —á–∞—Ç—ã (–≥–¥–µ –µ—Å—Ç—å —Å–æ–æ–±—â–µ–Ω–∏—è –∑–∞ –ø–æ—Å–ª–µ–¥–Ω–∏–µ 7 –¥–Ω–µ–π)
            const weekAgo = new Date(Date.now() - 7 * 24 * 60 * 60 * 1000);
            const activeChats = DB.chats.filter(chat => {
                const lastMessage = DB.chatMessages
                    .filter(m => m.chatId === chat.id)
                    .sort((a, b) => new Date(b.createdAt) - new Date(a.createdAt))[0];
                return lastMessage && new Date(lastMessage.createdAt) > weekAgo;
            }).length;
            
            document.getElementById('total-chats').textContent = activeChats;
            
            // –û–±—â–∏–π –±–∞–ª–∞–Ω—Å –±–µ–∑ —É—á–µ—Ç–∞ karkarich
            const totalBalance = DB.users.reduce((sum, user) => {
                if (user.username === '@karkarich') return sum;
                return sum + user.balance;
            }, 0);
            document.getElementById('total-balance').textContent = `${totalBalance.toLocaleString()} C`;
        }

        // ===========================================
        // –§–£–ù–ö–¶–ò–û–ù–ê–õ –ú–ï–î–ò–ê–§–ê–ô–õ–û–í (–§–û–¢–û/–í–ò–î–ï–û)
        // ===========================================

        function handleMediaUpload(e) {
            const files = e.target.files;
            const previewContainer = document.getElementById('media-preview');
            
            if (!files.length) return;
            
            previewContainer.classList.remove('hidden');
            previewContainer.innerHTML = '';
            
            for (let i = 0; i < Math.min(files.length, 6); i++) {
                const file = files[i];
                const reader = new FileReader();
                
                reader.onload = function(e) {
                    const media = {
                        id: Date.now() + i,
                        url: e.target.result,
                        type: file.type.startsWith('video') ? 'video' : 'image',
                        file: file
                    };
                    
                    selectedMedia.push(media);
                    
                    const preview = document.createElement('div');
                    preview.className = 'relative';
                    
                    if (file.type.startsWith('video')) {
                        preview.innerHTML = `
                            <video src="${e.target.result}" controls class="w-full h-32 object-cover rounded-lg"></video>
                            <button type="button" onclick="removeMedia(${media.id})" class="absolute top-1 right-1 bg-red-600 text-white rounded-full w-6 h-6 flex items-center justify-center text-xs">
                                <i class="fas fa-times"></i>
                            </button>
                        `;
                    } else {
                        preview.innerHTML = `
                            <img src="${e.target.result}" class="w-full h-32 object-cover rounded-lg">
                            <button type="button" onclick="removeMedia(${media.id})" class="absolute top-1 right-1 bg-red-600 text-white rounded-full w-6 h-6 flex items-center justify-center text-xs">
                                <i class="fas fa-times"></i>
                            </button>
                        `;
                    }
                    
                    previewContainer.appendChild(preview);
                };
                
                reader.readAsDataURL(file);
            }
        }

        function handleChatMedia(e) {
            const files = e.target.files;
            if (!files.length) return;
            
            const file = files[0];
            const reader = new FileReader();
            
            reader.onload = function(e) {
                if (file.type.startsWith('video')) {
                    sendMessageWithMedia(e.target.result, 'video');
                } else {
                    sendMessageWithMedia(e.target.result, 'image');
                }
                
                // –û—á–∏—â–∞–µ–º input
                e.target.value = '';
            };
            
            reader.readAsDataURL(file);
        }

        function removeMedia(id) {
            selectedMedia = selectedMedia.filter(m => m.id !== id);
            updateMediaPreview();
        }

        function clearMedia() {
            selectedMedia = [];
            document.getElementById('post-media').value = '';
            document.getElementById('media-preview').classList.add('hidden');
            document.getElementById('media-preview').innerHTML = '';
        }

        function updateMediaPreview() {
            const previewContainer = document.getElementById('media-preview');
            
            if (selectedMedia.length === 0) {
                previewContainer.classList.add('hidden');
                previewContainer.innerHTML = '';
                return;
            }
            
            previewContainer.classList.remove('hidden');
            previewContainer.innerHTML = '';
            
            selectedMedia.forEach(media => {
                const preview = document.createElement('div');
                preview.className = 'relative';
                
                if (media.type === 'video') {
                    preview.innerHTML = `
                        <video src="${media.url}" controls class="w-full h-32 object-cover rounded-lg"></video>
                        <button type="button" onclick="removeMedia(${media.id})" class="absolute top-1 right-1 bg-red-600 text-white rounded-full w-6 h-6 flex items-center justify-center text-xs">
                            <i class="fas fa-times"></i>
                        </button>
                    `;
                } else {
                    preview.innerHTML = `
                        <img src="${media.url}" class="w-full h-32 object-cover rounded-lg">
                        <button type="button" onclick="removeMedia(${media.id})" class="absolute top-1 right-1 bg-red-600 text-white rounded-full w-6 h-6 flex items-center justify-center text-xs">
                            <i class="fas fa-times"></i>
                        </button>
                    `;
                }
                
                previewContainer.appendChild(preview);
            });
        }

        // –°–æ–∑–¥–∞–Ω–∏–µ –ø–æ—Å—Ç–∞ —Å –º–µ–¥–∏–∞—Ñ–∞–π–ª–∞–º–∏
        function createPost() {
            const content = document.getElementById('post-content').value.trim();

            if (!content && selectedMedia.length === 0) {
                showNotification('–í–≤–µ–¥–∏—Ç–µ —Ç–µ–∫—Å—Ç –∏–ª–∏ –¥–æ–±–∞–≤—å—Ç–µ –º–µ–¥–∏–∞—Ñ–∞–π–ª—ã', 'error');
                return;
            }

            // –°–æ—Ö—Ä–∞–Ω—è–µ–º –º–µ–¥–∏–∞—Ñ–∞–π–ª—ã –≤ localStorage
            const mediaUrls = selectedMedia.map(media => media.url);

            const post = {
                id: Date.now(),
                userId: currentUser.id,
                username: currentUser.username,
                userAvatar: currentUser.clan,
                content,
                media: mediaUrls,
                likes: [],
                comments: [],
                createdAt: new Date().toISOString()
            };

            DB.posts.unshift(post);
            saveToDB('posts');
            
            // –î–æ–±–∞–≤–ª—è–µ–º –ø–æ—Å—Ç –≤ –ø—Ä–æ—Ñ–∏–ª—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
            if (!currentUser.posts) currentUser.posts = [];
            currentUser.posts.push(post.id);
            saveToDB('users');
            saveCurrentUser();

            document.getElementById('post-content').value = '';
            clearMedia();
            
            loadFeed();
            showNotification('–ü–æ—Å—Ç –æ–ø—É–±–ª–∏–∫–æ–≤–∞–Ω!', 'success');
            
            // –û–±–Ω–æ–≤–ª—è–µ–º —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É
            updateGlobalStats();
            
            // –°–æ–∑–¥–∞–µ–º —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –¥–ª—è –¥—Ä—É–∑–µ–π
            createPostNotifications(post);
        }

        // –ó–∞–≥—Ä—É–∑–∫–∞ –ª–µ–Ω—Ç—ã
        function loadFeed() {
            const container = document.getElementById('posts-container');
            if (!container) return;
            
            container.innerHTML = '';

            // –°–æ—Ä—Ç–∏—Ä—É–µ–º –ø–æ –¥–∞—Ç–µ (–Ω–æ–≤—ã–µ –ø–µ—Ä–≤—ã–º–∏)
            const sortedPosts = [...DB.posts].sort((a, b) => new Date(b.createdAt) - new Date(a.createdAt));

            if (sortedPosts.length === 0) {
                container.innerHTML = `
                    <div class="glassmorphism rounded-2xl p-8 text-center">
                        <div class="w-16 h-16 rounded-full bg-slate-800 flex items-center justify-center text-2xl mx-auto mb-4">
                            ü§†
                        </div>
                        <h3 class="text-xl font-bold mb-2">–õ–µ–Ω—Ç–∞ –ø—É—Å—Ç–∞</h3>
                        <p class="text-gray-400">–ë—É–¥—å—Ç–µ –ø–µ—Ä–≤—ã–º, –∫—Ç–æ –æ–ø—É–±–ª–∏–∫—É–µ—Ç —á—Ç–æ-—Ç–æ –∏–Ω—Ç–µ—Ä–µ—Å–Ω–æ–µ!</p>
                    </div>
                `;
                return;
            }

            sortedPosts.forEach(post => {
                const user = DB.users.find(u => u.id === post.userId);
                const isLiked = post.likes.includes(currentUser.id);
                const isAuthor = post.userId === currentUser.id;
                const isAdmin = currentUser.username === '@karkarich';

                const postElement = document.createElement('div');
                postElement.className = 'glassmorphism rounded-2xl p-6 mb-6 fade-in';
                postElement.innerHTML = `
                    <div class="flex items-start justify-between mb-4">
                        <div class="flex items-center space-x-3">
                            <div class="w-12 h-12 rounded-full bg-gradient-to-r from-blue-500 to-cyan-400 flex items-center justify-center text-xl">
                                ${user?.clan || 'ü§†'}
                            </div>
                            <div>
                                <div class="font-bold">${user?.firstName || user?.username || post.username}</div>
                                <div class="text-sm text-gray-400">${post.username} ‚Ä¢ ${formatDate(post.createdAt)}</div>
                            </div>
                        </div>
                        ${(isAuthor || isAdmin) ? `
                        <div class="relative">
                            <button class="post-menu-btn w-8 h-8 rounded-full hover:bg-slate-700 flex items-center justify-center" data-post-id="${post.id}">
                                <i class="fas fa-ellipsis-h"></i>
                            </button>
                        </div>` : ''}
                    </div>

                    <p class="mb-4 whitespace-pre-line">${post.content}</p>

                    ${post.media && post.media.length > 0 ? `
                    <div class="mb-6">
                        <div class="grid grid-cols-${Math.min(post.media.length, 3)} gap-2">
                            ${post.media.map((url, index) => {
                                if (url.includes('data:video')) {
                                    return `<video src="${url}" controls class="w-full h-48 object-cover rounded-lg"></video>`;
                                } else {
                                    return `<img src="${url}" class="post-image w-full h-48 object-cover rounded-lg" onclick="showFullMedia('${url}')">`;
                                }
                            }).join('')}
                        </div>
                    </div>` : ''}

                    <div class="flex items-center justify-between pt-4 border-t border-slate-700">
                        <div class="flex items-center space-x-6">
                            <button class="like-btn flex items-center space-x-2 ${isLiked ? 'text-red-500' : 'text-gray-400 hover:text-red-400'}" data-post-id="${post.id}">
                                <i class="${isLiked ? 'fas' : 'far'} fa-heart"></i>
                                <span>${post.likes.length}</span>
                            </button>
                            <button class="comments-btn flex items-center space-x-2 text-gray-400 hover:text-blue-400" data-post-id="${post.id}">
                                <i class="far fa-comment"></i>
                                <span>${post.comments.length}</span>
                            </button>
                        </div>
                    </div>
                    
                    ${post.comments && post.comments.length > 0 ? `
                    <div class="mt-4 pt-4 border-t border-slate-700">
                        <h4 class="font-bold mb-2">–ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏ (${post.comments.length}):</h4>
                        <div class="space-y-3">
                            ${post.comments.slice(0, 3).map(comment => `
                                <div class="flex items-start space-x-3">
                                    <div class="w-8 h-8 rounded-full bg-slate-700 flex items-center justify-center text-sm">
                                        ${comment.userAvatar || 'ü§†'}
                                    </div>
                                    <div class="flex-1">
                                        <div class="font-bold text-sm">${comment.username}</div>
                                        <p class="text-sm">${comment.content}</p>
                                    </div>
                                </div>
                            `).join('')}
                        </div>
                        ${post.comments.length > 3 ? `
                        <button class="mt-2 text-blue-400 text-sm" onclick="showCommentsModal(${post.id})">
                            –ü–æ–∫–∞–∑–∞—Ç—å –≤—Å–µ –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏ (${post.comments.length})
                        </button>` : ''}
                        <div class="mt-3 flex space-x-3">
                            <input type="text" class="flex-1 bg-slate-800/50 border border-slate-700 rounded-xl px-4 py-2 text-sm" placeholder="–î–æ–±–∞–≤–∏—Ç—å –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π..." data-post-id="${post.id}">
                            <button class="add-comment-btn bg-blue-600 hover:bg-blue-700 px-4 rounded-xl text-sm" data-post-id="${post.id}">
                                <i class="fas fa-paper-plane"></i>
                            </button>
                        </div>
                    </div>` : `
                    <div class="mt-4 pt-4 border-t border-slate-700">
                        <div class="flex space-x-3">
                            <input type="text" class="flex-1 bg-slate-800/50 border border-slate-700 rounded-xl px-4 py-2 text-sm" placeholder="–î–æ–±–∞–≤–∏—Ç—å –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π..." data-post-id="${post.id}">
                            <button class="add-comment-btn bg-blue-600 hover:bg-blue-700 px-4 rounded-xl text-sm" data-post-id="${post.id}">
                                <i class="fas fa-paper-plane"></i>
                            </button>
                        </div>
                    </div>`}
                `;
                container.appendChild(postElement);
            });

            // –î–æ–±–∞–≤–ª—è–µ–º –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ —Å–æ–±—ã—Ç–∏–π –¥–ª—è –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏ —Å–æ–∑–¥–∞–Ω–Ω—ã—Ö —ç–ª–µ–º–µ–Ω—Ç–æ–≤
            setTimeout(() => {
                document.querySelectorAll('.like-btn').forEach(btn => {
                    btn.addEventListener('click', function(e) {
                        e.preventDefault();
                        e.stopPropagation();
                        const postId = parseInt(this.getAttribute('data-post-id'));
                        toggleLike(postId);
                    });
                });

                document.querySelectorAll('.post-menu-btn').forEach(btn => {
                    btn.addEventListener('click', function(e) {
                        e.preventDefault();
                        e.stopPropagation();
                        const postId = parseInt(this.getAttribute('data-post-id'));
                        showPostMenu(postId);
                    });
                });

                document.querySelectorAll('.add-comment-btn').forEach(btn => {
                    btn.addEventListener('click', function(e) {
                        e.preventDefault();
                        e.stopPropagation();
                        const postId = parseInt(this.getAttribute('data-post-id'));
                        const input = this.previousElementSibling;
                        addComment(postId, input.value);
                        input.value = '';
                    });
                });

                document.querySelectorAll('.add-comment-btn').forEach(btn => {
                    btn.addEventListener('click', function(e) {
                        e.preventDefault();
                        e.stopPropagation();
                        const postId = parseInt(this.getAttribute('data-post-id'));
                        const input = this.previousElementSibling;
                        addComment(postId, input.value);
                        input.value = '';
                    });
                });
            }, 100);
        }

        // –õ–∞–π–∫ –ø–æ—Å—Ç–∞
        function toggleLike(postId) {
            const post = DB.posts.find(p => p.id === postId);
            if (!post) return;

            const likeIndex = post.likes.indexOf(currentUser.id);
            const likeBtn = document.querySelector(`.like-btn[data-post-id="${postId}"] i`);
            
            if (likeIndex === -1) {
                post.likes.push(currentUser.id);
                likeBtn.classList.remove('far');
                likeBtn.classList.add('fas');
                likeBtn.classList.add('like-animation');
                
                // –°–æ–∑–¥–∞–µ–º —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –¥–ª—è –∞–≤—Ç–æ—Ä–∞ –ø–æ—Å—Ç–∞
                if (post.userId !== currentUser.id) {
                    createNotification({
                        id: Date.now(),
                        userId: post.userId,
                        type: 'like',
                        fromUserId: currentUser.id,
                        fromUsername: currentUser.username,
                        postId: postId,
                        message: `${currentUser.username} –ø–æ—Å—Ç–∞–≤–∏–ª(–∞) –ª–∞–π–∫ –≤–∞—à–µ–º—É –ø–æ—Å—Ç—É`,
                        read: false,
                        createdAt: new Date().toISOString()
                    });
                }
                
                setTimeout(() => {
                    likeBtn.classList.remove('like-animation');
                }, 600);
                
                showNotification('–õ–∞–π–∫ –ø–æ—Å—Ç–∞–≤–ª–µ–Ω!', 'success');
            } else {
                post.likes.splice(likeIndex, 1);
                likeBtn.classList.remove('fas');
                likeBtn.classList.add('far');
                showNotification('–õ–∞–π–∫ —É–±—Ä–∞–Ω', 'info');
            }

            saveToDB('posts');
            
            // –û–±–Ω–æ–≤–ª—è–µ–º —Å—á–µ—Ç—á–∏–∫ –ª–∞–π–∫–æ–≤
            const likeCount = document.querySelector(`.like-btn[data-post-id="${postId}"] span`);
            if (likeCount) {
                likeCount.textContent = post.likes.length;
            }
            
            // –û–±–Ω–æ–≤–ª—è–µ–º —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è
            updateNotifications();
        }

        // –î–æ–±–∞–≤–∏—Ç—å –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π
        function addComment(postId, content) {
            if (!content.trim()) return;

            const post = DB.posts.find(p => p.id === postId);
            if (!post) return;

            if (!post.comments) post.comments = [];

            const comment = {
                id: Date.now(),
                userId: currentUser.id,
                username: currentUser.username,
                userAvatar: currentUser.clan,
                content: content.trim(),
                createdAt: new Date().toISOString()
            };

            post.comments.push(comment);
            saveToDB('posts');

            // –°–æ–∑–¥–∞–µ–º —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –¥–ª—è –∞–≤—Ç–æ—Ä–∞ –ø–æ—Å—Ç–∞
            if (post.userId !== currentUser.id) {
                createNotification({
                    id: Date.now(),
                    userId: post.userId,
                    type: 'comment',
                    fromUserId: currentUser.id,
                    fromUsername: currentUser.username,
                    postId: postId,
                    message: `${currentUser.username} –ø—Ä–æ–∫–æ–º–º–µ–Ω—Ç–∏—Ä–æ–≤–∞–ª(–∞) –≤–∞—à –ø–æ—Å—Ç: "${content.trim()}"`,
                    read: false,
                    createdAt: new Date().toISOString()
                });
            }

            // –û–±–Ω–æ–≤–ª—è–µ–º –ª–µ–Ω—Ç—É
            loadFeed();
            showNotification('–ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π –¥–æ–±–∞–≤–ª–µ–Ω!', 'success');
            
            // –û–±–Ω–æ–≤–ª—è–µ–º —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è
            updateNotifications();
        }

        // ===========================================
        // –ú–ï–°–°–ï–ù–î–ñ–ï–†
        // ===========================================

        function loadMessenger() {
            const chatsList = document.getElementById('chats-list');
            if (!chatsList) return;

            // –ü–æ–ª—É—á–∞–µ–º —á–∞—Ç—ã —Ç–µ–∫—É—â–µ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
            const userChats = DB.chats.filter(chat => 
                chat.participants.includes(currentUser.id)
            );

            if (userChats.length === 0) {
                chatsList.innerHTML = `
                    <div class="text-center p-4 text-gray-400">
                        <i class="fas fa-comments text-2xl mb-2"></i>
                        <p>–£ –≤–∞—Å –ø–æ–∫–∞ –Ω–µ—Ç —á–∞—Ç–æ–≤</p>
                        <button id="create-first-chat" class="mt-3 btn-primary py-2 px-4 rounded-xl text-sm">
                            –ù–∞—á–∞—Ç—å –æ–±—â–µ–Ω–∏–µ
                        </button>
                    </div>
                `;
                
                setTimeout(() => {
                    const btn = document.getElementById('create-first-chat');
                    if (btn) {
                        btn.addEventListener('click', function(e) {
                            e.preventDefault();
                            e.stopPropagation();
                            showNewChatModal();
                        });
                    }
                }, 100);
                
                return;
            }

            chatsList.innerHTML = '';
            
            userChats.forEach(chat => {
                const otherUserId = chat.participants.find(id => id !== currentUser.id);
                const otherUser = DB.users.find(u => u.id === otherUserId);
                if (!otherUser) return;

                const lastMessage = DB.chatMessages
                    .filter(m => m.chatId === chat.id)
                    .sort((a, b) => new Date(b.createdAt) - new Date(a.createdAt))[0];

                const unreadCount = DB.chatMessages.filter(m => 
                    m.chatId === chat.id && 
                    m.senderId !== currentUser.id && 
                    !m.read
                ).length;

                const chatElement = document.createElement('div');
                chatElement.className = `p-3 rounded-xl bg-slate-800/50 hover:bg-slate-800 cursor-pointer transition ${activeChatId === chat.id ? 'border border-blue-500' : ''}`;
                chatElement.innerHTML = `
                    <div class="flex items-center space-x-3">
                        <div class="w-10 h-10 rounded-full bg-gradient-to-r from-blue-500 to-cyan-400 flex items-center justify-center">
                            ${otherUser.clan}
                        </div>
                        <div class="flex-1 min-w-0">
                            <div class="font-bold truncate">${otherUser.firstName || otherUser.username}</div>
                            <div class="text-sm text-gray-400 truncate">${lastMessage ? (lastMessage.type === 'text' ? lastMessage.content : lastMessage.type === 'image' ? 'üì∑ –§–æ—Ç–æ' : 'üí∞ –ü–µ—Ä–µ–≤–æ–¥') : '–ù–µ—Ç —Å–æ–æ–±—â–µ–Ω–∏–π'}</div>
                        </div>
                        ${unreadCount > 0 ? `<span class="unread-badge">${unreadCount}</span>` : ''}
                    </div>
                `;
                
                chatElement.addEventListener('click', function(e) {
                    e.preventDefault();
                    e.stopPropagation();
                    openChat(chat.id, otherUser);
                });
                chatsList.appendChild(chatElement);
            });

            // –û–±–Ω–æ–≤–ª—è–µ–º —Å—á–µ—Ç—á–∏–∫ –Ω–µ–ø—Ä–æ—á–∏—Ç–∞–Ω–Ω—ã—Ö —á–∞—Ç–æ–≤
            updateUnreadChatsCount();
        }

        function openChat(chatId, otherUser) {
            activeChatId = chatId;
            activeChatUser = otherUser;

            // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –∞–∫—Ç–∏–≤–Ω—ã–π —á–∞—Ç, —Å–∫—Ä—ã–≤–∞–µ–º –∑–∞–≥–ª—É—à–∫—É
            document.getElementById('no-chat-selected').classList.add('hidden');
            document.getElementById('active-chat').classList.remove('hidden');

            // –û–±–Ω–æ–≤–ª—è–µ–º –∑–∞–≥–æ–ª–æ–≤–æ–∫ —á–∞—Ç–∞
            document.getElementById('chat-header').innerHTML = `
                <div class="flex items-center space-x-3">
                    <div class="w-12 h-12 rounded-full bg-gradient-to-r from-blue-500 to-cyan-400 flex items-center justify-center text-xl">
                        ${otherUser.clan}
                    </div>
                    <div>
                        <div class="font-bold text-lg">${otherUser.firstName || otherUser.username}</div>
                        <div class="text-sm text-gray-400">${otherUser.username}</div>
                    </div>
                </div>
            `;

            // –ó–∞–≥—Ä—É–∂–∞–µ–º —Å–æ–æ–±—â–µ–Ω–∏—è
            loadChatMessages(chatId);

            // –ü–æ–º–µ—á–∞–µ–º —Å–æ–æ–±—â–µ–Ω–∏—è –∫–∞–∫ –ø—Ä–æ—á–∏—Ç–∞–Ω–Ω—ã–µ
            markChatAsRead(chatId);
        }

        function loadChatMessages(chatId) {
            const container = document.getElementById('messages-container');
            if (!container) return;

            const messages = DB.chatMessages
                .filter(m => m.chatId === chatId)
                .sort((a, b) => new Date(a.createdAt) - new Date(b.createdAt));

            container.innerHTML = '';

            messages.forEach(message => {
                const isOwn = message.senderId === currentUser.id;
                const sender = DB.users.find(u => u.id === message.senderId);

                const messageElement = document.createElement('div');
                messageElement.className = `flex ${isOwn ? 'justify-end' : 'justify-start'}`;

                let messageContent = '';
                
                switch (message.type) {
                    case 'text':
                        messageContent = `<p>${message.content}</p>`;
                        break;
                    case 'image':
                        messageContent = `
                            <img src="${message.content}" class="message-image cursor-pointer" onclick="showFullMedia('${message.content}')">
                            <p class="text-xs text-gray-400 mt-1">üì∑ –§–æ—Ç–æ</p>
                        `;
                        break;
                    case 'video':
                        messageContent = `
                            <video src="${message.content}" controls class="message-image"></video>
                            <p class="text-xs text-gray-400 mt-1">üé• –í–∏–¥–µ–æ</p>
                        `;
                        break;
                    case 'transfer':
                        const amount = message.amount || 0;
                        messageContent = `
                            <div class="bg-yellow-900/30 p-3 rounded-lg">
                                <div class="flex items-center space-x-2">
                                    <i class="fas fa-money-bill text-yellow-400"></i>
                                    <span class="font-bold">–ü–µ—Ä–µ–≤–æ–¥ ${amount} C</span>
                                </div>
                                ${message.content ? `<p class="text-sm mt-1">${message.content}</p>` : ''}
                            </div>
                        `;
                        break;
                }

                messageElement.innerHTML = `
                    <div class="max-w-xs md:max-w-md">
                        <div class="${isOwn ? 'bg-blue-600' : 'bg-slate-700'} rounded-2xl p-4">
                            ${!isOwn ? `<div class="text-xs font-bold mb-1">${sender?.username || '–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å'}</div>` : ''}
                            ${messageContent}
                            <div class="text-xs ${isOwn ? 'text-gray-300' : 'text-gray-400'} mt-2">
                                ${formatTime(message.createdAt)}
                                ${isOwn && message.read ? ' ‚úì‚úì' : isOwn ? ' ‚úì' : ''}
                            </div>
                        </div>
                    </div>
                `;

                container.appendChild(messageElement);
            });

            // –ü—Ä–æ–∫—Ä—É—á–∏–≤–∞–µ–º –≤–Ω–∏–∑
            setTimeout(() => {
                container.scrollTop = container.scrollHeight;
            }, 100);
        }

        function sendMessage() {
            const input = document.getElementById('message-input');
            const content = input.value.trim();

            if (!content && !activeChatId) return;

            if (!activeChatId) {
                showNotification('–í—ã–±–µ—Ä–∏—Ç–µ —á–∞—Ç –¥–ª—è –æ—Ç–ø—Ä–∞–≤–∫–∏ —Å–æ–æ–±—â–µ–Ω–∏—è', 'error');
                return;
            }

            const message = {
                id: Date.now(),
                chatId: activeChatId,
                senderId: currentUser.id,
                type: 'text',
                content: content,
                read: false,
                createdAt: new Date().toISOString()
            };

            DB.chatMessages.push(message);
            saveToDB('chatMessages');

            // –û—á–∏—â–∞–µ–º –ø–æ–ª–µ –≤–≤–æ–¥–∞
            input.value = '';

            // –û–±–Ω–æ–≤–ª—è–µ–º —Å–æ–æ–±—â–µ–Ω–∏—è
            loadChatMessages(activeChatId);

            // –û–±–Ω–æ–≤–ª—è–µ–º —Å–ø–∏—Å–æ–∫ —á–∞—Ç–æ–≤
            loadMessenger();

            // –°–æ–∑–¥–∞–µ–º —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –¥–ª—è –ø–æ–ª—É—á–∞—Ç–µ–ª—è
            const otherUserId = activeChatUser.id;
            createNotification({
                id: Date.now(),
                userId: otherUserId,
                type: 'message',
                fromUserId: currentUser.id,
                fromUsername: currentUser.username,
                chatId: activeChatId,
                message: `–ù–æ–≤–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ –æ—Ç ${currentUser.username}`,
                read: false,
                createdAt: new Date().toISOString()
            });
        }

        function sendMessageWithMedia(url, type) {
            if (!activeChatId) {
                showNotification('–í—ã–±–µ—Ä–∏—Ç–µ —á–∞—Ç –¥–ª—è –æ—Ç–ø—Ä–∞–≤–∫–∏ —Å–æ–æ–±—â–µ–Ω–∏—è', 'error');
                return;
            }

            const message = {
                id: Date.now(),
                chatId: activeChatId,
                senderId: currentUser.id,
                type: type,
                content: url,
                read: false,
                createdAt: new Date().toISOString()
            };

            DB.chatMessages.push(message);
            saveToDB('chatMessages');

            // –û–±–Ω–æ–≤–ª—è–µ–º —Å–æ–æ–±—â–µ–Ω–∏—è
            loadChatMessages(activeChatId);

            // –û–±–Ω–æ–≤–ª—è–µ–º —Å–ø–∏—Å–æ–∫ —á–∞—Ç–æ–≤
            loadMessenger();

            // –°–æ–∑–¥–∞–µ–º —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ
            const otherUserId = activeChatUser.id;
            createNotification({
                id: Date.now(),
                userId: otherUserId,
                type: 'message',
                fromUserId: currentUser.id,
                fromUsername: currentUser.username,
                chatId: activeChatId,
                message: `${currentUser.username} –æ—Ç–ø—Ä–∞–≤–∏–ª(–∞) ${type === 'image' ? '—Ñ–æ—Ç–æ' : '–≤–∏–¥–µ–æ'}`,
                read: false,
                createdAt: new Date().toISOString()
            });
        }

        function sendMoneyInChat() {
            if (!activeChatId || !activeChatUser) {
                showNotification('–í—ã–±–µ—Ä–∏—Ç–µ —á–∞—Ç –¥–ª—è –æ—Ç–ø—Ä–∞–≤–∫–∏ –ø–µ—Ä–µ–≤–æ–¥–∞', 'error');
                return;
            }

            showModal(`
                <div class="bg-slate-800 rounded-2xl p-6 max-w-md w-full">
                    <h3 class="text-xl font-bold mb-4">üí∏ –ü–µ—Ä–µ–≤–æ–¥ –≤ —á–∞—Ç–µ</h3>
                    <div class="space-y-4">
                        <div>
                            <label class="block text-sm font-medium mb-2">–°—É–º–º–∞ (C)</label>
                            <input type="number" id="chat-transfer-amount" class="w-full bg-slate-800/50 border border-slate-700 rounded-xl px-4 py-3 focus:outline-none focus:ring-2 focus:ring-blue-500" min="1" placeholder="10" value="10">
                        </div>
                        <div>
                            <label class="block text-sm font-medium mb-2">–°–æ–æ–±—â–µ–Ω–∏–µ (–Ω–µ–æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ)</label>
                            <input type="text" id="chat-transfer-message" class="w-full bg-slate-800/50 border border-slate-700 rounded-xl px-4 py-3 focus:outline-none focus:ring-2 focus:ring-blue-500" placeholder="–ó–∞ —á—Ç–æ –ø–µ—Ä–µ–≤–æ–¥">
                        </div>
                        <div class="flex space-x-3">
                            <button id="send-chat-transfer-btn" class="flex-1 bg-green-600 hover:bg-green-700 py-3 rounded-xl font-bold">
                                –û—Ç–ø—Ä–∞–≤–∏—Ç—å
                            </button>
                            <button id="cancel-chat-transfer-btn" class="flex-1 bg-slate-700 hover:bg-slate-600 py-3 rounded-xl font-bold">
                                –û—Ç–º–µ–Ω–∞
                            </button>
                        </div>
                    </div>
                </div>
            `);

            setTimeout(() => {
                document.getElementById('send-chat-transfer-btn').addEventListener('click', function(e) {
                    e.preventDefault();
                    e.stopPropagation();
                    const amount = parseInt(document.getElementById('chat-transfer-amount').value);
                    const message = document.getElementById('chat-transfer-message').value.trim();

                    if (!amount || amount < 1) {
                        showNotification('–í–≤–µ–¥–∏—Ç–µ –∫–æ—Ä—Ä–µ–∫—Ç–Ω—É—é —Å—É–º–º—É', 'error');
                        return;
                    }

                    if (currentUser.balance < amount) {
                        showNotification('–ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ —Å—Ä–µ–¥—Å—Ç–≤', 'error');
                        return;
                    }

                    // –û–±–Ω–æ–≤–ª—è–µ–º –±–∞–ª–∞–Ω—Å—ã
                    currentUser.balance -= amount;
                    activeChatUser.balance += amount;

                    // –°–æ–∑–¥–∞–µ–º —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏—é
                    const transaction = {
                        id: Date.now(),
                        fromUserId: currentUser.id,
                        fromUsername: currentUser.username,
                        toUserId: activeChatUser.id,
                        toUsername: activeChatUser.username,
                        amount: amount,
                        message: message || null,
                        type: 'chat_transfer',
                        createdAt: new Date().toISOString()
                    };

                    DB.transactions.push(transaction);
                    saveToDB('transactions');

                    // –û—Ç–ø—Ä–∞–≤–ª—è–µ–º —Å–æ–æ–±—â–µ–Ω–∏–µ –æ –ø–µ—Ä–µ–≤–æ–¥–µ
                    const chatMessage = {
                        id: Date.now(),
                        chatId: activeChatId,
                        senderId: currentUser.id,
                        type: 'transfer',
                        content: message || '',
                        amount: amount,
                        read: false,
                        createdAt: new Date().toISOString()
                    };

                    DB.chatMessages.push(chatMessage);
                    saveToDB('chatMessages');

                    // –°–æ—Ö—Ä–∞–Ω—è–µ–º –∏–∑–º–µ–Ω–µ–Ω–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
                    saveToDB('users');
                    saveCurrentUser();

                    closeModal();

                    // –û–±–Ω–æ–≤–ª—è–µ–º –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å
                    loadChatMessages(activeChatId);
                    updateHeader();
                    loadMessenger();

                    showNotification(`–ü–µ—Ä–µ–≤–æ–¥ ${amount} C –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω!`, 'success');

                    // –°–æ–∑–¥–∞–µ–º —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ
                    createNotification({
                        id: Date.now(),
                        userId: activeChatUser.id,
                        type: 'transfer',
                        fromUserId: currentUser.id,
                        fromUsername: currentUser.username,
                        amount: amount,
                        message: `${currentUser.username} –æ—Ç–ø—Ä–∞–≤–∏–ª(–∞) –≤–∞–º –ø–µ—Ä–µ–≤–æ–¥ ${amount} C`,
                        read: false,
                        createdAt: new Date().toISOString()
                    });
                });

                document.getElementById('cancel-chat-transfer-btn').addEventListener('click', function(e) {
                    e.preventDefault();
                    e.stopPropagation();
                    closeModal();
                });
            }, 100);
        }

        function markChatAsRead(chatId) {
            DB.chatMessages.forEach(message => {
                if (message.chatId === chatId && message.senderId !== currentUser.id && !message.read) {
                    message.read = true;
                }
            });
            saveToDB('chatMessages');
            updateNotifications();
        }

        function showNewChatModal() {
            // –ü–æ–ª—É—á–∞–µ–º –¥—Ä—É–∑–µ–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
            const friends = getCurrentUserFriends();
            
            if (friends.length === 0) {
                showNotification('–£ –≤–∞—Å –ø–æ–∫–∞ –Ω–µ—Ç –¥—Ä—É–∑–µ–π', 'error');
                return;
            }

            showModal(`
                <div class="bg-slate-800 rounded-2xl p-6 max-w-md w-full">
                    <h3 class="text-xl font-bold mb-4">üí¨ –ù–æ–≤—ã–π —á–∞—Ç</h3>
                    <div class="space-y-3 max-h-80 overflow-y-auto">
                        ${friends.map(friend => `
                            <div class="p-3 rounded-xl bg-slate-800/50 hover:bg-slate-800 cursor-pointer flex items-center space-x-3" data-user-id="${friend.id}">
                                <div class="w-10 h-10 rounded-full bg-gradient-to-r from-blue-500 to-cyan-400 flex items-center justify-center">
                                    ${friend.clan}
                                </div>
                                <div>
                                    <div class="font-bold">${friend.firstName || friend.username}</div>
                                    <div class="text-sm text-gray-400">${friend.username}</div>
                                </div>
                            </div>
                        `).join('')}
                    </div>
                    <button id="close-new-chat-modal" class="w-full mt-6 bg-slate-700 hover:bg-slate-600 py-3 rounded-xl font-bold">
                        –û—Ç–º–µ–Ω–∞
                    </button>
                </div>
            `);

            setTimeout(() => {
                document.querySelectorAll('[data-user-id]').forEach(el => {
                    el.addEventListener('click', function(e) {
                        e.preventDefault();
                        e.stopPropagation();
                        const userId = parseInt(this.getAttribute('data-user-id'));
                        const user = DB.users.find(u => u.id === userId);
                        if (user) {
                            createOrOpenChat(user);
                            closeModal();
                        }
                    });
                });

                document.getElementById('close-new-chat-modal').addEventListener('click', function(e) {
                    e.preventDefault();
                    e.stopPropagation();
                    closeModal();
                });
            }, 100);
        }

        function createOrOpenChat(otherUser) {
            // –ü—Ä–æ–≤–µ—Ä—è–µ–º, –µ—Å—Ç—å –ª–∏ —É–∂–µ —á–∞—Ç —Å —ç—Ç–∏–º –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–º
            let chat = DB.chats.find(chat => 
                chat.participants.includes(currentUser.id) && 
                chat.participants.includes(otherUser.id)
            );

            if (!chat) {
                // –°–æ–∑–¥–∞–µ–º –Ω–æ–≤—ã–π —á–∞—Ç
                chat = {
                    id: Date.now(),
                    participants: [currentUser.id, otherUser.id],
                    createdAt: new Date().toISOString()
                };
                DB.chats.push(chat);
                saveToDB('chats');
            }

            // –û—Ç–∫—Ä—ã–≤–∞–µ–º —á–∞—Ç
            openChat(chat.id, otherUser);
        }

        // ===========================================
        // –î–†–£–ó–¨–Ø
        // ===========================================

        function loadFriends() {
            loadFriendsList();
            loadFriendRequests();
        }

        function loadFriendsList() {
            const container = document.getElementById('friends-list');
            if (!container) return;

            const friends = getCurrentUserFriends();

            if (friends.length === 0) {
                container.innerHTML = `
                    <div class="text-center p-4 text-gray-400">
                        <i class="fas fa-users text-2xl mb-2"></i>
                        <p>–£ –≤–∞—Å –ø–æ–∫–∞ –Ω–µ—Ç –¥—Ä—É–∑–µ–π</p>
                    </div>
                `;
                return;
            }

            container.innerHTML = friends.map(friend => `
                <div class="flex items-center justify-between p-3 bg-slate-800/50 rounded-xl">
                    <div class="flex items-center space-x-3">
                        <div class="w-10 h-10 rounded-full bg-gradient-to-r from-blue-500 to-cyan-400 flex items-center justify-center">
                            ${friend.clan}
                        </div>
                        <div>
                            <div class="font-bold">${friend.firstName || friend.username}</div>
                            <div class="text-sm text-gray-400">${friend.username}</div>
                        </div>
                    </div>
                    <div class="flex space-x-2">
                        <button class="message-friend-btn w-8 h-8 rounded-lg bg-blue-600 hover:bg-blue-700 flex items-center justify-center" data-user-id="${friend.id}" title="–ù–∞–ø–∏—Å–∞—Ç—å">
                            <i class="fas fa-comment"></i>
                        </button>
                        <button class="remove-friend-btn w-8 h-8 rounded-lg bg-red-600 hover:bg-red-700 flex items-center justify-center" data-user-id="${friend.id}" title="–£–¥–∞–ª–∏—Ç—å">
                            <i class="fas fa-user-minus"></i>
                        </button>
                    </div>
                </div>
            `).join('');

            // –î–æ–±–∞–≤–ª—è–µ–º –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∏
            setTimeout(() => {
                document.querySelectorAll('.message-friend-btn').forEach(btn => {
                    btn.addEventListener('click', function(e) {
                        e.preventDefault();
                        e.stopPropagation();
                        const userId = parseInt(this.getAttribute('data-user-id'));
                        const user = DB.users.find(u => u.id === userId);
                        if (user) {
                            createOrOpenChat(user);
                            showSection('messenger');
                        }
                    });
                });

                document.querySelectorAll('.remove-friend-btn').forEach(btn => {
                    btn.addEventListener('click', function(e) {
                        e.preventDefault();
                        e.stopPropagation();
                        const userId = parseInt(this.getAttribute('data-user-id'));
                        if (confirm('–£–¥–∞–ª–∏—Ç—å —ç—Ç–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –∏–∑ –¥—Ä—É–∑–µ–π?')) {
                            removeFriend(userId);
                        }
                    });
                });
            }, 100);
        }

        function loadFriendRequests() {
            const container = document.getElementById('friend-requests');
            if (!container) return;

            // –ü–æ–ª—É—á–∞–µ–º –∑–∞—è–≤–∫–∏ –≤ –¥—Ä—É–∑—å—è –¥–ª—è —Ç–µ–∫—É—â–µ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
            const requests = DB.friendRequests.filter(req => 
                req.toUserId === currentUser.id && req.status === 'pending'
            );

            if (requests.length === 0) {
                container.innerHTML = `
                    <div class="text-center p-4 text-gray-400">
                        <i class="fas fa-user-plus text-2xl mb-2"></i>
                        <p>–ù–µ—Ç –∑–∞—è–≤–æ–∫ –≤ –¥—Ä—É–∑—å—è</p>
                    </div>
                `;
                return;
            }

            container.innerHTML = requests.map(request => {
                const user = DB.users.find(u => u.id === request.fromUserId);
                if (!user) return '';

                return `
                    <div class="flex items-center justify-between p-3 bg-slate-800/50 rounded-xl">
                        <div class="flex items-center space-x-3">
                            <div class="w-10 h-10 rounded-full bg-gradient-to-r from-blue-500 to-cyan-400 flex items-center justify-center">
                                ${user.clan}
                            </div>
                            <div>
                                <div class="font-bold">${user.firstName || user.username}</div>
                                <div class="text-sm text-gray-400">${user.username}</div>
                            </div>
                        </div>
                        <div class="flex space-x-2">
                            <button class="accept-friend-btn w-8 h-8 rounded-lg bg-green-600 hover:bg-green-700 flex items-center justify-center" data-request-id="${request.id}" title="–ü—Ä–∏–Ω—è—Ç—å">
                                <i class="fas fa-check"></i>
                            </button>
                            <button class="reject-friend-btn w-8 h-8 rounded-lg bg-red-600 hover:bg-red-700 flex items-center justify-center" data-request-id="${request.id}" title="–û—Ç–∫–ª–æ–Ω–∏—Ç—å">
                                <i class="fas fa-times"></i>
                            </button>
                        </div>
                    </div>
                `;
            }).join('');

            // –î–æ–±–∞–≤–ª—è–µ–º –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∏
            setTimeout(() => {
                document.querySelectorAll('.accept-friend-btn').forEach(btn => {
                    btn.addEventListener('click', function(e) {
                        e.preventDefault();
                        e.stopPropagation();
                        const requestId = parseInt(this.getAttribute('data-request-id'));
                        acceptFriendRequest(requestId);
                    });
                });

                document.querySelectorAll('.reject-friend-btn').forEach(btn => {
                    btn.addEventListener('click', function(e) {
                        e.preventDefault();
                        e.stopPropagation();
                        const requestId = parseInt(this.getAttribute('data-request-id'));
                        rejectFriendRequest(requestId);
                    });
                });
            }, 100);
        }

        function searchFriend() {
            const input = document.getElementById('search-friend-input');
            const query = input.value.trim().toLowerCase();
            
            if (!query) {
                document.getElementById('search-results').classList.add('hidden');
                return;
            }

            // –ò—â–µ–º –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π (–∏—Å–∫–ª—é—á–∞—è —Å–µ–±—è –∏ —É–∂–µ –¥—Ä—É–∑–µ–π)
            const currentFriends = getCurrentUserFriends().map(f => f.id);
            const results = DB.users.filter(user => 
                user.id !== currentUser.id && 
                !currentFriends.includes(user.id) &&
                (user.username.toLowerCase().includes(query) || 
                 (user.firstName && user.firstName.toLowerCase().includes(query)) ||
                 (user.lastName && user.lastName.toLowerCase().includes(query)))
            ).slice(0, 5); // –û–≥—Ä–∞–Ω–∏—á–∏–≤–∞–µ–º 5 —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞–º–∏

            const resultsContainer = document.getElementById('search-results');
            resultsContainer.classList.remove('hidden');

            if (results.length === 0) {
                resultsContainer.innerHTML = `
                    <div class="glassmorphism rounded-2xl p-4">
                        <p class="text-gray-400 text-center">–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ –Ω–µ –Ω–∞–π–¥–µ–Ω—ã</p>
                    </div>
                `;
                return;
            }

            resultsContainer.innerHTML = `
                <div class="glassmorphism rounded-2xl p-4">
                    <h4 class="font-bold mb-3">–†–µ–∑—É–ª—å—Ç–∞—Ç—ã –ø–æ–∏—Å–∫–∞:</h4>
                    <div class="space-y-3">
                        ${results.map(user => {
                            const hasRequest = DB.friendRequests.some(req => 
                                (req.fromUserId === currentUser.id && req.toUserId === user.id && req.status === 'pending') ||
                                (req.fromUserId === user.id && req.toUserId === currentUser.id && req.status === 'pending')
                            );

                            return `
                                <div class="flex items-center justify-between p-3 bg-slate-800/50 rounded-xl">
                                    <div class="flex items-center space-x-3">
                                        <div class="w-10 h-10 rounded-full bg-gradient-to-r from-blue-500 to-cyan-400 flex items-center justify-center">
                                            ${user.clan}
                                        </div>
                                        <div>
                                            <div class="font-bold">${user.firstName || user.username}</div>
                                            <div class="text-sm text-gray-400">${user.username}</div>
                                        </div>
                                    </div>
                                    ${hasRequest ? 
                                        '<span class="text-sm text-yellow-300">–ó–∞—è–≤–∫–∞ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–∞</span>' :
                                        `<button class="add-friend-btn bg-blue-600 hover:bg-blue-700 px-4 py-2 rounded-xl text-sm" data-user-id="${user.id}">
                                            <i class="fas fa-user-plus mr-1"></i> –î–æ–±–∞–≤–∏—Ç—å
                                        </button>`
                                    }
                                </div>
                            `;
                        }).join('')}
                    </div>
                </div>
            `;

            // –î–æ–±–∞–≤–ª—è–µ–º –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∏
            setTimeout(() => {
                document.querySelectorAll('.add-friend-btn').forEach(btn => {
                    btn.addEventListener('click', function(e) {
                        e.preventDefault();
                        e.stopPropagation();
                        const userId = parseInt(this.getAttribute('data-user-id'));
                        sendFriendRequest(userId);
                    });
                });
            }, 100);
        }

        function sendFriendRequest(toUserId) {
            // –ü—Ä–æ–≤–µ—Ä—è–µ–º, –Ω–µ—Ç –ª–∏ —É–∂–µ —Ç–∞–∫–æ–π –∑–∞—è–≤–∫–∏
            const existingRequest = DB.friendRequests.find(req => 
                req.fromUserId === currentUser.id && 
                req.toUserId === toUserId && 
                req.status === 'pending'
            );

            if (existingRequest) {
                showNotification('–í—ã —É–∂–µ –æ—Ç–ø—Ä–∞–≤–∏–ª–∏ –∑–∞—è–≤–∫—É —ç—Ç–æ–º—É –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é', 'info');
                return;
            }

            const request = {
                id: Date.now(),
                fromUserId: currentUser.id,
                fromUsername: currentUser.username,
                toUserId: toUserId,
                status: 'pending',
                createdAt: new Date().toISOString()
            };

            DB.friendRequests.push(request);
            saveToDB('friendRequests');

            // –°–æ–∑–¥–∞–µ–º —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ
            createNotification({
                id: Date.now(),
                userId: toUserId,
                type: 'friend_request',
                fromUserId: currentUser.id,
                fromUsername: currentUser.username,
                message: `${currentUser.username} –æ—Ç–ø—Ä–∞–≤–∏–ª(–∞) –≤–∞–º –∑–∞—è–≤–∫—É –≤ –¥—Ä—É–∑—å—è`,
                read: false,
                createdAt: new Date().toISOString()
            });

            showNotification('–ó–∞—è–≤–∫–∞ –≤ –¥—Ä—É–∑—å—è –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–∞!', 'success');
            searchFriend(); // –û–±–Ω–æ–≤–ª—è–µ–º —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã –ø–æ–∏—Å–∫–∞
            updateNotifications();
        }

        function acceptFriendRequest(requestId) {
            const request = DB.friendRequests.find(req => req.id === requestId);
            if (!request) return;

            request.status = 'accepted';
            saveToDB('friendRequests');

            // –î–æ–±–∞–≤–ª—è–µ–º –≤ –¥—Ä—É–∑—å—è –æ–±–æ–∏–º –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º
            const fromUser = DB.users.find(u => u.id === request.fromUserId);
            const toUser = DB.users.find(u => u.id === request.toUserId);

            if (fromUser) {
                if (!fromUser.friends) fromUser.friends = [];
                if (!fromUser.friends.includes(toUser.id)) {
                    fromUser.friends.push(toUser.id);
                }
            }

            if (toUser) {
                if (!toUser.friends) toUser.friends = [];
                if (!toUser.friends.includes(fromUser.id)) {
                    toUser.friends.push(fromUser.id);
                }
            }

            saveToDB('users');
            saveCurrentUser();

            // –°–æ–∑–¥–∞–µ–º —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ
            createNotification({
                id: Date.now(),
                userId: request.fromUserId,
                type: 'friend_accept',
                fromUserId: currentUser.id,
                fromUsername: currentUser.username,
                message: `${currentUser.username} –ø—Ä–∏–Ω—è–ª(–∞) –≤–∞—à—É –∑–∞—è–≤–∫—É –≤ –¥—Ä—É–∑—å—è`,
                read: false,
                createdAt: new Date().toISOString()
            });

            showNotification('–ó–∞—è–≤–∫–∞ –ø—Ä–∏–Ω—è—Ç–∞! –¢–µ–ø–µ—Ä—å –≤—ã –¥—Ä—É–∑—å—è.', 'success');
            loadFriends();
            updateNotifications();
        }

        function rejectFriendRequest(requestId) {
            const request = DB.friendRequests.find(req => req.id === requestId);
            if (!request) return;

            request.status = 'rejected';
            saveToDB('friendRequests');

            showNotification('–ó–∞—è–≤–∫–∞ –æ—Ç–∫–ª–æ–Ω–µ–Ω–∞', 'info');
            loadFriends();
        }

        function removeFriend(userId) {
            // –£–¥–∞–ª—è–µ–º –∏–∑ –¥—Ä—É–∑–µ–π —É –æ–±–æ–∏—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
            const friend = DB.users.find(u => u.id === userId);
            
            if (currentUser.friends) {
                const index = currentUser.friends.indexOf(userId);
                if (index !== -1) {
                    currentUser.friends.splice(index, 1);
                }
            }

            if (friend && friend.friends) {
                const index = friend.friends.indexOf(currentUser.id);
                if (index !== -1) {
                    friend.friends.splice(index, 1);
                }
            }

            saveToDB('users');
            saveCurrentUser();

            showNotification('–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —É–¥–∞–ª–µ–Ω –∏–∑ –¥—Ä—É–∑–µ–π', 'success');
            loadFriends();
        }

        function getCurrentUserFriends() {
            if (!currentUser.friends || currentUser.friends.length === 0) return [];
            return DB.users.filter(user => currentUser.friends.includes(user.id));
        }

        // ===========================================
        // –£–í–ï–î–û–ú–õ–ï–ù–ò–Ø
        // ===========================================

        function createNotification(notification) {
            DB.notifications.push(notification);
            saveToDB('notifications');
            updateNotifications();
        }

        function updateNotifications() {
            if (!currentUser) return;

            // –ù–µ–ø—Ä–æ—á–∏—Ç–∞–Ω–Ω—ã–µ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è
            const unreadNotifications = DB.notifications.filter(n => 
                n.userId === currentUser.id && !n.read
            );

            // –û–±–Ω–æ–≤–ª—è–µ–º —Ç–æ—á–∫–∏ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π
            const notificationsDot = document.getElementById('notifications-dot');
            if (unreadNotifications.length > 0) {
                notificationsDot.classList.remove('hidden');
            } else {
                notificationsDot.classList.add('hidden');
            }

            // –°—á–µ—Ç—á–∏–∫ –Ω–µ–ø—Ä–æ—á–∏—Ç–∞–Ω–Ω—ã—Ö —Å–æ–æ–±—â–µ–Ω–∏–π
            const unreadMessages = DB.chatMessages.filter(m => {
                const chat = DB.chats.find(c => c.id === m.chatId);
                return chat && 
                       chat.participants.includes(currentUser.id) && 
                       m.senderId !== currentUser.id && 
                       !m.read;
            }).length;

            const unreadChatsBadge = document.getElementById('unread-chats-count');
            if (unreadMessages > 0) {
                unreadChatsBadge.textContent = unreadMessages;
                unreadChatsBadge.classList.remove('hidden');
            } else {
                unreadChatsBadge.classList.add('hidden');
            }

            // –°—á–µ—Ç—á–∏–∫ –∑–∞—è–≤–æ–∫ –≤ –¥—Ä—É–∑—å—è
            const friendRequests = DB.friendRequests.filter(req => 
                req.toUserId === currentUser.id && req.status === 'pending'
            ).length;

            const friendRequestsBadge = document.getElementById('friend-requests-count');
            if (friendRequests > 0) {
                friendRequestsBadge.textContent = friendRequests;
                friendRequestsBadge.classList.remove('hidden');
            } else {
                friendRequestsBadge.classList.add('hidden');
            }

            // –£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –¥–ª—è –ª–µ–Ω—Ç—ã (–ª–∞–π–∫–∏ –∏ –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏)
            const feedNotifications = unreadNotifications.filter(n => 
                n.type === 'like' || n.type === 'comment'
            ).length;

            const feedNotificationsBadge = document.getElementById('feed-notifications');
            if (feedNotifications > 0) {
                feedNotificationsBadge.textContent = feedNotifications;
                feedNotificationsBadge.classList.remove('hidden');
            } else {
                feedNotificationsBadge.classList.add('hidden');
            }

            // –û–±–Ω–æ–≤–ª—è–µ–º —Å—á–µ—Ç—á–∏–∫ –Ω–µ–ø—Ä–æ—á–∏—Ç–∞–Ω–Ω—ã—Ö —á–∞—Ç–æ–≤
            updateUnreadChatsCount();
        }

        function createPostNotifications(post) {
            // –ü–æ–ª—É—á–∞–µ–º –¥—Ä—É–∑–µ–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
            const friends = getCurrentUserFriends();
            
            friends.forEach(friend => {
                createNotification({
                    id: Date.now(),
                    userId: friend.id,
                    type: 'new_post',
                    fromUserId: currentUser.id,
                    fromUsername: currentUser.username,
                    postId: post.id,
                    message: `${currentUser.username} –æ–ø—É–±–ª–∏–∫–æ–≤–∞–ª(–∞) –Ω–æ–≤—ã–π –ø–æ—Å—Ç`,
                    read: false,
                    createdAt: new Date().toISOString()
                });
            });
        }

        function updateUnreadChatsCount() {
            if (!currentUser) return;

            const userChats = DB.chats.filter(chat => 
                chat.participants.includes(currentUser.id)
            );

            let totalUnread = 0;
            
            userChats.forEach(chat => {
                const unreadCount = DB.chatMessages.filter(m => 
                    m.chatId === chat.id && 
                    m.senderId !== currentUser.id && 
                    !m.read
                ).length;
                totalUnread += unreadCount;
            });

            const badge = document.getElementById('unread-chats-count');
            if (totalUnread > 0) {
                badge.textContent = totalUnread;
                badge.classList.remove('hidden');
            } else {
                badge.classList.add('hidden');
            }
        }

        // ===========================================
        // –ü–†–û–§–ò–õ–¨, –ú–ê–ì–ê–ó–ò–ù, –ü–ï–†–ï–í–û–î–´, –ê–î–ú–ò–ù-–ü–ê–ù–ï–õ–¨
        // ===========================================

        // –ó–∞–≥—Ä—É–∑–∫–∞ –ø—Ä–æ—Ñ–∏–ª—è
        function loadProfile() {
            if (!currentUser) return;

            // –û—Å–Ω–æ–≤–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è
            document.getElementById('profile-name').textContent = 
                currentUser.firstName ? `${currentUser.firstName} ${currentUser.lastName || ''}`.trim() : currentUser.username;
            document.getElementById('profile-username').textContent = currentUser.username;
            document.getElementById('profile-clan').innerHTML = `
                <i class="fas fa-users mr-1"></i> –ö–ª–∞–Ω ${currentUser.clan}
            `;
            document.getElementById('profile-balance').textContent = `${currentUser.balance} C`;
            document.getElementById('profile-avatar').innerHTML = currentUser.clan;
            
            // –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞
            const friendsCount = currentUser.friends ? currentUser.friends.length : 0;
            const postsCount = currentUser.posts ? currentUser.posts.length : 0;
            const giftsCount = currentUser.inventory ? currentUser.inventory.length : 0;
            
            document.getElementById('friends-count').textContent = friendsCount;
            document.getElementById('posts-count').textContent = postsCount;
            document.getElementById('gifts-count').textContent = giftsCount;
            
            // –î–∞—Ç–∞ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏
            const joinDate = new Date(currentUser.createdAt);
            document.getElementById('member-since').textContent = joinDate.toLocaleDateString('ru-RU');
            
            // –ò–Ω–≤–µ–Ω—Ç–∞—Ä—å
            loadInventory();
            
            // –í–∏—Ç—Ä–∏–Ω–∞ –ø–æ–¥–∞—Ä–∫–æ–≤
            loadShowcase();
            
            // –ü–æ—Å—Ç—ã –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
            loadUserPosts();
        }

        // –ó–∞–≥—Ä—É–∑–∫–∞ –∏–Ω–≤–µ–Ω—Ç–∞—Ä—è
        function loadInventory() {
            const inventoryItems = document.getElementById('inventory-items');
            if (!inventoryItems) return;
            
            if (!currentUser.inventory || currentUser.inventory.length === 0) {
                inventoryItems.innerHTML = `
                    <div class="text-center p-4 text-gray-400">
                        <i class="fas fa-box-open text-2xl mb-2"></i>
                        <p>–ò–Ω–≤–µ–Ω—Ç–∞—Ä—å –ø—É—Å—Ç</p>
                    </div>
                `;
                return;
            }
            
            inventoryItems.innerHTML = currentUser.inventory.map(giftId => {
                const gift = DB.gifts.find(g => g.id === giftId);
                if (!gift) return '';
                
                const inShowcase = currentUser.showcase?.includes(giftId);
                
                return `
                    <div class="flex items-center justify-between p-3 bg-slate-800/50 rounded-xl hover:bg-slate-800 transition cursor-pointer gift-item" data-gift-id="${giftId}">
                        <div class="flex items-center space-x-3">
                            <div class="text-2xl">${gift.emoji}</div>
                            <div>
                                <div class="font-bold">${gift.name}</div>
                                <div class="text-xs text-gray-400">${inShowcase ? '‚≠ê –í –≤–∏—Ç—Ä–∏–Ω–µ' : '–í –∏–Ω–≤–µ–Ω—Ç–∞—Ä–µ'}</div>
                            </div>
                        </div>
                        <div class="text-right">
                            <div class="text-sm text-yellow-300">${gift.price} C</div>
                            <div class="text-xs text-gray-400">–ü—Ä–æ–¥–∞–∂–∞: ${Math.floor(gift.price * 0.7)} C</div>
                        </div>
                    </div>
                `;
            }).join('');
            
            // –î–æ–±–∞–≤–ª—è–µ–º –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –¥–ª—è –ø–æ–¥–∞—Ä–∫–æ–≤ –≤ –∏–Ω–≤–µ–Ω—Ç–∞—Ä–µ
            setTimeout(() => {
                document.querySelectorAll('.gift-item').forEach(item => {
                    item.addEventListener('click', function(e) {
                        e.preventDefault();
                        e.stopPropagation();
                        const giftId = parseInt(this.getAttribute('data-gift-id'));
                        showGiftMenu(giftId, 'inventory');
                    });
                });
            }, 100);
        }

        // –ó–∞–≥—Ä—É–∑–∫–∞ –≤–∏—Ç—Ä–∏–Ω—ã –ø–æ–¥–∞—Ä–∫–æ–≤
        function loadShowcase() {
            const showcaseDiv = document.getElementById('profile-showcase');
            const noShowcase = document.getElementById('no-showcase');
            
            if (!showcaseDiv || !noShowcase) return;
            
            if (!currentUser.showcase || currentUser.showcase.length === 0) {
                showcaseDiv.innerHTML = '';
                noShowcase.classList.remove('hidden');
                return;
            }
            
            noShowcase.classList.add('hidden');
            showcaseDiv.innerHTML = currentUser.showcase.map(giftId => {
                const gift = DB.gifts.find(g => g.id === giftId);
                if (!gift) return '';
                
                return `
                    <div class="text-center p-3 bg-slate-800/50 rounded-xl hover:bg-slate-800 transition cursor-pointer gift-in-showcase gift-item" data-gift-id="${giftId}">
                        <div class="text-3xl mb-2">${gift.emoji}</div>
                        <div class="font-bold text-sm truncate">${gift.name}</div>
                        <div class="text-xs text-blue-300">–í –≤–∏—Ç—Ä–∏–Ω–µ</div>
                        <div class="text-xs text-yellow-300 mt-1">${gift.price} C</div>
                    </div>
                `;
            }).join('');
            
            // –î–æ–±–∞–≤–ª—è–µ–º –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –¥–ª—è –ø–æ–¥–∞—Ä–∫–æ–≤ –≤ –≤–∏—Ç—Ä–∏–Ω–µ
            setTimeout(() => {
                document.querySelectorAll('.gift-item').forEach(item => {
                    item.addEventListener('click', function(e) {
                        e.preventDefault();
                        e.stopPropagation();
                        const giftId = parseInt(this.getAttribute('data-gift-id'));
                        const location = this.classList.contains('gift-in-showcase') ? 'showcase' : 'inventory';
                        showGiftMenu(giftId, location);
                    });
                });
            }, 100);
        }

        // –ú–µ–Ω—é –¥–ª—è –ø–æ–¥–∞—Ä–∫–∞ (–ò–°–ü–†–ê–í–õ–ï–ù–ù–ê–Ø –í–ï–†–°–ò–Ø)
        function showGiftMenu(giftId, location) {
            const gift = DB.gifts.find(g => g.id === giftId);
            if (!gift) return;

            const inShowcase = currentUser.showcase?.includes(giftId);
            const salePrice = Math.floor(gift.price * 0.7);
            
            showModal(`
                <div class="bg-slate-800 rounded-2xl p-6 max-w-md w-full">
                    <div class="text-center mb-6">
                        <div class="text-5xl mb-2">${gift.emoji}</div>
                        <h3 class="text-xl font-bold">${gift.name}</h3>
                        <p class="text-gray-400">${gift.description}</p>
                        <div class="mt-2">
                            <div class="text-yellow-300 font-bold">–¶–µ–Ω–∞: ${gift.price} C</div>
                            <div class="text-green-300 text-sm">–ü—Ä–æ–¥–∞–∂–∞: ${salePrice} C (70%)</div>
                        </div>
                    </div>
                    
                    <div class="space-y-3">
                        ${location === 'inventory' && !inShowcase ? `
                        <button id="add-to-showcase-btn" class="w-full text-left p-3 rounded-lg bg-blue-900/30 hover:bg-blue-800/50 transition flex items-center space-x-3">
                            <i class="fas fa-star text-blue-400"></i>
                            <span>–í—ã—Å—Ç–∞–≤–∏—Ç—å –≤ –ø—Ä–æ—Ñ–∏–ª—å</span>
                        </button>` : ''}
                        
                        ${inShowcase ? `
                        <button id="remove-from-showcase-btn" class="w-full text-left p-3 rounded-lg bg-slate-700 hover:bg-slate-600 transition flex items-center space-x-3">
                            <i class="fas fa-eye-slash"></i>
                            <span>–£–±—Ä–∞—Ç—å –∏–∑ –ø—Ä–æ—Ñ–∏–ª—è</span>
                        </button>` : ''}
                        
                        <button id="sell-gift-btn" class="w-full text-left p-3 rounded-lg bg-yellow-900/30 hover:bg-yellow-800/50 transition flex items-center space-x-3">
                            <i class="fas fa-money-bill text-yellow-400"></i>
                            <span>–ü—Ä–æ–¥–∞—Ç—å –∑–∞ ${salePrice} C</span>
                        </button>
                        
                        <button id="give-gift-btn" class="w-full text-left p-3 rounded-lg bg-green-900/30 hover:bg-green-800/50 transition flex items-center space-x-3">
                            <i class="fas fa-gift text-green-400"></i>
                            <span>–ü–æ–¥–∞—Ä–∏—Ç—å –¥—Ä—É–≥—É</span>
                        </button>
                    </div>
                    
                    <button id="close-gift-modal-btn" class="w-full mt-6 p-3 rounded-lg bg-slate-700 hover:bg-slate-600 transition">
                        –û—Ç–º–µ–Ω–∞
                    </button>
                </div>
            `);

            // –î–æ–±–∞–≤–ª—è–µ–º –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –¥–ª—è –º–æ–¥–∞–ª—å–Ω–æ–≥–æ –æ–∫–Ω–∞
            setTimeout(() => {
                if (location === 'inventory' && !inShowcase) {
                    document.getElementById('add-to-showcase-btn').addEventListener('click', function(e) {
                        e.preventDefault();
                        e.stopPropagation();
                        closeModal();
                        addToShowcase(giftId);
                    });
                }
                
                if (inShowcase) {
                    document.getElementById('remove-from-showcase-btn').addEventListener('click', function(e) {
                        e.preventDefault();
                        e.stopPropagation();
                        closeModal();
                        removeFromShowcase(giftId);
                    });
                }
                
                document.getElementById('sell-gift-btn').addEventListener('click', function(e) {
                    e.preventDefault();
                    e.stopPropagation();
                    closeModal();
                    sellGift(giftId);
                });
                
                document.getElementById('give-gift-btn').addEventListener('click', function(e) {
                    e.preventDefault();
                    e.stopPropagation();
                    closeModal();
                    showGiftToFriendModal(giftId);
                });
                
                document.getElementById('close-gift-modal-btn').addEventListener('click', function(e) {
                    e.preventDefault();
                    e.stopPropagation();
                    closeModal();
                });
            }, 100);
        }

        // –î–æ–±–∞–≤–∏—Ç—å –ø–æ–¥–∞—Ä–æ–∫ –≤ –≤–∏—Ç—Ä–∏–Ω—É
        function addToShowcase(giftId) {
            if (!currentUser.showcase) currentUser.showcase = [];
            
            if (!currentUser.showcase.includes(giftId)) {
                currentUser.showcase.push(giftId);
                saveToDB('users');
                saveCurrentUser();
                loadProfile();
                showNotification('–ü–æ–¥–∞—Ä–æ–∫ –¥–æ–±–∞–≤–ª–µ–Ω –≤ –≤–∏—Ç—Ä–∏–Ω—É!', 'success');
            }
        }

        // –£–±—Ä–∞—Ç—å –ø–æ–¥–∞—Ä–æ–∫ –∏–∑ –≤–∏—Ç—Ä–∏–Ω—ã
        function removeFromShowcase(giftId) {
            if (!currentUser.showcase) return;
            
            const index = currentUser.showcase.indexOf(giftId);
            if (index !== -1) {
                currentUser.showcase.splice(index, 1);
                saveToDB('users');
                saveCurrentUser();
                loadProfile();
                showNotification('–ü–æ–¥–∞—Ä–æ–∫ —É–±—Ä–∞–Ω –∏–∑ –≤–∏—Ç—Ä–∏–Ω—ã', 'info');
            }
        }

        // –ü—Ä–æ–¥–∞—Ç—å –ø–æ–¥–∞—Ä–æ–∫
        function sellGift(giftId) {
            const gift = DB.gifts.find(g => g.id === giftId);
            if (!gift) return;

            const salePrice = Math.floor(gift.price * 0.7);
            
            if (!confirm(`–ü—Ä–æ–¥–∞—Ç—å "${gift.name}" –∑–∞ ${salePrice} C?`)) {
                return;
            }
            
            // –£–¥–∞–ª—è–µ–º –∏–∑ –∏–Ω–≤–µ–Ω—Ç–∞—Ä—è
            if (currentUser.inventory) {
                const invIndex = currentUser.inventory.indexOf(giftId);
                if (invIndex !== -1) {
                    currentUser.inventory.splice(invIndex, 1);
                }
            }
            
            // –£–¥–∞–ª—è–µ–º –∏–∑ –≤–∏—Ç—Ä–∏–Ω—ã
            if (currentUser.showcase) {
                const showIndex = currentUser.showcase.indexOf(giftId);
                if (showIndex !== -1) {
                    currentUser.showcase.splice(showIndex, 1);
                }
            }
            
            // –î–æ–±–∞–≤–ª—è–µ–º –¥–µ–Ω—å–≥–∏
            currentUser.balance += salePrice;
            
            // –°–æ–∑–¥–∞–µ–º —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏—é
            const transaction = {
                id: Date.now(),
                fromUserId: currentUser.id,
                toUserId: null,
                amount: salePrice,
                type: 'gift_sale',
                giftId: giftId,
                originalPrice: gift.price,
                salePrice: salePrice,
                createdAt: new Date().toISOString()
            };
            
            DB.transactions.push(transaction);
            
            // –°–æ—Ö—Ä–∞–Ω—è–µ–º –≤—Å–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è
            saveToDB('users');
            saveToDB('transactions');
            saveCurrentUser();
            
            loadProfile();
            updateHeader();
            showNotification(`–ü–æ–¥–∞—Ä–æ–∫ –ø—Ä–æ–¥–∞–Ω –∑–∞ ${salePrice} C!`, 'success');
        }

        // –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –¥–∞—Ä–µ–Ω–∏—è –ø–æ–¥–∞—Ä–∫–∞
        function showGiftToFriendModal(giftId) {
            const gift = DB.gifts.find(g => g.id === giftId);
            if (!gift) return;

            const friends = getCurrentUserFriends();
            
            if (friends.length === 0) {
                showNotification('–£ –≤–∞—Å –ø–æ–∫–∞ –Ω–µ—Ç –¥—Ä—É–∑–µ–π', 'error');
                return;
            }

            showModal(`
                <div class="bg-slate-800 rounded-2xl p-6 max-w-md w-full">
                    <div class="text-center mb-6">
                        <div class="text-4xl mb-2">${gift.emoji}</div>
                        <h3 class="text-xl font-bold">–ü–æ–¥–∞—Ä–∏—Ç—å "${gift.name}"</h3>
                        <p class="text-gray-400 mt-2">–í—ã–±–µ—Ä–∏—Ç–µ –¥—Ä—É–≥–∞ –¥–ª—è –ø–æ–¥–∞—Ä–∫–∞</p>
                    </div>
                    
                    <div class="space-y-3 max-h-60 overflow-y-auto mb-4">
                        ${friends.map(friend => `
                            <div class="p-3 rounded-xl bg-slate-800/50 hover:bg-slate-800 cursor-pointer flex items-center space-x-3" data-user-id="${friend.id}">
                                <div class="w-10 h-10 rounded-full bg-gradient-to-r from-blue-500 to-cyan-400 flex items-center justify-center">
                                    ${friend.clan}
                                </div>
                                <div>
                                    <div class="font-bold">${friend.firstName || friend.username}</div>
                                    <div class="text-sm text-gray-400">${friend.username}</div>
                                </div>
                            </div>
                        `).join('')}
                    </div>
                    
                    <div class="flex space-x-3">
                        <button id="cancel-gift-btn" class="flex-1 bg-slate-700 hover:bg-slate-600 py-3 rounded-xl font-bold">
                            –û—Ç–º–µ–Ω–∞
                        </button>
                    </div>
                </div>
            `);

            setTimeout(() => {
                document.querySelectorAll('[data-user-id]').forEach(el => {
                    el.addEventListener('click', function(e) {
                        e.preventDefault();
                        e.stopPropagation();
                        const friendId = parseInt(this.getAttribute('data-user-id'));
                        giveGiftToFriend(giftId, friendId);
                        closeModal();
                    });
                });

                document.getElementById('cancel-gift-btn').addEventListener('click', function(e) {
                    e.preventDefault();
                    e.stopPropagation();
                    closeModal();
                });
            }, 100);
        }

        function giveGiftToFriend(giftId, friendId) {
            const gift = DB.gifts.find(g => g.id === giftId);
            const friend = DB.users.find(u => u.id === friendId);
            
            if (!gift || !friend) return;

            // –£–¥–∞–ª—è–µ–º –ø–æ–¥–∞—Ä–æ–∫ —É —Ç–µ–∫—É—â–µ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
            if (currentUser.inventory) {
                const invIndex = currentUser.inventory.indexOf(giftId);
                if (invIndex !== -1) {
                    currentUser.inventory.splice(invIndex, 1);
                }
            }
            
            // –£–¥–∞–ª—è–µ–º –∏–∑ –≤–∏—Ç—Ä–∏–Ω—ã –µ—Å–ª–∏ –µ—Å—Ç—å
            if (currentUser.showcase) {
                const showIndex = currentUser.showcase.indexOf(giftId);
                if (showIndex !== -1) {
                    currentUser.showcase.splice(showIndex, 1);
                }
            }
            
            // –î–æ–±–∞–≤–ª—è–µ–º –ø–æ–¥–∞—Ä–æ–∫ –¥—Ä—É–≥—É
            if (!friend.inventory) friend.inventory = [];
            friend.inventory.push(giftId);
            
            // –°–æ—Ö—Ä–∞–Ω—è–µ–º –∏–∑–º–µ–Ω–µ–Ω–∏—è
            saveToDB('users');
            saveCurrentUser();
            
            // –°–æ–∑–¥–∞–µ–º —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ
            createNotification({
                id: Date.now(),
                userId: friendId,
                type: 'gift',
                fromUserId: currentUser.id,
                fromUsername: currentUser.username,
                giftId: giftId,
                message: `${currentUser.username} –ø–æ–¥–∞—Ä–∏–ª(–∞) –≤–∞–º "${gift.name}"`,
                read: false,
                createdAt: new Date().toISOString()
            });
            
            showNotification(`–ü–æ–¥–∞—Ä–æ–∫ "${gift.name}" –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω –¥—Ä—É–≥—É!`, 'success');
            loadProfile();
            updateNotifications();
        }

        // –ó–∞–≥—Ä—É–∑–∫–∞ –ø–æ—Å—Ç–æ–≤ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
        function loadUserPosts() {
            const profilePosts = document.getElementById('profile-posts');
            if (!profilePosts) return;
            
            const userPosts = DB.posts.filter(post => 
                post.userId === currentUser.id
            ).sort((a, b) => new Date(b.createdAt) - new Date(a.createdAt));
            
            if (userPosts.length === 0) {
                profilePosts.innerHTML = `
                    <div class="text-center p-8 text-gray-400">
                        <i class="fas fa-newspaper text-3xl mb-2"></i>
                        <p>–£ –≤–∞—Å –ø–æ–∫–∞ –Ω–µ—Ç –ø–æ—Å—Ç–æ–≤</p>
                    </div>
                `;
                return;
            }
            
            profilePosts.innerHTML = userPosts.map(post => `
                <div class="bg-slate-800/50 rounded-xl p-4 mb-4">
                    <div class="flex justify-between items-start mb-2">
                        <div class="text-gray-400 text-sm">${formatDate(post.createdAt)}</div>
                        <button class="delete-post-btn text-red-400 hover:text-red-300" data-post-id="${post.id}">
                            <i class="fas fa-trash"></i>
                        </button>
                    </div>
                    <p class="mb-3">${post.content}</p>
                    ${post.media && post.media.length > 0 ? `
                    <div class="grid grid-cols-2 gap-2 mb-3">
                        ${post.media.slice(0, 2).map(url => {
                            if (url.includes('data:video')) {
                                return `<video src="${url}" controls class="rounded-lg w-full h-32 object-cover"></video>`;
                            } else {
                                return `<img src="${url}" class="rounded-lg w-full h-32 object-cover cursor-pointer" onclick="showFullMedia('${url}')">`;
                            }
                        }).join('')}
                    </div>
                    ` : ''}
                    <div class="flex items-center justify-between mt-3 pt-3 border-t border-slate-700">
                        <div class="flex items-center space-x-4">
                            <div class="flex items-center space-x-1">
                                <i class="fas fa-heart text-red-400"></i>
                                <span>${post.likes.length}</span>
                            </div>
                            <div class="flex items-center space-x-1">
                                <i class="fas fa-comment text-blue-400"></i>
                                <span>${post.comments.length}</span>
                            </div>
                        </div>
                    </div>
                </div>
            `).join('');
            
            // –î–æ–±–∞–≤–ª—è–µ–º –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –¥–ª—è —É–¥–∞–ª–µ–Ω–∏—è –ø–æ—Å—Ç–æ–≤
            setTimeout(() => {
                document.querySelectorAll('.delete-post-btn').forEach(btn => {
                    btn.addEventListener('click', function(e) {
                        e.preventDefault();
                        e.stopPropagation();
                        const postId = parseInt(this.getAttribute('data-post-id'));
                        if (confirm('–£–¥–∞–ª–∏—Ç—å —ç—Ç–æ—Ç –ø–æ—Å—Ç?')) {
                            deletePost(postId);
                        }
                    });
                });
            }, 100);
        }

        // –ó–∞–≥—Ä—É–∑–∫–∞ –º–∞–≥–∞–∑–∏–Ω–∞ (–ò–°–ü–†–ê–í–õ–ï–ù–ù–ê–Ø - –±–∞–ª–∞–Ω—Å –æ–±–Ω–æ–≤–ª—è–µ—Ç—Å—è —Å—Ä–∞–∑—É)
        function loadShop() {
            const shopBalance = document.getElementById('shop-balance');
            const giftsShop = document.getElementById('gifts-shop');
            
            // –û–±–Ω–æ–≤–ª—è–µ–º –±–∞–ª–∞–Ω—Å —Å—Ä–∞–∑—É
            shopBalance.textContent = `${currentUser.balance} C`;
            
            // –¢–æ–≤–∞—Ä—ã –º–∞–≥–∞–∑–∏–Ω–∞
            giftsShop.innerHTML = DB.gifts.map(gift => `
                <div class="bg-slate-800/50 rounded-2xl p-6 text-center card-hover">
                    <div class="text-5xl mb-4">${gift.emoji}</div>
                    <h4 class="font-bold text-xl mb-2">${gift.name}</h4>
                    <p class="text-gray-400 text-sm mb-4">${gift.description}</p>
                    <div class="text-2xl font-bold text-yellow-300 mb-2">${gift.price} C</div>
                    <div class="text-sm text-green-300 mb-4">–ü—Ä–æ–¥–∞–∂–∞: ${Math.floor(gift.price * 0.7)} C</div>
                    <button class="buy-gift-btn w-full btn-primary py-3 rounded-xl font-bold" data-gift-id="${gift.id}">
                        –ö—É–ø–∏—Ç—å –ø–æ–¥–∞—Ä–æ–∫
                    </button>
                </div>
            `).join('');
            
            // –î–æ–±–∞–≤–ª—è–µ–º –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –¥–ª—è –∫–Ω–æ–ø–æ–∫ –ø–æ–∫—É–ø–∫–∏
            setTimeout(() => {
                document.querySelectorAll('.buy-gift-btn').forEach(btn => {
                    btn.addEventListener('click', function(e) {
                        e.preventDefault();
                        e.stopPropagation();
                        const giftId = parseInt(this.getAttribute('data-gift-id'));
                        buyGift(giftId);
                    });
                });
            }, 100);
        }

        // –ü–æ–∫—É–ø–∫–∞ –ø–æ–¥–∞—Ä–∫–∞ (–ò–°–ü–†–ê–í–õ–ï–ù–ù–ê–Ø - –±–∞–ª–∞–Ω—Å –æ–±–Ω–æ–≤–ª—è–µ—Ç—Å—è —Å—Ä–∞–∑—É)
        function buyGift(giftId) {
            const gift = DB.gifts.find(g => g.id === giftId);
            if (!gift) return;

            if (currentUser.balance < gift.price) {
                showNotification('–ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ —Å—Ä–µ–¥—Å—Ç–≤', 'error');
                return;
            }

            // –°–ø–∏—Å—ã–≤–∞–µ–º –¥–µ–Ω—å–≥–∏
            currentUser.balance -= gift.price;
            
            // –î–æ–±–∞–≤–ª—è–µ–º –≤ –∏–Ω–≤–µ–Ω—Ç–∞—Ä—å
            if (!currentUser.inventory) currentUser.inventory = [];
            currentUser.inventory.push(giftId);
            
            // –û–±–Ω–æ–≤–ª—è–µ–º —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É –ø–æ–¥–∞—Ä–∫–∞
            gift.purchases = (gift.purchases || 0) + 1;
            gift.popular = (gift.popular || 0) + 10;
            
            // –°–æ—Ö—Ä–∞–Ω—è–µ–º —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏—é
            const transaction = {
                id: Date.now(),
                fromUserId: currentUser.id,
                toUserId: null,
                amount: gift.price,
                type: 'gift_purchase',
                giftId: giftId,
                createdAt: new Date().toISOString()
            };
            
            DB.transactions.push(transaction);
            
            // –°–æ—Ö—Ä–∞–Ω—è–µ–º –≤—Å–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è
            saveToDB('gifts');
            saveToDB('users');
            saveToDB('transactions');
            saveCurrentUser();
            
            showNotification(`–ü–æ–¥–∞—Ä–æ–∫ "${gift.name}" –∫—É–ø–ª–µ–Ω!`, 'success');
            
            // –°–†–ê–ó–£ –æ–±–Ω–æ–≤–ª—è–µ–º –±–∞–ª–∞–Ω—Å –≤–æ –≤—Å–µ—Ö –º–µ—Å—Ç–∞—Ö
            updateHeader();
            loadShop();
            if (state.currentSection === 'profile') {
                loadProfile();
            }
        }

        // –ó–∞–≥—Ä—É–∑–∫–∞ –ø–µ—Ä–µ–≤–æ–¥–æ–≤
        function loadTransfers() {
            const historyDiv = document.getElementById('transfers-history');
            
            // –§–∏–ª—å—Ç—Ä—É–µ–º —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
            const userTransactions = DB.transactions.filter(t => 
                t.fromUserId === currentUser.id || t.toUserId === currentUser.id
            ).sort((a, b) => new Date(b.createdAt) - new Date(a.createdAt));
            
            if (userTransactions.length === 0) {
                historyDiv.innerHTML = `
                    <div class="text-center p-6 text-gray-400">
                        <i class="fas fa-exchange-alt text-3xl mb-2"></i>
                        <p>–£ –≤–∞—Å –ø–æ–∫–∞ –Ω–µ—Ç –ø–µ—Ä–µ–≤–æ–¥–æ–≤</p>
                    </div>
                `;
            } else {
                historyDiv.innerHTML = userTransactions.map(transaction => {
                    const isOutgoing = transaction.fromUserId === currentUser.id;
                    const otherUser = DB.users.find(u => 
                        u.id === (isOutgoing ? transaction.toUserId : transaction.fromUserId)
                    );
                    
                    return `
                        <div class="flex items-center justify-between p-4 bg-slate-800/30 rounded-xl">
                            <div class="flex items-center space-x-3">
                                <div class="w-10 h-10 rounded-full flex items-center justify-center ${isOutgoing ? 'bg-red-600/20 text-red-400' : 'bg-green-600/20 text-green-400'}">
                                    <i class="fas fa-${isOutgoing ? 'arrow-up' : 'arrow-down'}"></i>
                                </div>
                                <div>
                                    <div class="font-bold">${isOutgoing ? '–ò—Å—Ö–æ–¥—è—â–∏–π' : '–í—Ö–æ–¥—è—â–∏–π'} –ø–µ—Ä–µ–≤–æ–¥</div>
                                    <div class="text-sm text-gray-400">
                                        ${isOutgoing ? `–î–ª—è: ${otherUser?.username || '–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å'}` : `–û—Ç: ${otherUser?.username || '–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å'}`}
                                        ${transaction.message ? `‚Ä¢ ${transaction.message}` : ''}
                                    </div>
                                </div>
                            </div>
                            <div class="text-right">
                                <div class="font-bold ${isOutgoing ? 'text-red-300' : 'text-green-300'}">
                                    ${isOutgoing ? '-' : '+'}${transaction.amount} C
                                </div>
                                <div class="text-xs text-gray-400">${formatDate(transaction.createdAt)}</div>
                            </div>
                        </div>
                    `;
                }).join('');
            }
            
            // –î–æ–±–∞–≤–ª—è–µ–º –æ–±—Ä–∞–±–æ—Ç—á–∏–∫ –¥–ª—è –∫–Ω–æ–ø–∫–∏ –ø–µ—Ä–µ–≤–æ–¥–∞
            setTimeout(() => {
                const btn = document.getElementById('make-transfer-btn');
                if (btn) {
                    btn.addEventListener('click', function(e) {
                        e.preventDefault();
                        e.stopPropagation();
                        makeTransfer();
                    });
                }
            }, 100);
        }

        // –°–¥–µ–ª–∞—Ç—å –ø–µ—Ä–µ–≤–æ–¥
        function makeTransfer() {
            const toUsername = document.getElementById('transfer-to').value.trim();
            const amount = parseInt(document.getElementById('transfer-amount').value);
            const message = document.getElementById('transfer-message').value.trim();

            if (!toUsername || !toUsername.startsWith('@')) {
                showNotification('–í–≤–µ–¥–∏—Ç–µ –∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–π –Ω–∏–∫–Ω–µ–π–º', 'error');
                return;
            }

            if (!amount || amount < 1) {
                showNotification('–í–≤–µ–¥–∏—Ç–µ –∫–æ—Ä—Ä–µ–∫—Ç–Ω—É—é —Å—É–º–º—É', 'error');
                return;
            }

            if (amount > currentUser.balance) {
                showNotification('–ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ —Å—Ä–µ–¥—Å—Ç–≤', 'error');
                return;
            }

            const toUser = DB.users.find(u => u.username === toUsername);
            if (!toUser) {
                showNotification('–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–µ –Ω–∞–π–¥–µ–Ω', 'error');
                return;
            }

            if (toUser.id === currentUser.id) {
                showNotification('–ù–µ–ª—å–∑—è –ø–µ—Ä–µ–≤–µ—Å—Ç–∏ —Å–∞–º–æ–º—É —Å–µ–±–µ', 'error');
                return;
            }

            // –û–±–Ω–æ–≤–ª—è–µ–º –±–∞–ª–∞–Ω—Å—ã
            currentUser.balance -= amount;
            toUser.balance += amount;
            
            // –°–æ–∑–¥–∞–µ–º —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏—é
            const transaction = {
                id: Date.now(),
                fromUserId: currentUser.id,
                fromUsername: currentUser.username,
                toUserId: toUser.id,
                toUsername: toUser.username,
                amount,
                message: message || null,
                type: 'transfer',
                createdAt: new Date().toISOString()
            };
            
            DB.transactions.push(transaction);
            
            // –°–æ—Ö—Ä–∞–Ω—è–µ–º –∏–∑–º–µ–Ω–µ–Ω–∏—è
            saveToDB('users');
            saveToDB('transactions');
            saveCurrentUser();
            
            // –û—á–∏—â–∞–µ–º —Ñ–æ—Ä–º—É
            document.getElementById('transfer-to').value = '';
            document.getElementById('transfer-amount').value = '';
            document.getElementById('transfer-message').value = '';
            
            // –°–†–ê–ó–£ –æ–±–Ω–æ–≤–ª—è–µ–º –±–∞–ª–∞–Ω—Å –≤–æ –≤—Å–µ—Ö –º–µ—Å—Ç–∞—Ö
            updateHeader();
            loadTransfers();
            loadShop();
            if (state.currentSection === 'profile') {
                loadProfile();
            }
            
            showNotification(`–ü–µ—Ä–µ–≤–æ–¥ ${amount} C —É—Å–ø–µ—à–Ω–æ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω!`, 'success');
            
            // –°–æ–∑–¥–∞–µ–º —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –¥–ª—è –ø–æ–ª—É—á–∞—Ç–µ–ª—è
            createNotification({
                id: Date.now(),
                userId: toUser.id,
                type: 'transfer',
                fromUserId: currentUser.id,
                fromUsername: currentUser.username,
                amount: amount,
                message: `${currentUser.username} –æ—Ç–ø—Ä–∞–≤–∏–ª(–∞) –≤–∞–º –ø–µ—Ä–µ–≤–æ–¥ ${amount} C`,
                read: false,
                createdAt: new Date().toISOString()
            });
        }

        // –ó–∞–≥—Ä—É–∑–∫–∞ –∞–¥–º–∏–Ω-–ø–∞–Ω–µ–ª–∏
        function loadAdminPanel() {
            // –ü—Ä–æ–≤–µ—Ä—è–µ–º, —á—Ç–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å - @karkarich
            if (currentUser.username !== '@karkarich') {
                document.getElementById('admin-content').innerHTML = `
                    <div class="max-w-6xl mx-auto">
                        <div class="glassmorphism rounded-2xl p-8 text-center">
                            <div class="w-32 h-32 rounded-full bg-red-600/20 flex items-center justify-center text-4xl mx-auto mb-4">
                                ‚õî
                            </div>
                            <h2 class="text-2xl font-bold mb-4">–î–æ—Å—Ç—É–ø –∑–∞–ø—Ä–µ—â–µ–Ω</h2>
                            <p class="text-gray-400">–ê–¥–º–∏–Ω-–ø–∞–Ω–µ–ª—å –¥–æ—Å—Ç—É–ø–Ω–∞ —Ç–æ–ª—å–∫–æ –¥–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è @karkarich</p>
                        </div>
                    </div>
                `;
                return;
            }

            // –î–æ–±–∞–≤–ª—è–µ–º –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –¥–ª—è –∞–¥–º–∏–Ω—Å–∫–∏—Ö –∫–Ω–æ–ø–æ–∫
            setTimeout(() => {
                const setBalanceBtn = document.getElementById('admin-set-balance-btn');
                const distributeBtn = document.getElementById('admin-distribute-btn');
                
                if (setBalanceBtn) {
                    setBalanceBtn.addEventListener('click', function(e) {
                        e.preventDefault();
                        e.stopPropagation();
                        adminSetBalance();
                    });
                }
                
                if (distributeBtn) {
                    distributeBtn.addEventListener('click', function(e) {
                        e.preventDefault();
                        e.stopPropagation();
                        adminDistributeToClan();
                    });
                }
            }, 100);
        }

        // –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –±–∞–ª–∞–Ω—Å–∞ –∞–¥–º–∏–Ω–æ–º
        function adminSetBalance() {
            const username = document.getElementById('admin-username').value.trim();
            const balance = parseInt(document.getElementById('admin-balance').value);

            if (!username || !username.startsWith('@')) {
                showNotification('–í–≤–µ–¥–∏—Ç–µ –∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–π –Ω–∏–∫–Ω–µ–π–º', 'error');
                return;
            }

            if (isNaN(balance) || balance < 0) {
                showNotification('–í–≤–µ–¥–∏—Ç–µ –∫–æ—Ä—Ä–µ–∫—Ç–Ω—É—é —Å—É–º–º—É', 'error');
                return;
            }

            const user = DB.users.find(u => u.username === username);
            if (!user) {
                showNotification('–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–µ –Ω–∞–π–¥–µ–Ω', 'error');
                return;
            }

            user.balance = balance;
            saveToDB('users');
            
            // –û—á–∏—â–∞–µ–º —Ñ–æ—Ä–º—É
            document.getElementById('admin-username').value = '';
            document.getElementById('admin-balance').value = '';
            
            showNotification(`–ë–∞–ª–∞–Ω—Å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è ${username} —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω: ${balance} C`, 'success');
            
            // –û–±–Ω–æ–≤–ª—è–µ–º —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É –∫–ª–∞–Ω–æ–≤ –µ—Å–ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–µ karkarich
            if (username !== '@karkarich') {
                updateClanStats();
                updateGlobalStats();
            }
        }

        // –†–∞–∑–¥–∞—á–∞ –∫–ª–∞–Ω—É
        function adminDistributeToClan() {
            const clan = document.getElementById('admin-clan').value;
            const amount = parseInt(document.getElementById('admin-clan-amount').value);

            if (!clan) {
                showNotification('–í—ã–±–µ—Ä–∏—Ç–µ –∫–ª–∞–Ω', 'error');
                return;
            }

            if (isNaN(amount) || amount < 1) {
                showNotification('–í–≤–µ–¥–∏—Ç–µ –∫–æ—Ä—Ä–µ–∫—Ç–Ω—É—é —Å—É–º–º—É', 'error');
                return;
            }

            const clanUsers = DB.users.filter(u => u.clan === clan && u.username !== '@karkarich');
            if (clanUsers.length === 0) {
                showNotification('–í —ç—Ç–æ–º –∫–ª–∞–Ω–µ –Ω–µ—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π', 'error');
                return;
            }

            let totalDistributed = 0;
            clanUsers.forEach(user => {
                user.balance += amount;
                totalDistributed += amount;
            });

            saveToDB('users');
            
            // –û—á–∏—â–∞–µ–º —Ñ–æ—Ä–º—É
            document.getElementById('admin-clan-amount').value = '';
            
            showNotification(`–†–∞–∑–¥–∞–Ω–æ ${amount} C –∫–∞–∂–¥–æ–º—É –∏–∑ ${clanUsers.length} —É—á–∞—Å—Ç–Ω–∏–∫–æ–≤ –∫–ª–∞–Ω–∞ ${clan}. –í—Å–µ–≥–æ: ${totalDistributed} C`, 'success');
            
            // –û–±–Ω–æ–≤–ª—è–µ–º —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É
            updateClanStats();
            updateGlobalStats();
        }

        // ===========================================
        // –í–°–ü–û–ú–û–ì–ê–¢–ï–õ–¨–ù–´–ï –§–£–ù–ö–¶–ò–ò
        // ===========================================

        function formatDate(dateString) {
            try {
                const date = new Date(dateString);
                const now = new Date();
                const diffMs = now - date;
                const diffDays = Math.floor(diffMs / (1000 * 60 * 60 * 24));
                
                if (diffDays === 0) {
                    return '–°–µ–≥–æ–¥–Ω—è';
                } else if (diffDays === 1) {
                    return '–í—á–µ—Ä–∞';
                } else if (diffDays < 7) {
                    return `${diffDays} –¥–Ω–µ–π –Ω–∞–∑–∞–¥`;
                } else {
                    return date.toLocaleDateString('ru-RU');
                }
            } catch (e) {
                return '–ù–µ–¥–∞–≤–Ω–æ';
            }
        }

        function formatTime(dateString) {
            try {
                const date = new Date(dateString);
                return date.toLocaleTimeString('ru-RU', { hour: '2-digit', minute: '2-digit' });
            } catch (e) {
                return '';
            }
        }

        function getClanName(emoji) {
            const clanNames = {
                'ü¶Å': '–õ—å–≤—ã',
                'ü¶Ö': '–û—Ä–ª—ã',
                'üê∫': '–í–æ–ª–∫–∏',
                'üêª': '–ú–µ–¥–≤–µ–¥–∏',
                'ü¶ä': '–õ–∏—Å—ã',
                'üêØ': '–¢–∏–≥—Ä—ã',
                'ü¶â': '–°–æ–≤—ã',
                'üêç': '–ó–º–µ–∏'
            };
            return clanNames[emoji] || emoji;
        }

        function showModal(content) {
            const modalsContainer = document.getElementById('modals-container');
            const modal = document.createElement('div');
            modal.className = 'fixed inset-0 bg-black/70 flex items-center justify-center z-50 p-4 fade-in';
            modal.innerHTML = content;
            modal.onclick = (e) => {
                if (e.target === modal) closeModal();
            };
            modalsContainer.appendChild(modal);
            state.activeModal = modal;
        }

        function closeModal() {
            if (state.activeModal) {
                state.activeModal.remove();
                state.activeModal = null;
            }
        }

        function showNotification(message, type = 'info') {
            const notification = document.createElement('div');
            notification.className = `fixed top-4 right-4 p-4 rounded-xl z-50 fade-in ${
                type === 'error' ? 'bg-red-600/90' :
                type === 'success' ? 'bg-green-600/90' :
                type === 'warning' ? 'bg-yellow-600/90' : 'bg-blue-600/90'
            }`;
            notification.innerHTML = `
                <div class="flex items-center space-x-3">
                    <i class="fas fa-${type === 'error' ? 'exclamation-circle' : type === 'success' ? 'check-circle' : 'info-circle'}"></i>
                    <span>${message}</span>
                </div>
            `;
            document.body.appendChild(notification);
            
            setTimeout(() => {
                notification.classList.add('opacity-0', 'transition-opacity', 'duration-300');
                setTimeout(() => notification.remove(), 300);
            }, 3000);
        }

        // –ú–µ–Ω—é –ø–æ—Å—Ç–∞
        function showPostMenu(postId) {
            const post = DB.posts.find(p => p.id === postId);
            if (!post) return;

            const isAdmin = currentUser.username === '@karkarich';
            const isAuthor = post.userId === currentUser.id;

            if (isAuthor || isAdmin) {
                if (confirm('–£–¥–∞–ª–∏—Ç—å —ç—Ç–æ—Ç –ø–æ—Å—Ç?')) {
                    deletePost(postId);
                }
            }
        }

        // –£–¥–∞–ª–µ–Ω–∏–µ –ø–æ—Å—Ç–∞
        function deletePost(postId) {
            const postIndex = DB.posts.findIndex(p => p.id === postId);
            if (postIndex === -1) return;

            DB.posts.splice(postIndex, 1);
            saveToDB('posts');
            
            // –£–¥–∞–ª—è–µ–º –ø–æ—Å—Ç –∏–∑ –ø—Ä–æ—Ñ–∏–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
            if (currentUser.posts) {
                const userPostIndex = currentUser.posts.indexOf(postId);
                if (userPostIndex !== -1) {
                    currentUser.posts.splice(userPostIndex, 1);
                    saveToDB('users');
                    saveCurrentUser();
                }
            }
            
            loadFeed();
            loadProfile();
            showNotification('–ü–æ—Å—Ç —É–¥–∞–ª–µ–Ω', 'success');
            
            // –û–±–Ω–æ–≤–ª—è–µ–º —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É
            updateGlobalStats();
        }

        // –ü–æ–∫–∞–∑–∞—Ç—å –º–µ–¥–∏–∞—Ñ–∞–π–ª –≤ –ø–æ–ª–Ω–æ–º —Ä–∞–∑–º–µ—Ä–µ
        function showFullMedia(url) {
            const isVideo = url.includes('data:video');
            
            showModal(`
                <div class="bg-slate-900 rounded-2xl p-4 max-w-4xl w-full">
                    <div class="flex justify-between items-center mb-4">
                        <div></div>
                        <button onclick="closeModal()" class="w-8 h-8 rounded-full bg-slate-800 hover:bg-slate-700 flex items-center justify-center">
                            <i class="fas fa-times"></i>
                        </button>
                    </div>
                    <div class="flex justify-center">
                        ${isVideo ? 
                            `<video src="${url}" controls autoplay class="w-full max-h-[80vh] rounded-lg"></video>` :
                            `<img src="${url}" class="max-w-full max-h-[80vh] rounded-lg">`
                        }
                    </div>
                </div>
            `);
        }

        // –ü–æ–∫–∞–∑–∞—Ç—å –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏
        function showCommentsModal(postId) {
            const post = DB.posts.find(p => p.id === postId);
            if (!post || !post.comments || post.comments.length === 0) return;

            showModal(`
                <div class="bg-slate-800 rounded-2xl p-6 max-w-md w-full">
                    <h3 class="text-xl font-bold mb-4">üí¨ –ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏ (${post.comments.length})</h3>
                    <div class="space-y-4 max-h-96 overflow-y-auto mb-4">
                        ${post.comments.map(comment => `
                            <div class="flex items-start space-x-3">
                                <div class="w-10 h-10 rounded-full bg-slate-700 flex items-center justify-center">
                                    ${comment.userAvatar || 'ü§†'}
                                </div>
                                <div class="flex-1">
                                    <div class="font-bold text-sm">${comment.username}</div>
                                    <p class="text-sm">${comment.content}</p>
                                    <div class="text-xs text-gray-400 mt-1">${formatDate(comment.createdAt)}</div>
                                </div>
                            </div>
                        `).join('')}
                    </div>
                    <button onclick="closeModal()" class="w-full bg-slate-700 hover:bg-slate-600 py-3 rounded-xl font-bold">
                        –ó–∞–∫—Ä—ã—Ç—å
                    </button>
                </div>
            `);
        }

        // –ì–ª–æ–±–∞–ª—å–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏ –¥–ª—è –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–æ–≤ —Å–æ–±—ã—Ç–∏–π
        window.showFullMedia = showFullMedia;
        window.showCommentsModal = showCommentsModal;
        window.removeMedia = removeMedia;
        window.clearMedia = clearMedia;
        window.closeModal = closeModal;
    </script>
</body>
</html>